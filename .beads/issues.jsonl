{"id":"cgm-1cj","title":"Improve workflow resolution modal UX for download intents","notes":"# Epic: Workflow Resolution Modal UX Improvements\n\n## Problem Statement\n\nWhen a workflow has models with embedded download URLs (via `properties.models` in ComfyUI nodes), the resolution modal UX is confusing:\n\n1. **Analysis step**: Shows \"3 pending download\" correctly ✓\n2. **Models step**: Shows empty \"No models need resolution\" - user has no choices to make but must click through\n3. **Review step**: Shows \"0 to download\" even though 3 models WILL download when Apply is clicked\n4. **Too many clicks**: User clicks through 4 screens when they only need 2 (Analysis → Review → Apply)\n\n## Solution\n\n1. **Fix download count** - Review step should count pending download intents\n2. **Skip Models step** - When only download intents exist (no user choices), skip directly to Review\n3. **Show download details** - Review step should show exactly what will be downloaded (filename, URL, path)\n4. **Update navigation** - Button text and navigation logic should reflect the streamlined flow\n\n## Success Criteria\n\n- Users with download-intent-only workflows see: Analysis → Review → Apply (3 clicks)\n- Review step accurately shows \"X to download\" matching actual download count\n- Review step shows detailed list of what will be downloaded\n- Existing flows with unresolved/ambiguous models still work correctly\n\n## Child Tasks\n\n- cgm-447: Fix downloadCount computed\n- comfygit-manager-yah: Skip Models step when only intents\n- comfygit-manager-n2o: Add download details section\n- comfygit-manager-xii: Update navigation logic\n- comfygit-manager-29f: Update button text\n- comfygit-manager-8y2: E2E test coverage","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-22T14:30:02.870833171-05:00","created_by":"ubuntu","updated_at":"2026-01-22T15:48:40.44174231-05:00","closed_at":"2026-01-22T15:48:40.44174231-05:00","close_reason":"All 6 child tasks completed. Post-fix applied for property_download_intent match type (see cgm-447 comment)."}
{"id":"cgm-29f","title":"Update Analysis step banner to say 'Continue to Review' when no user input needed","notes":"# Context \u0026 Goal\n\n## Problem\nThe Analysis step shows a banner \"3 models pending download - click Continue to review\" but if we're skipping the Models step, the button should say \"Continue to Review\" not just \"Continue\". This provides clearer UX about where the user is going.\n\n## Why It Matters\nSmall polish that helps users understand the streamlined flow. When models step is skipped, users should know they're going directly to review.\n\n## How It Serves Project Goals\nClear, predictable UX with appropriate labeling.\n\n---\n\n# Current State vs Target State\n\n## Current Code\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue`\n\nThe Continue button in footer and any banner text should reflect the actual next step.\n\n## Target Code\n\nUpdate button label to be dynamic:\n\n```vue\n\u003cBaseButton variant=\"primary\" @click=\"handleContinueFromAnalysis\"\u003e\n  {{ nextStepFromAnalysis === 'review' ? 'Continue to Review →' : 'Continue' }}\n\u003c/BaseButton\u003e\n```\n\nAdd computed:\n\n```typescript\nconst nextStepFromAnalysis = computed(() =\u003e {\n  if (needsNodeResolution.value || hasNodesToInstall.value) {\n    return 'nodes'\n  } else if (needsModelResolution.value) {\n    return 'models'\n  }\n  return 'review'\n})\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue`\n  - Template: Update Continue button text in footer\n  - Script: Add nextStepFromAnalysis computed\n\n**Files READ (reference only):**\n- None\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- cgm-447 (different computed)\n- comfygit-manager-n2o (different section)\n\n**Cannot Run In Parallel With:**\n- comfygit-manager-yah, comfygit-manager-xii - should be done after those\n\n**Blocking Reason:**\n- Depends on skip-models decision being finalized\n\n---\n\n# Estimated Scope\n\n- **Size:** Small (\u003c30 lines)\n- **Risk:** Low (UI text only)\n\n---\n\n# Acceptance Criteria\n\n- [ ] When going to Review directly, button says \"Continue to Review →\"\n- [ ] When going to Nodes or Models, button says \"Continue\"\n- [ ] Banner text matches button behavior\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open workflow with only download intents\n2. Verify button says \"Continue to Review →\"\n3. Open workflow with unresolved models\n4. Verify button says \"Continue\"","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T14:29:23.557392012-05:00","created_by":"ubuntu","updated_at":"2026-01-22T15:11:05.277396165-05:00","closed_at":"2026-01-22T15:11:05.277396165-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-29f","depends_on_id":"cgm-xii","type":"blocks","created_at":"2026-01-22T14:29:27.833642938-05:00","created_by":"ubuntu"},{"issue_id":"cgm-29f","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.824596243-05:00","created_by":"ubuntu"}]}
{"id":"cgm-447","title":"Fix downloadCount to include pending download intents","notes":"# Context \u0026 Goal\n\n## Problem\nThe Review step shows \"0 to download\" in the summary stats even when 3 models have download intents and WILL be downloaded when the user clicks \"Apply Resolution\". This is misleading and confusing.\n\n## Why It Matters\nUsers see incorrect information before committing to an action. They might think nothing will happen, but clicking Apply actually triggers downloads. This erodes trust in the UI.\n\n## How It Serves Project Goals\nComfyGit aims to give users clear visibility and control over their workflow dependencies. Accurate counts are fundamental to that.\n\n---\n\n# Current State vs Target State\n\n## Current Code (PROBLEM)\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue` (lines 636-642)\n\n```typescript\nconst downloadCount = computed(() =\u003e {\n  let count = 0\n  for (const choice of modelChoices.value.values()) {\n    if (choice.action === 'download') count++\n  }\n  return count\n})\n```\n\nThis ONLY counts models where user explicitly made a choice with `action === 'download'`. Download intents (models with URLs from workflow properties) that the user didn't modify are NOT counted.\n\n## Target Code (SOLUTION)\n\n```typescript\nconst downloadCount = computed(() =\u003e {\n  let count = 0\n  \n  // Count explicit user download choices\n  for (const choice of modelChoices.value.values()) {\n    if (choice.action === 'download') count++\n  }\n  \n  // Count download intents that user hasn't cancelled\n  // These will be downloaded even without explicit user action\n  for (const model of downloadIntentModels.value) {\n    const choice = modelChoices.value.get(model.filename)\n    // If no choice made, intent is preserved (will download)\n    // If choice is cancel_download, it won't download (don't count)\n    if (!choice || (choice.action !== 'cancel_download' \u0026\u0026 choice.action !== 'skip' \u0026\u0026 choice.action !== 'optional')) {\n      // Only count if not already counted via explicit download choice\n      if (!choice || choice.action !== 'download') {\n        count++\n      }\n    }\n  }\n  \n  return count\n})\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue` (lines 636-642) - Fix downloadCount computed property\n\n**Files READ (reference only):**\n- `frontend/src/components/WorkflowResolveModal.vue` (lines 531-543) - downloadIntentModels computed property (already exists, reuse)\n- `frontend/src/types/comfygit.ts` - ModelChoice type definition\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- Nothing else modifies this specific computed property\n\n**Cannot Run In Parallel With:**\n- Any other task modifying WorkflowResolveModal.vue lines 620-700\n\n**Blocking Reason:**\n- None - this is a leaf task\n\n---\n\n# Estimated Scope\n\n- **Size:** Small (\u003c50 lines) - single computed property change\n- **Risk:** Low (isolated computation, doesn't affect other logic)\n\n---\n\n# Acceptance Criteria\n\n- [ ] When 3 models have download intents and user makes no changes, Review shows \"3 to download\"\n- [ ] When user cancels one download intent, Review shows \"2 to download\"\n- [ ] When user explicitly sets download action on an intent, it's counted once (not double)\n- [ ] Existing behavior for user-initiated downloads (not intents) unchanged\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open a workflow with models that have `property_download_intent` match type\n2. Click through to Review step without making any choices\n3. Verify \"X to download\" matches actual download intent count\n4. Go back, cancel one intent, verify count decreases","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-22T14:28:11.373610644-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:47:14.170541297-05:00","closed_at":"2026-01-22T14:47:14.170541297-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-447","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.767619632-05:00","created_by":"ubuntu"}],"comments":[{"id":1,"issue_id":"cgm-447","author":"ubuntu","text":"**Post-implementation fix (2026-01-22):** Original implementation only filtered for `match_type === 'download_intent'` but backend returns TWO match types for download intents: `download_intent` (from pyproject.toml) and `property_download_intent` (from workflow node properties/embedded URLs). Fixed `downloadIntentModels` computed to check for both: `m.match_type === 'download_intent' || m.match_type === 'property_download_intent'`. The E2E test mocked only `download_intent` so the gap wasn't caught until real-world testing.","created_at":"2026-01-22T20:48:33Z"}]}
{"id":"cgm-46e","title":"Test issue for worktree verification","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T18:57:30.926391833-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:39:25.944016425-05:00","closed_at":"2026-01-14T18:58:20.008630164-05:00","close_reason":"Tested from worktree - closing to verify sync"}
{"id":"cgm-4r7","title":"Write property_download_intent models to pyproject.toml in apply_resolution","notes":"## Context \u0026 Goal\n\n**Problem:** When a workflow has models with embedded download URLs (`property_download_intent` from node `properties.models`), clicking \"Apply Resolution\" doesn't write them to pyproject.toml. This means when the download completes, `_finalize_download` can't find them to update their status from \"unresolved\" to \"resolved\".\n\n**User sees:** After download completes, workflow still shows \"missing models\" until they save the workflow (Ctrl+S) which triggers a re-analysis.\n\n**Root cause traced in discussion:**\n- `property_download_intent` models are in `result.models_resolved` (not unresolved/ambiguous)\n- `apply_resolution` only calls `fix_resolution` when `result.has_issues` is True\n- `ResolutionResult.has_issues` doesn't include download intents (only unresolved/ambiguous)\n- `fix_resolution` only processes `models_unresolved` and `models_ambiguous`, not `models_resolved`\n- So `property_download_intent` models never get written to pyproject.toml\n\n## Current State vs Target State\n\n**Current code** (`server/api/v2/workflows.py`, lines 839-846):\n```python\n# Apply strategies to fix unresolved issues (writes to pyproject.toml)\nif result.has_issues:\n    result = await run_sync(\n        env.workflow_manager.fix_resolution,\n        result,\n        node_strategy,\n        model_strategy\n    )\n```\n\n**Target state:** Add a new block after the fix_resolution call (around line 895, after model choices handling) to write `property_download_intent` models:\n\n```python\n# Write property_download_intent models to pyproject (they're in models_resolved, not processed by fix_resolution)\nfrom comfygit_core.models.manifest import ManifestWorkflowModel\ntry:\n    for model in result.models_resolved:\n        if model.match_type == \"property_download_intent\" and model.model_source:\n            # Check if already in pyproject (avoid duplicates)\n            existing_models = env.pyproject.workflows.get_workflow_models(name)\n            already_exists = any(\n                m.filename == model.reference.widget_value and m.sources\n                for m in existing_models\n            )\n            if not already_exists:\n                # Determine category from node type\n                category = _get_category_for_node_type(model.reference.node_type) or \"models\"\n                \n                manifest_model = ManifestWorkflowModel(\n                    filename=model.reference.widget_value,\n                    category=category,\n                    criticality=\"required\",\n                    status=\"unresolved\",\n                    nodes=[model.reference],\n                    sources=[model.model_source],\n                    relative_path=str(model.target_path) if model.target_path else None\n                )\n                env.pyproject.workflows.add_workflow_model(name, manifest_model)\nexcept Exception:\n    pass  # Continue even if write fails - downloads will still work\n```\n\nAlso need a helper function for category:\n```python\ndef _get_category_for_node_type(node_type: str) -\u003e str | None:\n    \"\"\"Infer model category from loader node type.\"\"\"\n    node_type_lower = node_type.lower()\n    if \"checkpoint\" in node_type_lower:\n        return \"checkpoints\"\n    elif \"vae\" in node_type_lower:\n        return \"vae\"\n    elif \"lora\" in node_type_lower:\n        return \"loras\"\n    elif \"clip\" in node_type_lower:\n        return \"clip\"\n    elif \"controlnet\" in node_type_lower:\n        return \"controlnet\"\n    elif \"upscale\" in node_type_lower:\n        return \"upscale_models\"\n    return None\n```\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- server/api/v2/workflows.py (around lines 895-930) - add property_download_intent write logic\n\n**Files READ (reference only):**\n- comfygit_core/managers/workflow_manager.py:217-266 - reference for _write_model_resolution_grouped pattern\n- comfygit_core/models/manifest.py - ManifestWorkflowModel import\n\n**Files CREATED:** None\n\n## Parallelization Info\n\n**Can Run In Parallel With:** Any non-workflows.py backend tasks\n\n**Cannot Run In Parallel With:** Any other task modifying server/api/v2/workflows.py\n\n**Blocking Reason:** None - this is a standalone fix\n\n## Estimated Scope\n- **Size:** Small (\u003c50 lines)\n- **Risk:** Medium (touches apply_resolution which is core workflow)\n\n## Acceptance Criteria\n\n- [ ] After clicking \"Apply Resolution\" on a workflow with property_download_intent models, those models appear in pyproject.toml under [workflow.models.\u003cworkflow-name\u003e]\n- [ ] The models have status=\"unresolved\" and sources=[url]\n- [ ] When download completes, _finalize_download finds and updates them to status=\"resolved\"\n- [ ] Workflow status updates automatically without needing to save/re-open\n- [ ] Existing download_intent (from pyproject) behavior unchanged\n- [ ] No duplicate entries created if user re-runs resolution\n\n## Testing Requirements\n\n**Manual Verification:**\n1. Open a workflow with models that have embedded URLs (property_download_intent)\n2. Go through resolution wizard, click Apply Resolution\n3. Check pyproject.toml - model should be listed with status=\"unresolved\" and sources=[url]\n4. Wait for download to complete\n5. Re-open panel - workflow should show resolved (no missing models)\n6. Do NOT need to save workflow (Ctrl+S) for this to work\n\n**Existing tests:** testing/integration/panel/test_workflow_endpoints.py covers apply_resolution but may need new test case\n\n**New test:** Add test case that verifies property_download_intent models are written to pyproject","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-22T20:58:24.394520078-05:00","created_by":"ubuntu","updated_at":"2026-01-22T21:04:12.022671057-05:00","closed_at":"2026-01-22T21:04:12.022671057-05:00","close_reason":"Implemented property_download_intent write to pyproject.toml in apply_resolution. Added helper function _get_category_for_node_type() and new code block to write models before download starts. All 46 workflow tests pass."}
{"id":"cgm-8y2","title":"Add E2E test for download-intent-only workflow resolution flow","notes":"# Context \u0026 Goal\n\n## Problem\nWe need automated test coverage for the new UX flow where workflows with only download intents skip the Models step and show accurate counts in Review.\n\n## Why It Matters\nRegression protection for the UX improvements. Without tests, future changes could break the streamlined flow.\n\n## How It Serves Project Goals\nTest coverage for critical user workflow.\n\n---\n\n# Current State vs Target State\n\n## Current State\nNo E2E test specifically for download-intent-only resolution flow.\n\n## Target State\nE2E test that:\n1. Opens a workflow with models that have property_download_intent\n2. Verifies Analysis shows correct pending download count\n3. Verifies clicking Continue skips Models step\n4. Verifies Review shows correct \"X to download\" count\n5. Verifies \"Models to Download\" section shows correct details\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- None\n\n**Files READ (reference only):**\n- `e2e/tests/` - existing E2E test patterns\n- `testing/` - existing test helpers\n\n**Files CREATED:**\n- `e2e/tests/workflow-resolution-download-intents.spec.ts` - new E2E test file\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- All other beads (test file is independent)\n\n**Cannot Run In Parallel With:**\n- None\n\n**Blocking Reason:**\n- Should run AFTER all UX changes are complete to test final behavior\n\n---\n\n# Estimated Scope\n\n- **Size:** Medium (50-100 lines)\n- **Risk:** Low (additive test)\n\n---\n\n# Acceptance Criteria\n\n- [ ] E2E test exists and passes\n- [ ] Test covers Analysis → Review skip\n- [ ] Test verifies download count accuracy\n- [ ] Test verifies download details section\n\n---\n\n# Testing Requirements\n\nThis IS the test. Run with:\n```bash\ncd e2e \u0026\u0026 npx playwright test workflow-resolution-download-intents.spec.ts\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T14:29:42.547696955-05:00","created_by":"ubuntu","updated_at":"2026-01-22T15:16:12.857276564-05:00","closed_at":"2026-01-22T15:16:12.857276564-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-8y2","depends_on_id":"cgm-447","type":"blocks","created_at":"2026-01-22T14:29:48.35113152-05:00","created_by":"ubuntu"},{"issue_id":"cgm-8y2","depends_on_id":"cgm-yah","type":"blocks","created_at":"2026-01-22T14:29:48.364508207-05:00","created_by":"ubuntu"},{"issue_id":"cgm-8y2","depends_on_id":"cgm-n2o","type":"blocks","created_at":"2026-01-22T14:29:48.378226713-05:00","created_by":"ubuntu"},{"issue_id":"cgm-8y2","depends_on_id":"cgm-xii","type":"blocks","created_at":"2026-01-22T14:29:48.392679516-05:00","created_by":"ubuntu"},{"issue_id":"cgm-8y2","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.841360198-05:00","created_by":"ubuntu"}]}
{"id":"cgm-ah6","title":"Issue created from worktree","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T18:58:48.059637033-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:40:52.827142291-05:00","closed_at":"2026-01-22T14:40:52.827142291-05:00","close_reason":"Placeholder issue from initial worktree setup, not needed"}
{"id":"cgm-isl","title":"Enhance MissingResourcesPopup with actionable install/download buttons","description":"## Context \u0026 Goal\n\n**Problem**: The MissingResourcesPopup currently shows raw node→package mappings instead of actionable, deduplicated package lists. Users cannot install nodes or download models directly - they must open the full panel.\n\n**Why it matters**: This is the first thing users see when loading a workflow with missing dependencies. It should provide immediate, frictionless resolution options rather than redirecting to another UI.\n\n**Goal**: Transform the popup from a passive notification into an actionable resolution interface with:\n- Deduplicated package list (not node-type mappings)\n- Individual and bulk install/download buttons\n- \"Don't show again\" per-workflow memory\n- Clean UI without emojis\n\n---\n\n## Current State vs Target State\n\n### Current Node Display (WRONG)\n```vue\n\u003c!-- Shows every node type mapped to its package --\u003e\n\u003cdiv v-for=\"node in missingNodes\" class=\"item\"\u003e\n  \u003ccode class=\"node-type\"\u003e{{ node.node_type }}\u003c/code\u003e\n  \u003cspan class=\"package-info\"\u003e→ {{ node.package_title }}\u003c/span\u003e\n\u003c/div\u003e\n```\n\nResult:\n```\nDepthflowMotionPresetCircle → ComfyUI-Depthflow-Nodes\nDepthflow → ComfyUI-Depthflow-Nodes\n```\n\n### Target Node Display (CORRECT)\n```vue\n\u003c!-- Shows deduplicated packages with install buttons --\u003e\n\u003cdiv v-for=\"pkg in missingPackages\" :key=\"pkg.package_id\" class=\"package-item\"\u003e\n  \u003cspan class=\"package-name\"\u003e{{ pkg.title }}\u003c/span\u003e\n  \u003cspan class=\"node-count\"\u003e({{ pkg.node_count }} nodes)\u003c/span\u003e\n  \u003cBaseButton\n    v-if=\"!queuedPackages.has(pkg.package_id)\"\n    size=\"sm\"\n    @click=\"installPackage(pkg.package_id)\"\n  \u003eInstall\u003c/BaseButton\u003e\n  \u003cspan v-else class=\"queued-badge\"\u003eQueued\u003c/span\u003e\n\u003c/div\u003e\n```\n\nResult:\n```\nComfyUI-Depthflow-Nodes (2 nodes)  [Install]\n```\n\n---\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/MissingResourcesPopup.vue` (entire file) - main implementation\n\n**Files READ (reference only):**\n- `frontend/src/composables/useModelDownloadQueue.ts` - understand addToQueue() signature\n- `frontend/src/composables/useComfyGitService.ts` - understand installNode() signature\n- `frontend/src/types/comfygit.ts` - type definitions\n\n**Files CREATED:**\n- None\n\n---\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Any backend changes\n- Any other frontend components not importing MissingResourcesPopup\n\n**Cannot Run In Parallel With:**\n- Nothing - this is the only bead for this feature\n\n**Blocking Reason:** N/A (self-contained)\n\n---\n\n## Estimated Scope\n\n- **Size:** Medium (~150-200 lines of changes)\n- **Risk:** Low (isolated popup component, no shared state mutations)\n\n---\n\n## Implementation Details\n\n### 1. New Imports\n```typescript\nimport { useModelDownloadQueue } from '@/composables/useModelDownloadQueue'\nimport { useComfyGitService } from '@/composables/useComfyGitService'\n```\n\n### 2. New Interfaces\n```typescript\ninterface MissingPackage {\n  package_id: string\n  title: string\n  node_count: number\n  node_types: string[]  // for tooltip/debug\n}\n\ninterface MissingModelItem {\n  filename: string\n  widget_value: string\n  url: string | null\n  targetPath: string | null\n  canDownload: boolean\n}\n```\n\n### 3. New State\n```typescript\nconst queuedPackages = ref\u003cSet\u003cstring\u003e\u003e(new Set())\nconst queuedModels = ref\u003cSet\u003cstring\u003e\u003e(new Set())\nconst dontShowAgain = ref(false)\nconst installingPackage = ref\u003cstring | null\u003e(null)  // for loading state\nconst currentWorkflowHash = ref\u003cstring | null\u003e(null)\n```\n\n### 4. New Computed: missingPackages (deduplicated)\n```typescript\nconst missingPackages = computed\u003cMissingPackage[]\u003e(() =\u003e {\n  if (!analysis.value?.nodes) return []\n\n  const packageMap = new Map\u003cstring, MissingPackage\u003e()\n\n  const uninstalledResolved = (analysis.value.nodes.resolved || [])\n    .filter((n: any) =\u003e !n.is_installed \u0026\u0026 n.package?.package_id)\n\n  for (const node of uninstalledResolved) {\n    const pkgId = node.package.package_id\n    if (!packageMap.has(pkgId)) {\n      packageMap.set(pkgId, {\n        package_id: pkgId,\n        title: node.package.title || pkgId,\n        node_count: 0,\n        node_types: []\n      })\n    }\n    const pkg = packageMap.get(pkgId)!\n    pkg.node_count++\n    pkg.node_types.push(node.reference?.node_type || node.node_type)\n  }\n\n  return Array.from(packageMap.values())\n})\n\nconst unresolvedNodes = computed(() =\u003e {\n  if (!analysis.value?.nodes) return []\n  return (analysis.value.nodes.unresolved || []).map((n: any) =\u003e ({\n    node_type: n.reference?.node_type || n.node_type\n  }))\n})\n```\n\n### 5. Updated missingModels computed\n```typescript\nconst missingModels = computed\u003cMissingModelItem[]\u003e(() =\u003e {\n  if (!analysis.value?.models) return []\n\n  const needsDownload = (analysis.value.models.resolved || [])\n    .filter((m: any) =\u003e\n      m.match_type === 'download_intent' ||\n      m.match_type === 'property_download_intent' ||\n      m.match_type === 'not_found'\n    )\n    .map((m: any) =\u003e ({\n      filename: m.reference?.widget_value?.split('/').pop() || m.reference?.widget_value,\n      widget_value: m.reference?.widget_value || m.widget_value,\n      url: m.download_source?.url || null,\n      targetPath: m.download_source?.target_path || null,\n      canDownload: !!(m.download_source?.url \u0026\u0026 m.download_source?.target_path)\n    }))\n\n  return needsDownload\n})\n```\n\n### 6. Action Methods\n```typescript\nconst { addToQueue } = useModelDownloadQueue()\nconst { installNode } = useComfyGitService()\n\nasync function installPackage(packageId: string) {\n  if (queuedPackages.value.has(packageId)) return\n\n  installingPackage.value = packageId\n  try {\n    await installNode(packageId)\n    queuedPackages.value.add(packageId)\n  } catch (e) {\n    console.error('[ComfyGit] Failed to install package:', e)\n  } finally {\n    installingPackage.value = null\n  }\n}\n\nfunction downloadModel(model: MissingModelItem) {\n  if (!model.url || !model.targetPath || queuedModels.value.has(model.url)) return\n\n  addToQueue([{\n    workflow: 'unsaved',\n    filename: model.filename,\n    url: model.url,\n    targetPath: model.targetPath\n  }])\n  queuedModels.value.add(model.url)\n}\n\nfunction installAllNodes() {\n  for (const pkg of missingPackages.value) {\n    if (!queuedPackages.value.has(pkg.package_id)) {\n      installPackage(pkg.package_id)\n    }\n  }\n}\n\nfunction downloadAllModels() {\n  const toDownload = missingModels.value.filter(\n    m =\u003e m.canDownload \u0026\u0026 !queuedModels.value.has(m.url!)\n  )\n  if (toDownload.length === 0) return\n\n  addToQueue(toDownload.map(m =\u003e ({\n    workflow: 'unsaved',\n    filename: m.filename,\n    url: m.url!,\n    targetPath: m.targetPath!\n  })))\n\n  for (const m of toDownload) {\n    queuedModels.value.add(m.url!)\n  }\n}\n\nfunction downloadAll() {\n  installAllNodes()\n  downloadAllModels()\n}\n```\n\n### 7. \"Don't Show Again\" Logic\n```typescript\nfunction getWorkflowHash(workflow: any): string {\n  const nodeTypes = (workflow?.nodes || [])\n    .map((n: any) =\u003e n.type)\n    .sort()\n    .join(',')\n  return btoa(nodeTypes).slice(0, 16)\n}\n\nfunction shouldShowPopup(workflow: any): boolean {\n  const hash = getWorkflowHash(workflow)\n  return localStorage.getItem('comfygit:popup-dismissed:' + hash) !== 'true'\n}\n\nfunction handleDontShowAgainChange() {\n  if (dontShowAgain.value \u0026\u0026 currentWorkflowHash.value) {\n    localStorage.setItem('comfygit:popup-dismissed:' + currentWorkflowHash.value, 'true')\n  }\n}\n```\n\n---\n\n## Acceptance Criteria\n\n- [ ] Missing nodes section shows deduplicated packages (by package_id), not node-type mappings\n- [ ] Each package shows node count (e.g., \"ComfyUI-Depthflow-Nodes (2 nodes)\")\n- [ ] Each package has individual \"Install\" button\n- [ ] Section has \"Install All\" button for bulk node installation\n- [ ] Each downloadable model has individual \"Download\" button\n- [ ] Section has \"Download All\" button for bulk model downloads\n- [ ] Footer has \"Download All\" primary button that queues everything\n- [ ] Buttons show \"Queued\" status after clicked (prevents duplicate queuing)\n- [ ] \"Don't show again\" checkbox persists choice per-workflow to localStorage\n- [ ] No emojis in section titles\n- [ ] Unresolved nodes (not in registry) shown in separate \"Unknown Nodes\" section\n- [ ] Integrates with existing useModelDownloadQueue for model downloads\n- [ ] Integrates with existing useComfyGitService.installNode() for node installation\n\n---\n\n## Testing Requirements\n\n**Manual Testing:**\n1. Load workflow with missing nodes from single package → see deduplicated entry\n2. Load workflow with missing nodes from multiple packages → see multiple entries\n3. Click individual Install → package queued, button changes to \"Queued\"\n4. Click Install All → all packages queued\n5. Click individual Download → model added to download queue\n6. Click Download All (section) → all models in section queued\n7. Click Download All (footer) → everything queued\n8. Check \"Don't show again\" → dismiss → reload same workflow → popup shouldn't appear\n9. Load different workflow → popup should appear (different hash)\n\n---\n\n## Build \u0026 Verify\n\nAfter implementation:\n```bash\ncd frontend \u0026\u0026 bun run build\n```\n\nThen test in browser with workflow that has missing dependencies.\n","status":"closed","priority":1,"issue_type":"task","assignee":"ubuntu","created_at":"2026-01-23T03:13:37.131460186-05:00","created_by":"ubuntu","updated_at":"2026-01-23T03:20:06.796069031-05:00","closed_at":"2026-01-23T03:20:06.796069031-05:00","close_reason":"Implemented all acceptance criteria: deduplicated packages, Install/Download buttons, bulk actions, 'Don't show again' checkbox with localStorage, no emojis, separate Unknown Nodes section, integration with useModelDownloadQueue and useComfyGitService"}
{"id":"cgm-n2o","title":"Add 'Models to Download' section in Review step showing download intent details","notes":"# Context \u0026 Goal\n\n## Problem\nThe Review step shows download intents as individual model rows with \"Pending Download\" badge, but doesn't provide a clear summary section showing WHAT will be downloaded. Users should see:\n- Model filename\n- Download URL (truncated)\n- Target path\n- Optionally file size if available\n\n## Why It Matters\nBefore clicking \"Apply Resolution\", users need to understand exactly what will happen. Showing a dedicated \"Models to Download\" section with details gives confidence and transparency.\n\n## How It Serves Project Goals\nClear visibility into pending actions. Users can verify URLs and paths before downloads start.\n\n---\n\n# Current State vs Target State\n\n## Current Code\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue` (lines 248-287)\n\nCurrently shows a generic \"Models\" section that lists all editable models with badges. Download intents show \"Pending Download\" but no URL/path details.\n\n## Target Code (ADD NEW SECTION)\n\nAfter the existing Models section (or replace it for download intents), add:\n\n```vue\n\u003c!-- Download Intent Details Section --\u003e\n\u003cdiv v-if=\"pendingDownloadsForReview.length \u003e 0\" class=\"review-section\"\u003e\n  \u003ch4 class=\"section-title\"\u003eModels to Download ({{ pendingDownloadsForReview.length }})\u003c/h4\u003e\n  \u003cdiv class=\"review-items download-details\"\u003e\n    \u003cdiv\n      v-for=\"download in pendingDownloadsForReview\"\n      :key=\"download.filename\"\n      class=\"review-item download-item\"\n    \u003e\n      \u003cdiv class=\"download-info\"\u003e\n        \u003ccode class=\"item-name\"\u003e{{ download.filename }}\u003c/code\u003e\n        \u003cdiv class=\"download-meta\"\u003e\n          \u003cspan class=\"download-path\"\u003e→ {{ download.target_path }}\u003c/span\u003e\n          \u003cspan v-if=\"download.url\" class=\"download-url\" :title=\"download.url\"\u003e\n            {{ truncateUrl(download.url) }}\n          \u003c/span\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \u003cspan class=\"choice-badge download\"\u003eWill Download\u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\nAdd computed property:\n\n```typescript\nconst pendingDownloadsForReview = computed(() =\u003e {\n  return downloadIntentModels.value.filter(model =\u003e {\n    const choice = modelChoices.value.get(model.filename)\n    // Include if no choice (default = download) or explicit download\n    // Exclude if cancelled/skipped/optional\n    return !choice || choice.action === 'download'\n  }).map(model =\u003e ({\n    filename: model.filename,\n    url: model.download_source,\n    target_path: model.target_path\n  }))\n})\n```\n\nAdd helper:\n\n```typescript\nfunction truncateUrl(url: string, maxLen = 50): string {\n  if (url.length \u003c= maxLen) return url\n  return url.slice(0, maxLen - 3) + '...'\n}\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue`\n  - Template: Add new section after line 287\n  - Script: Add pendingDownloadsForReview computed (~line 610)\n  - Script: Add truncateUrl helper function\n  - Styles: Add .download-details, .download-item, .download-meta, .download-url classes\n\n**Files READ (reference only):**\n- `frontend/src/components/WorkflowResolveModal.vue` - downloadIntentModels computed (lines 531-543)\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- cgm-447 (different computed properties)\n- comfygit-manager-yah (different section of file)\n\n**Cannot Run In Parallel With:**\n- Any task modifying Review step template (lines 170-292)\n\n**Blocking Reason:**\n- None - this is a leaf task\n\n---\n\n# Estimated Scope\n\n- **Size:** Medium (50-100 lines) - new section + computed + styles\n- **Risk:** Low (additive, doesn't modify existing behavior)\n\n---\n\n# Acceptance Criteria\n\n- [ ] Review step shows \"Models to Download (N)\" section when download intents exist\n- [ ] Each download item shows: filename, target path, truncated URL\n- [ ] Items cancelled/skipped by user don't appear in this section\n- [ ] URL tooltip shows full URL on hover\n- [ ] Section doesn't appear if no downloads pending\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open workflow with download intents\n2. Navigate to Review step\n3. Verify \"Models to Download\" section appears with correct count\n4. Verify each item shows filename, path, and URL\n5. Go back, cancel one download, verify it disappears from section","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-22T14:28:49.75943478-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:51:36.416082729-05:00","closed_at":"2026-01-22T14:51:36.416082729-05:00","close_reason":"Implemented Models to Download section in Review step with filename, target path, and truncated URL display","dependencies":[{"issue_id":"cgm-n2o","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.798364804-05:00","created_by":"ubuntu"}]}
{"id":"cgm-xii","title":"Update handleContinueFromAnalysis to skip Models step for download-intent-only cases","notes":"# Context \u0026 Goal\n\n## Problem\nThe `handleContinueFromAnalysis` function determines which step to navigate to after Analysis. Currently it navigates to Models step if there are download intents, but if we're skipping the Models step (per comfygit-manager-yah), this navigation logic also needs updating.\n\n## Why It Matters\nWithout this change, clicking \"Continue\" from Analysis could try to navigate to a step that doesn't exist in the wizard, causing undefined behavior.\n\n## How It Serves Project Goals\nConsistent navigation flow that matches the wizard step configuration.\n\n---\n\n# Current State vs Target State\n\n## Current Code (PROBLEM)\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue` (lines 750-763)\n\n```typescript\nfunction handleContinueFromAnalysis() {\n  if (needsNodeResolution.value || hasNodesToInstall.value) {\n    currentStep.value = 'nodes'\n  } else if (needsModelResolution.value || hasDownloadIntents.value) {\n    currentStep.value = 'models'\n  } else {\n    currentStep.value = 'review'\n  }\n}\n```\n\n## Target Code (SOLUTION)\n\n```typescript\nfunction handleContinueFromAnalysis() {\n  if (needsNodeResolution.value || hasNodesToInstall.value) {\n    currentStep.value = 'nodes'\n  } else if (needsModelResolution.value) {\n    // Only go to models if user needs to make choices\n    // Download intents don't need user input - skip to review\n    currentStep.value = 'models'\n  } else {\n    currentStep.value = 'review'\n  }\n}\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue` (lines 750-763) - Update navigation condition\n\n**Files READ (reference only):**\n- None\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- cgm-447 (different lines)\n- comfygit-manager-n2o (different lines)\n\n**Cannot Run In Parallel With:**\n- comfygit-manager-yah - REASON: Both relate to skipping Models step, should be done together or sequentially\n\n**Blocking Reason:**\n- Depends on comfygit-manager-yah being decided (same logic change)\n\n---\n\n# Estimated Scope\n\n- **Size:** Small (\u003c10 lines) - single condition change\n- **Risk:** Low (isolated navigation logic)\n\n---\n\n# Acceptance Criteria\n\n- [ ] From Analysis, clicking Continue skips Models step when only download intents exist\n- [ ] From Analysis, clicking Continue goes to Models when unresolved/ambiguous models exist\n- [ ] From Analysis, clicking Continue goes to Nodes when node resolution needed\n- [ ] Navigation matches wizardSteps configuration\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open workflow with only download intents (no unresolved models)\n2. Click Continue from Analysis\n3. Verify you land on Review (not Models)\n4. Open workflow with unresolved models\n5. Click Continue, verify you land on Models","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-22T14:29:05.337122123-05:00","created_by":"ubuntu","updated_at":"2026-01-22T15:01:29.985687144-05:00","closed_at":"2026-01-22T15:01:29.985687144-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-xii","depends_on_id":"cgm-yah","type":"blocks","created_at":"2026-01-22T14:29:10.021851396-05:00","created_by":"ubuntu"},{"issue_id":"cgm-xii","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.812244709-05:00","created_by":"ubuntu"}]}
{"id":"cgm-yah","title":"Skip Models step when only download intents exist (no user choices needed)","notes":"# Context \u0026 Goal\n\n## Problem\nWhen a workflow has models with download URLs embedded (via `properties.models`), the Models step still shows but displays \"No models need resolution\" or an unhelpful empty interface. The user has no choices to make - the models already have known download sources.\n\n## Why It Matters\nUsers are forced to click through an empty/useless screen. This wastes time and confuses users who wonder why they're seeing a \"Models\" step with nothing to do.\n\n## How It Serves Project Goals\nStreamlined UX with fewer unnecessary clicks. Users only see steps where they have actual decisions to make.\n\n---\n\n# Current State vs Target State\n\n## Current Code (PROBLEM)\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue` (lines 431-434)\n\n```typescript\n// Show Models step if there are unresolved/ambiguous OR download intents to review\nif (needsModelResolution.value || hasDownloadIntents.value) {\n  steps.push({ id: 'models', label: 'Models' })\n}\n```\n\nThe step shows whenever there are download intents, even if user has no choices to make.\n\n## Target Code (SOLUTION)\n\n```typescript\n// Show Models step ONLY if user needs to make choices (unresolved/ambiguous)\n// Download intents don't require user input - they're auto-confirmed\nif (needsModelResolution.value) {\n  steps.push({ id: 'models', label: 'Models' })\n}\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue` (lines 431-434) - Remove hasDownloadIntents from condition\n\n**Files READ (reference only):**\n- `frontend/src/components/WorkflowResolveModal.vue` - Understanding step flow\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- cgm-447 (different lines in same file - 636 vs 431)\n\n**Cannot Run In Parallel With:**\n- Any task modifying wizardSteps computed (lines 420-444)\n\n**Blocking Reason:**\n- None - this is a leaf task\n\n---\n\n# Estimated Scope\n\n- **Size:** Small (\u003c10 lines) - single condition change\n- **Risk:** Low (isolated logic change)\n\n---\n\n# Acceptance Criteria\n\n- [ ] When workflow has ONLY download intents (no unresolved/ambiguous), Models step is skipped\n- [ ] When workflow has unresolved OR ambiguous models, Models step still shows\n- [ ] When workflow has both download intents AND unresolved models, Models step shows\n- [ ] Navigation flow goes Analysis → Review when only intents exist\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open a workflow where all missing models have download URLs (property_download_intent)\n2. Verify step indicators show: Analysis → Review (no Models step)\n3. Open a workflow with truly unresolved models (no URL)\n4. Verify Models step appears","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-22T14:28:29.094496459-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:46:23.453157695-05:00","closed_at":"2026-01-22T14:46:23.453157695-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-yah","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.780768897-05:00","created_by":"ubuntu"}]}
{"id":"cgm-z5o","title":"Intercept ComfyUI Missing Resources Popup","description":"Replace ComfyUI's built-in missing nodes/models popup with ComfyGit's own UI. This ensures models are downloaded to correct locations and custom nodes are installed through ComfyGit's managed environment system.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-23T00:35:39.012722836-05:00","created_by":"ubuntu","updated_at":"2026-01-23T02:10:23.11572377-05:00","closed_at":"2026-01-23T02:10:23.11572377-05:00","close_reason":"All subtasks completed - popup interception system fully implemented"}
{"id":"cgm-z5o.1","title":"Add /v2/comfygit/workflow/analyze-json endpoint","notes":"## Context \u0026 Goal\n\nAdd a new backend endpoint that accepts raw workflow JSON and returns analysis results. This enables analyzing workflows that are loaded in the browser but not yet saved to disk.\n\n**Prerequisite:** Core library bead cg-2ro (WorkflowDependencyParser refactor) must be completed first.\n\n**Why it matters:** This is the backend half of the \"intercept missing resources popup\" feature. The frontend extension will call this endpoint with the workflow JSON when a workflow is loaded.\n\n## Current State vs Target State\n\n**Current:** No endpoint exists for analyzing in-memory workflow JSON. Only `/v2/comfygit/workflow/{name}/analyze` which requires workflow to be saved on disk (lines 624-709).\n\n**Target:** New endpoint `/v2/comfygit/workflow/analyze-json` that:\n1. Accepts POST with workflow JSON in body\n2. Parses workflow using Workflow.from_json()\n3. Uses WorkflowDependencyParser with Workflow object (not path)\n4. Returns analysis results matching existing analyze endpoint format\n\n## Target Code\n\nAdd after line 709 in `server/api/v2/workflows.py`:\n\n\\`\\`\\`python\n@routes.post(\"/v2/comfygit/workflow/analyze-json\")\n@requires_environment\nasync def analyze_workflow_json(request: web.Request, env) -\u003e web.Response:\n    \"\"\"Analyze workflow JSON directly without requiring file on disk.\n    \n    Used for analyzing workflows loaded in browser before save.\n    Request body: { \"workflow\": \u003cworkflow_json_object\u003e, \"name\": \"optional_name\" }\n    \"\"\"\n    try:\n        body = await request.json()\n    except Exception:\n        return web.json_response({\"error\": \"Invalid JSON body\"}, status=400)\n    \n    workflow_data = body.get(\"workflow\")\n    workflow_name = body.get(\"name\", \"unsaved\")\n    \n    if not workflow_data:\n        return web.json_response({\"error\": \"Missing workflow data\"}, status=400)\n    \n    # Parse workflow from JSON (no file needed)\n    from comfygit_core.models.workflow import Workflow\n    try:\n        workflow = Workflow.from_json(workflow_data)\n    except Exception as e:\n        return web.json_response({\"error\": f\"Invalid workflow format: {e}\"}, status=400)\n    \n    # Use WorkflowDependencyParser with Workflow object (requires cg-2ro refactor)\n    from comfygit_core.analyzers.workflow_dependency_parser import WorkflowDependencyParser\n    parser = WorkflowDependencyParser(\n        workflow=workflow,\n        workflow_name=workflow_name,\n        cec_path=env.cec_path\n    )\n    dependencies = parser.analyze_dependencies()\n    \n    # Use the same resolution logic as analyze_workflow\n    # Note: We create a temporary resolution context without pyproject access\n    # since this workflow isn't saved yet\n    result = await run_sync(\n        env.workflow_manager.resolve_workflow,\n        dependencies\n    )\n    \n    # Determine uninstalled nodes (same logic as analyze_workflow lines 641-648)\n    # For unsaved workflows, check against environment's installed packages\n    installed_packages = set(env.workflow_manager.get_installed_package_ids())\n    uninstalled_set = {\n        n.package_id for n in result.nodes_resolved \n        if n.package_id and n.package_id not in installed_packages\n    }\n    \n    # Same stats calculation as analyze_workflow (lines 652-676)\n    nodes_needing_installation = sum(\n        1 for n in result.nodes_resolved if n.package_id in uninstalled_set\n    )\n    packages_needing_installation = len(uninstalled_set)\n    needs_user_input = bool(\n        result.nodes_unresolved or result.nodes_ambiguous or\n        result.models_unresolved or result.models_ambiguous\n    )\n    download_intents_count = sum(\n        1 for m in result.models_resolved\n        if m.match_type in (\"download_intent\", \"property_download_intent\")\n    )\n    is_fully_resolved = (\n        not needs_user_input\n        and nodes_needing_installation == 0\n        and download_intents_count == 0\n    )\n    \n    # Transform to frontend format (same structure as analyze_workflow lines 678-707)\n    response = {\n        \"workflow\": workflow_name,\n        \"nodes\": {\n            \"resolved\": [_serialize_resolved_node(n, workflow_name, uninstalled_set) for n in result.nodes_resolved],\n            \"unresolved\": [_serialize_unresolved_node(n, workflow_name) for n in result.nodes_unresolved],\n            \"ambiguous\": [\n                amb for amb in [_serialize_ambiguous_node(opts, workflow_name, uninstalled_set) for opts in result.nodes_ambiguous]\n                if amb is not None\n            ]\n        },\n        \"models\": {\n            \"resolved\": [_serialize_resolved_model(m) for m in result.models_resolved],\n            \"unresolved\": [_serialize_unresolved_model(m, workflow_name) for m in result.models_unresolved],\n            \"ambiguous\": [\n                amb for amb in [_serialize_ambiguous_model(opts) for opts in result.models_ambiguous]\n                if amb is not None\n            ]\n        },\n        \"stats\": {\n            \"total_nodes\": len(result.nodes_resolved) + len(result.nodes_unresolved) + len(result.nodes_ambiguous),\n            \"total_models\": len(result.models_resolved) + len(result.models_unresolved) + len(result.models_ambiguous),\n            \"download_intents\": download_intents_count,\n            \"nodes_needing_installation\": nodes_needing_installation,\n            \"packages_needing_installation\": packages_needing_installation,\n            \"needs_user_input\": needs_user_input,\n            \"is_fully_resolved\": is_fully_resolved,\n            \"models_with_category_mismatch\": sum(1 for m in result.models_resolved if getattr(m, 'has_category_mismatch', False))\n        }\n    }\n    \n    return web.json_response(response)\n\\`\\`\\`\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- server/api/v2/workflows.py - add new endpoint after line 709 (~80 lines)\n\n**Files READ (reference only):**\n- server/api/v2/workflows.py (lines 624-709) - existing analyze_workflow for reference\n- server/api/v2/workflows.py (lines 720-760) - _serialize_* helper functions\n- server/cgm_core/decorators.py - requires_environment decorator\n\n**Files CREATED:**\n- None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Frontend extension registration bead cgm-z5o.2 (no file overlap)\n- Frontend popup component bead cgm-z5o.3 (no file overlap)\n\n**Cannot Run In Parallel With:**\n- Any other bead modifying workflows.py\n\n**Blocking Reason:**\n- Frontend needs this endpoint to get analysis results for in-browser workflows\n- **CRITICAL:** Depends on core library bead cg-2ro being completed first (WorkflowDependencyParser refactor)\n\n## Estimated Scope\n- **Size:** Medium (80-100 lines)\n- **Risk:** Low (new endpoint, doesn't modify existing code, reuses existing helpers)\n\n## Acceptance Criteria\n- [ ] Endpoint accepts POST with workflow JSON in body\n- [ ] Returns 400 if workflow data is missing or invalid\n- [ ] Returns 400 if workflow JSON can't be parsed (malformed)\n- [ ] Returns analysis results matching /workflow/{name}/analyze format exactly\n- [ ] Works with workflows containing subgraphs (ComfyUI v1.24.3+)\n- [ ] Node types correctly classified as builtin vs custom\n- [ ] Model references extracted with URLs from properties.models\n- [ ] Uninstalled packages correctly identified\n\n## Testing Requirements\n- Add test in testing/integration/panel/test_workflows.py\n- Test with valid workflow JSON (use existing test fixtures)\n- Test with invalid/malformed JSON\n- Test with workflow containing subgraphs\n- Verify response format matches existing analyze endpoint\n- Test with workflow that has missing nodes\n- Test with workflow that has missing models\n\n## Notes on Dependencies\n\nThis endpoint will NOT work until cg-2ro is complete. The call:\n\\`\\`\\`python\nparser = WorkflowDependencyParser(\n    workflow=workflow,  # Workflow object, not Path\n    ...\n)\n\\`\\`\\`\n...requires the refactored constructor that accepts Workflow objects.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-23T00:36:05.506281441-05:00","created_by":"ubuntu","updated_at":"2026-01-23T01:36:51.218972805-05:00","closed_at":"2026-01-23T01:36:51.218972805-05:00","close_reason":"Endpoint implemented with 12 passing tests. Uses core library's refactored WorkflowDependencyParser (cg-2ro).","dependencies":[{"issue_id":"cgm-z5o.1","depends_on_id":"cgm-z5o","type":"parent-child","created_at":"2026-01-23T00:36:05.507351558-05:00","created_by":"ubuntu"}]}
{"id":"cgm-z5o.2","title":"Register ComfyGit extension to intercept workflow load","notes":"## Context \u0026 Goal\n\nRegister a ComfyGit extension with ComfyUI's extension system to:\n1. Disable ComfyUI's built-in missing nodes/models warning popups\n2. Hook into beforeConfigureGraph to capture workflow data when workflows are loaded\n3. Trigger ComfyGit's own analysis flow\n\n**Why it matters:** This is the entry point for the \"intercept missing resources popup\" feature. Without this, ComfyUI shows its own popups which download models to wrong locations.\n\n## Current State vs Target State\n\n**Current:** ComfyGit registers extension `Comfy.ComfyGitPanel` in main.ts (lines 479-789) with a `setup()` hook. It does NOT hook into workflow loading.\n\n**Target:** Extend the existing extension registration to:\n1. Hook beforeConfigureGraph to disable ComfyUI warnings and capture workflow\n2. Dispatch custom event that our popup component can listen to\n\n## Target Code\n\nModify the existing extension in `frontend/src/main.ts` around line 480:\n\n\\`\\`\\`typescript\n// Register extension\napp.registerExtension({\n  name: 'Comfy.ComfyGitPanel',\n\n  // NEW: Hook into workflow loading to intercept missing resources\n  async beforeConfigureGraph(graphData, missingNodeTypes) {\n    // Disable ComfyUI's built-in popups by modifying the workflow data\n    // Note: We can't directly access settingStore from our bundle, \n    // but we can intercept here before the dialogs are shown\n    \n    // Store for later use by afterConfigureGraph\n    (window as any).__comfygit_pending_workflow = {\n      graphData,\n      missingNodeTypes,\n      timestamp: Date.now()\n    }\n  },\n\n  async afterConfigureGraph(missingNodeTypes) {\n    const pending = (window as any).__comfygit_pending_workflow\n    if (!pending) return\n    delete (window as any).__comfygit_pending_workflow\n    \n    // Dispatch event for our popup component\n    window.dispatchEvent(new CustomEvent('comfygit:workflow-loaded', {\n      detail: {\n        workflow: pending.graphData,\n        missingNodeTypes: missingNodeTypes,\n        timestamp: pending.timestamp\n      }\n    }))\n  },\n\n  async setup() {\n    // ... existing setup code (unchanged)\n  }\n})\n\\`\\`\\`\n\n**CRITICAL INSIGHT:** We cannot easily access ComfyUI's `useSettingStore` from our bundle because it's part of their Vue app context. However, looking at the ComfyUI source, the settings are checked INSIDE `loadGraphData()` right before showing dialogs. The extension hooks `beforeConfigureGraph` and `afterConfigureGraph` are called during this process.\n\n**Alternative approach if settings can't be disabled:** Show our popup AFTER ComfyUI's popup appears, then immediately close ComfyUI's using DOM manipulation:\n\\`\\`\\`typescript\n// In afterConfigureGraph, after a small delay:\nsetTimeout(() =\u003e {\n  // Find and close ComfyUI's dialog\n  const comfyDialog = document.querySelector('[data-dialog-key=\"global-missing-nodes\"]')\n  if (comfyDialog) {\n    // Close it programmatically\n    comfyDialog.closest('.p-dialog')?.remove()\n  }\n}, 100)\n\\`\\`\\`\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- frontend/src/main.ts (lines 479-490) - add beforeConfigureGraph and afterConfigureGraph hooks to existing extension\n\n**Files CREATED:**\n- None (reusing existing extension registration)\n\n**Files READ (reference only):**\n- /tmp/ComfyUI_frontend/src/types/comfy.ts (lines 232-243) - ComfyExtension interface for hook signatures\n- /tmp/ComfyUI_frontend/src/scripts/app.ts - how hooks are called\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend endpoint bead cgm-z5o.1 (different files)\n- Popup component bead cgm-z5o.3 (different files, though this bead is logically prerequisite)\n\n**Cannot Run In Parallel With:**\n- Any bead modifying main.ts\n\n**Blocking Reason:**\n- Popup component needs this to receive the workflow-loaded event\n\n## Estimated Scope\n- **Size:** Small (~30-40 lines added to existing code)\n- **Risk:** Medium (interacts with ComfyUI's internal APIs which may change)\n\n## Acceptance Criteria\n- [ ] Extension hooks beforeConfigureGraph and afterConfigureGraph are registered\n- [ ] Custom event 'comfygit:workflow-loaded' is dispatched with workflow data\n- [ ] Event contains graphData (the workflow JSON) and missingNodeTypes array\n- [ ] No errors in console when ComfyUI loads\n- [ ] Works with both new workflows and loaded workflows\n- [ ] Works with workflows containing subgraphs\n\n## Testing Requirements\n- Manual testing: Load ComfyUI, load a workflow, verify console shows event dispatch\n- Manual testing: Verify event.detail.workflow contains actual workflow data\n- Manual testing: Verify event.detail.missingNodeTypes contains any missing nodes\n- E2E test: Playwright test that verifies event is dispatched on workflow load\n\n## Important Notes\n\n1. **ComfyExtension interface** (from /tmp/ComfyUI_frontend/src/types/comfy.ts:232-243):\n   - beforeConfigureGraph(graphData: ComfyWorkflowJSON, missingNodeTypes: MissingNodeType[]): Promise\u003cvoid\u003e | void\n   - afterConfigureGraph(missingNodeTypes: MissingNodeType[]): Promise\u003cvoid\u003e | void\n\n2. **MissingNodeType** is either a string or an object with type/hint/action\n\n3. **Settings issue**: ComfyUI's settings are in a Pinia store that we don't have access to from our standalone bundle. We may need to explore alternative approaches like:\n   - Using ComfyUI's internal API if exposed\n   - DOM manipulation to close their dialogs\n   - Local storage settings (ComfyUI may read from localStorage)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-23T00:36:35.511077745-05:00","created_by":"ubuntu","updated_at":"2026-01-23T01:24:48.053429728-05:00","closed_at":"2026-01-23T01:24:48.053429728-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-z5o.2","depends_on_id":"cgm-z5o","type":"parent-child","created_at":"2026-01-23T00:36:35.511790153-05:00","created_by":"ubuntu"}]}
{"id":"cgm-z5o.3","title":"Create MissingResourcesPopup Vue component","notes":"## Context \u0026 Goal\n\nCreate a Vue component that shows when a workflow is loaded with missing nodes or models. This replaces ComfyUI's built-in popup with ComfyGit's own UI that:\n1. Uses ComfyGit's backend for accurate analysis\n2. Downloads models to correct ComfyGit-managed locations\n3. Installs nodes through ComfyGit's managed environment\n\n**Why it matters:** The built-in ComfyUI popup downloads models to a \"downloads\" folder and doesn't integrate with ComfyGit's environment management.\n\n## Current State vs Target State\n\n**Current:** No popup component for missing resources when loading workflows. ComfyUI shows its own popup.\n\n**Target:** New Vue component that:\n1. Listens for 'comfygit:workflow-loaded' event (dispatched by cgm-z5o.2)\n2. Calls /v2/comfygit/workflow/analyze-json endpoint (created by cgm-z5o.1)\n3. If issues found, shows modal with resolution options\n4. Integrates with existing resolution flow\n\n## Target Code\n\nCreate `frontend/src/components/MissingResourcesPopup.vue`:\n\n\\`\\`\\`vue\n\u003ctemplate\u003e\n  \u003cBaseModal \n    v-model:visible=\"isVisible\" \n    header=\"Missing Dependencies\"\n    :style=\"{ width: '500px' }\"\n    :closable=\"true\"\n    @hide=\"dismiss\"\n  \u003e\n    \u003cdiv v-if=\"loading\" class=\"loading-state\"\u003e\n      \u003ci class=\"pi pi-spin pi-spinner\" style=\"font-size: 1.5rem\" /\u003e\n      \u003cspan style=\"margin-left: 8px\"\u003eAnalyzing workflow...\u003c/span\u003e\n    \u003c/div\u003e\n    \n    \u003cdiv v-else-if=\"analysis \u0026\u0026 hasIssues\" class=\"analysis-results\"\u003e\n      \u003c!-- Missing Nodes Section --\u003e\n      \u003cdiv v-if=\"missingNodes.length \u003e 0\" class=\"section\"\u003e\n        \u003cdiv class=\"section-header\"\u003e\n          \u003cspan class=\"section-icon\"\u003e📦\u003c/span\u003e\n          \u003cspan\u003eMissing Custom Nodes ({{ missingNodes.length }})\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"item-list\"\u003e\n          \u003cdiv v-for=\"node in missingNodes.slice(0, 5)\" :key=\"node.node_type\" class=\"item\"\u003e\n            \u003ccode class=\"node-type\"\u003e{{ node.node_type }}\u003c/code\u003e\n            \u003cspan v-if=\"node.package_id\" class=\"package-info\"\u003e\n              → {{ node.package_title || node.package_id }}\n            \u003c/span\u003e\n            \u003cspan v-else class=\"not-found\"\u003eNot found in registry\u003c/span\u003e\n          \u003c/div\u003e\n          \u003cdiv v-if=\"missingNodes.length \u003e 5\" class=\"overflow-note\"\u003e\n            ...and {{ missingNodes.length - 5 }} more\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \n      \u003c!-- Missing Models Section --\u003e\n      \u003cdiv v-if=\"missingModels.length \u003e 0\" class=\"section\"\u003e\n        \u003cdiv class=\"section-header\"\u003e\n          \u003cspan class=\"section-icon\"\u003e🎨\u003c/span\u003e\n          \u003cspan\u003eMissing Models ({{ missingModels.length }})\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"item-list\"\u003e\n          \u003cdiv v-for=\"model in missingModels.slice(0, 5)\" :key=\"model.widget_value\" class=\"item\"\u003e\n            \u003cspan class=\"model-name\"\u003e{{ model.widget_value }}\u003c/span\u003e\n            \u003cspan v-if=\"model.has_download_url\" class=\"has-url\"\u003e\n              \u003ci class=\"pi pi-download\" /\u003e Can auto-download\n            \u003c/span\u003e\n            \u003cspan v-else class=\"no-url\"\u003eManual download required\u003c/span\u003e\n          \u003c/div\u003e\n          \u003cdiv v-if=\"missingModels.length \u003e 5\" class=\"overflow-note\"\u003e\n            ...and {{ missingModels.length - 5 }} more\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \n      \u003c!-- Actions --\u003e\n      \u003cdiv class=\"actions\"\u003e\n        \u003cBaseButton @click=\"openPanel\" label=\"Open ComfyGit Panel\" /\u003e\n        \u003cBaseButton @click=\"dismiss\" label=\"Dismiss\" severity=\"secondary\" /\u003e\n      \u003c/div\u003e\n      \n      \u003c!-- Tip --\u003e\n      \u003cdiv class=\"tip\"\u003e\n        \u003ci class=\"pi pi-info-circle\" /\u003e\n        \u003cspan\u003eSave this workflow to track it in ComfyGit and enable dependency resolution.\u003c/span\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n    \n    \u003cdiv v-else-if=\"error\" class=\"error-state\"\u003e\n      \u003ci class=\"pi pi-exclamation-triangle\" /\u003e\n      \u003cspan\u003e{{ error }}\u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/BaseModal\u003e\n\u003c/template\u003e\n\n\u003cscript setup lang=\"ts\"\u003e\nimport { ref, computed, onMounted, onUnmounted } from 'vue'\nimport BaseModal from './base/BaseModal.vue'\nimport BaseButton from './base/BaseButton.vue'\n\ninterface WorkflowLoadedEvent extends CustomEvent {\n  detail: {\n    workflow: any\n    missingNodeTypes: (string | { type: string })[]\n    timestamp: number\n  }\n}\n\nconst isVisible = ref(false)\nconst loading = ref(false)\nconst error = ref\u003cstring | null\u003e(null)\nconst analysis = ref\u003cany\u003e(null)\n\nconst hasIssues = computed(() =\u003e {\n  return missingNodes.value.length \u003e 0 || missingModels.value.length \u003e 0\n})\n\nconst missingNodes = computed(() =\u003e {\n  if (!analysis.value) return []\n  // Nodes that aren't installed\n  const resolved = analysis.value.nodes.resolved.filter((n: any) =\u003e !n.is_installed)\n  const unresolved = analysis.value.nodes.unresolved\n  return [...resolved, ...unresolved]\n})\n\nconst missingModels = computed(() =\u003e {\n  if (!analysis.value) return []\n  // Models that need download or aren't resolved\n  const needsDownload = analysis.value.models.resolved.filter((m: any) =\u003e \n    m.match_type === 'download_intent' || \n    m.match_type === 'property_download_intent' ||\n    m.match_type === 'not_found'\n  )\n  const unresolved = analysis.value.models.unresolved.map((m: any) =\u003e ({\n    ...m.reference,\n    has_download_url: false\n  }))\n  return [...needsDownload, ...unresolved]\n})\n\nasync function handleWorkflowLoaded(event: WorkflowLoadedEvent) {\n  const { workflow, missingNodeTypes } = event.detail\n  \n  // Quick check: if ComfyUI found no missing nodes, might still have missing models\n  // Always analyze to be sure, but only show UI if there are issues\n  loading.value = true\n  error.value = null\n  isVisible.value = true\n  \n  try {\n    // Call our backend endpoint\n    const response = await fetch('/v2/comfygit/workflow/analyze-json', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ workflow, name: 'unsaved' })\n    })\n    \n    if (!response.ok) {\n      const err = await response.json()\n      throw new Error(err.error || 'Failed to analyze workflow')\n    }\n    \n    analysis.value = await response.json()\n    \n    // Auto-dismiss if no issues found\n    if (!hasIssues.value) {\n      isVisible.value = false\n    }\n  } catch (e) {\n    console.error('[ComfyGit] Failed to analyze workflow:', e)\n    error.value = e instanceof Error ? e.message : 'Unknown error'\n    // Don't show error UI for now - just log and dismiss\n    isVisible.value = false\n  } finally {\n    loading.value = false\n  }\n}\n\nfunction openPanel() {\n  // Use existing showPanel function via custom event\n  // main.ts listens for this and calls showPanel()\n  window.dispatchEvent(new CustomEvent('comfygit:open-panel', {\n    detail: { initialView: 'workflows' }\n  }))\n  isVisible.value = false\n}\n\nfunction dismiss() {\n  isVisible.value = false\n  analysis.value = null\n}\n\nonMounted(() =\u003e {\n  window.addEventListener('comfygit:workflow-loaded', handleWorkflowLoaded as EventListener)\n})\n\nonUnmounted(() =\u003e {\n  window.removeEventListener('comfygit:workflow-loaded', handleWorkflowLoaded as EventListener)\n})\n\u003c/script\u003e\n\n\u003cstyle scoped\u003e\n.loading-state {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n}\n\n.section {\n  margin-bottom: 1rem;\n}\n\n.section-header {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n\n.section-icon {\n  font-size: 1.2rem;\n}\n\n.item-list {\n  background: var(--surface-ground);\n  border-radius: 4px;\n  padding: 0.5rem;\n}\n\n.item {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.25rem 0.5rem;\n  font-size: 0.875rem;\n}\n\n.node-type {\n  font-family: monospace;\n  background: var(--surface-100);\n  padding: 0.125rem 0.375rem;\n  border-radius: 2px;\n}\n\n.package-info {\n  color: var(--primary-color);\n}\n\n.not-found, .no-url {\n  color: var(--orange-500);\n  font-style: italic;\n}\n\n.has-url {\n  color: var(--green-500);\n}\n\n.overflow-note {\n  padding: 0.25rem 0.5rem;\n  color: var(--text-color-secondary);\n  font-style: italic;\n}\n\n.actions {\n  display: flex;\n  gap: 0.5rem;\n  justify-content: flex-end;\n  margin-top: 1rem;\n}\n\n.tip {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-top: 1rem;\n  padding: 0.5rem;\n  background: var(--surface-ground);\n  border-radius: 4px;\n  font-size: 0.875rem;\n  color: var(--text-color-secondary);\n}\n\n.error-state {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 1rem;\n  color: var(--red-500);\n}\n\u003c/style\u003e\n\\`\\`\\`\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- frontend/src/main.ts - mount popup component and add event listener for open-panel (~15 lines)\n\n**Files CREATED:**\n- frontend/src/components/MissingResourcesPopup.vue - new component (~180 lines)\n\n**Files READ (reference only):**\n- frontend/src/components/WorkflowResolveModal.vue - reference for styling patterns\n- frontend/src/components/base/BaseModal.vue - modal component\n- frontend/src/components/base/BaseButton.vue - button component\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend endpoint bead cgm-z5o.1 (different files)\n\n**Cannot Run In Parallel With:**\n- Integration bead cgm-z5o.4 (both modify main.ts)\n\n**Blocking Reason:**\n- This component is part of the final integration, but the Vue component itself can be developed independently\n\n## Estimated Scope\n- **Size:** Medium (180-200 lines)\n- **Risk:** Low (new component following existing patterns)\n\n## Acceptance Criteria\n- [ ] Component listens for 'comfygit:workflow-loaded' event\n- [ ] Shows loading state while analyzing\n- [ ] Displays missing nodes with package suggestions\n- [ ] Displays missing models with download availability indicator\n- [ ] \"Open ComfyGit Panel\" button dispatches 'comfygit:open-panel' event\n- [ ] Auto-dismisses if no issues found\n- [ ] Styled consistently with existing ComfyGit UI (BaseModal, etc.)\n- [ ] Limits displayed items to 5 with \"and X more\" overflow\n\n## Testing Requirements\n- Manual testing: Load workflow with missing nodes, verify popup appears\n- Manual testing: Verify missing nodes/models are listed correctly\n- Manual testing: Verify \"Open ComfyGit Panel\" opens the panel to workflows view\n- Manual testing: Verify popup auto-dismisses for valid workflow\n- E2E test: Playwright test for popup flow\n\n## Design Notes\n\nThe popup should be lightweight and informational. It's NOT meant to be the full resolution wizard. Instead, it:\n1. Alerts the user that dependencies are missing\n2. Shows a summary of what's missing (max 5 items + overflow)\n3. Directs them to the ComfyGit panel for full resolution\n\nThis keeps the popup simple while leveraging existing resolution UI in the panel.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:37:11.370320101-05:00","created_by":"ubuntu","updated_at":"2026-01-23T01:47:53.401039147-05:00","closed_at":"2026-01-23T01:47:53.401039147-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-z5o.3","depends_on_id":"cgm-z5o","type":"parent-child","created_at":"2026-01-23T00:37:11.371969529-05:00","created_by":"ubuntu"},{"issue_id":"cgm-z5o.3","depends_on_id":"cgm-z5o.2","type":"blocks","created_at":"2026-01-23T00:37:43.899434774-05:00","created_by":"ubuntu"}]}
{"id":"cgm-z5o.4","title":"Wire up missing resources flow and add service method","notes":"## Context \u0026 Goal\n\nComplete the missing resources flow by:\n1. Mounting MissingResourcesPopup in main.ts\n2. Adding event listener for 'comfygit:open-panel' to open panel from popup\n3. Ensuring event flow works end-to-end\n\n**Why it matters:** This connects all the pieces together into a working feature.\n\n## Current State vs Target State\n\n**Current:** Individual pieces exist but aren't connected:\n- cgm-z5o.1: Backend endpoint exists\n- cgm-z5o.2: Extension hooks dispatch 'comfygit:workflow-loaded' event\n- cgm-z5o.3: Popup component exists but isn't mounted\n\n**Target:** Complete flow:\n1. User loads workflow → extension hooks fire → event dispatched\n2. Popup receives event → calls backend → shows results\n3. User clicks \"Open Panel\" → popup dispatches event → panel opens\n\n## Target Code\n\n### Add to main.ts (after line 44):\n\n\\`\\`\\`typescript\nimport MissingResourcesPopup from './components/MissingResourcesPopup.vue'\n\n// Missing resources popup container\nlet missingResourcesContainer: HTMLElement | null = null\nlet missingResourcesApp: ReturnType\u003ctypeof createApp\u003e | null = null\n\\`\\`\\`\n\n### Add to setup() function (around line 524, after mountDownloadQueue()):\n\n\\`\\`\\`typescript\n// Mount missing resources popup\nmountMissingResourcesPopup()\n\n// Listen for open-panel event from popup\nwindow.addEventListener('comfygit:open-panel', (event: CustomEvent) =\u003e {\n  const initialView = event.detail?.initialView\n  showPanel(initialView)\n})\n\\`\\`\\`\n\n### Add new function (after mountDownloadQueue function, around line 288):\n\n\\`\\`\\`typescript\nfunction mountMissingResourcesPopup() {\n  if (missingResourcesContainer) return // Already mounted\n\n  missingResourcesContainer = document.createElement('div')\n  missingResourcesContainer.className = 'comfygit-missing-resources-root'\n\n  missingResourcesApp = createApp({\n    render: () =\u003e h(MissingResourcesPopup)\n  })\n\n  missingResourcesApp.mount(missingResourcesContainer)\n  document.body.appendChild(missingResourcesContainer)\n  console.log('[ComfyGit] Missing resources popup mounted')\n}\n\\`\\`\\`\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- frontend/src/main.ts - add import, mount popup, add event listener (~20 lines)\n\n**Files READ (reference only):**\n- frontend/src/components/MissingResourcesPopup.vue - verify integration\n- frontend/src/main.ts (existing pattern at lines 274-287) - mountDownloadQueue for reference\n\n**Files CREATED:**\n- None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Nothing - this is the final integration bead\n\n**Cannot Run In Parallel With:**\n- cgm-z5o.3 (popup component) - must be complete first\n- Any bead modifying main.ts\n\n**Blocking Reason:**\n- This is the final integration bead - depends on cgm-z5o.1, cgm-z5o.2, cgm-z5o.3\n\n## Estimated Scope\n- **Size:** Small (~20 lines)\n- **Risk:** Low (straightforward wiring following existing patterns)\n\n## Acceptance Criteria\n- [ ] MissingResourcesPopup is imported in main.ts\n- [ ] mountMissingResourcesPopup function exists and is called in setup()\n- [ ] 'comfygit:open-panel' event listener opens panel with initialView\n- [ ] Complete flow works: load workflow → see popup (if issues) → click \"Open Panel\" → panel opens\n- [ ] Build succeeds without errors\n- [ ] No console errors during flow\n\n## Testing Requirements\n- Manual E2E test: full flow from workflow load to popup to panel\n- Verify popup appears for workflow with missing nodes\n- Verify popup auto-dismisses for valid workflow\n- Verify \"Open Panel\" opens to workflows view\n- Verify production build works\n\n## Integration Checklist\n\n1. [ ] Extension dispatches 'comfygit:workflow-loaded' on workflow load (cgm-z5o.2)\n2. [ ] Popup receives event and calls backend (cgm-z5o.3)\n3. [ ] Backend returns analysis in correct format (cgm-z5o.1)\n4. [ ] Popup displays results correctly (cgm-z5o.3)\n5. [ ] \"Open Panel\" dispatches 'comfygit:open-panel' event (cgm-z5o.3)\n6. [ ] main.ts listens for 'comfygit:open-panel' and calls showPanel() (this bead)\n7. [ ] Panel opens to workflows view (existing functionality)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:37:35.37763413-05:00","created_by":"ubuntu","updated_at":"2026-01-23T01:57:01.228959432-05:00","closed_at":"2026-01-23T01:57:01.228959432-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-z5o.4","depends_on_id":"cgm-z5o","type":"parent-child","created_at":"2026-01-23T00:37:35.378382446-05:00","created_by":"ubuntu"},{"issue_id":"cgm-z5o.4","depends_on_id":"cgm-z5o.1","type":"blocks","created_at":"2026-01-23T00:37:57.492032854-05:00","created_by":"ubuntu"},{"issue_id":"cgm-z5o.4","depends_on_id":"cgm-z5o.2","type":"blocks","created_at":"2026-01-23T00:37:57.504389317-05:00","created_by":"ubuntu"},{"issue_id":"cgm-z5o.4","depends_on_id":"cgm-z5o.3","type":"blocks","created_at":"2026-01-23T00:37:57.517964204-05:00","created_by":"ubuntu"}]}
