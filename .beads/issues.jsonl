{"id":"cgm-0qc","title":"Add HuggingFace repo-info and subdirectories endpoints","notes":"## Context \u0026 Goal\n\nAdd two backend endpoints to support the HuggingFace repo browser modal:\n1. `/v2/workspace/huggingface/repo-info` - Lists files in an HF repo with sizes\n2. `/v2/workspace/models/subdirectories` - Lists available model directories for destination picker\n\n## Current State vs Target State\n\n**Current** (`/data/projects/comfygit-ai/comfygit-manager/server/api/v2/models.py`):\nNo HuggingFace-related endpoints exist.\n\n**Target** - Add after existing endpoints (around line 400):\n\n```python\nimport os\nimport re\nfrom huggingface_hub import HfApi\nfrom comfygit_core.configs.model_config import ModelConfig\n\nHF_MODEL_EXTS_EXTRA = [\".gguf\"]\n\ndef _shard_group(path: str) -\u003e str | None:\n    \"\"\"Detect sharded model files like model-00001-of-00003.safetensors\"\"\"\n    m = re.match(r\"^(.*)-(\\d{4,5})-of-(\\d{4,5})(\\.[^.]+)$\", path, flags=re.IGNORECASE)\n    if not m:\n        return None\n    return f\"{m.group(1)}{m.group(4)}\"\n\ndef _parse_hf_repo_url(url: str) -\u003e tuple[str, str]:\n    \"\"\"Extract repo_id and revision from HuggingFace URL.\"\"\"\n    from urllib.parse import urlparse\n    p = urlparse(url)\n    host = (p.hostname or \"\").lower()\n    if host not in (\"huggingface.co\", \"hf.co\") and not host.endswith(\".huggingface.co\"):\n        raise ValueError(\"Not a HuggingFace URL\")\n\n    parts = [s for s in p.path.split(\"/\") if s]\n    if len(parts) \u003c 2:\n        raise ValueError(\"Invalid HuggingFace URL\")\n    if parts[0] in (\"datasets\", \"spaces\"):\n        raise ValueError(\"Only model repositories are supported\")\n\n    repo_id = f\"{parts[0]}/{parts[1]}\"\n    revision = \"main\"\n    if len(parts) \u003e= 4 and parts[2] == \"tree\":\n        revision = parts[3] or \"main\"\n    return repo_id, revision\n\n@routes.get(\"/v2/workspace/huggingface/repo-info\")\n@requires_environment\nasync def workspace_huggingface_repo_info(request: web.Request, env) -\u003e web.Response:\n    \"\"\"Get file listing for a HuggingFace repository.\"\"\"\n    url = (request.query.get(\"url\") or \"\").strip()\n    if not url:\n        return web.json_response({\"error\": \"Missing required query param: url\"}, status=400)\n\n    try:\n        repo_id, revision = _parse_hf_repo_url(url)\n    except Exception as e:\n        return web.json_response({\"error\": str(e)}, status=400)\n\n    token = os.environ.get(\"HF_TOKEN\") or os.environ.get(\"HUGGINGFACE_TOKEN\")\n    api = HfApi(token=token if token else None)\n\n    try:\n        info = api.model_info(repo_id=repo_id, revision=revision, files_metadata=True)\n    except Exception as e:\n        error_str = str(e)\n        if \"401\" in error_str or \"403\" in error_str:\n            return web.json_response({\n                \"error\": \"This repository requires authentication. Set HF_TOKEN environment variable.\"\n            }, status=401)\n        return web.json_response({\"error\": f\"Failed to fetch repo info: {e}\"}, status=400)\n\n    model_cfg = ModelConfig.load()\n    model_exts = set([e.lower() for e in (model_cfg.default_extensions or [])] + HF_MODEL_EXTS_EXTRA)\n\n    files = []\n    for sib in (info.siblings or []):\n        path = getattr(sib, \"rfilename\", None)\n        if not path:\n            continue\n        size = getattr(sib, \"size\", None) or 0\n        lower = path.lower()\n        is_model_file = any(lower.endswith(ext) for ext in model_exts)\n        files.append({\n            \"path\": path,\n            \"size\": size,\n            \"is_model_file\": is_model_file,\n            \"shard_group\": _shard_group(path),\n        })\n\n    return web.json_response({\n        \"repo_id\": repo_id,\n        \"revision\": revision,\n        \"files\": files,\n    })\n\n@routes.get(\"/v2/workspace/models/subdirectories\")\n@requires_environment\nasync def workspace_models_subdirectories(request: web.Request, env) -\u003e web.Response:\n    \"\"\"List available model subdirectories for destination picker.\"\"\"\n    model_cfg = ModelConfig.load()\n    standard = list(model_cfg.standard_directories or [])\n\n    models_dir = None\n    try:\n        models_dir = env.workspace.workspace_config_manager.get_models_directory()\n    except Exception:\n        pass\n\n    existing = []\n    if models_dir and models_dir.exists():\n        try:\n            existing = sorted([\n                p.name for p in models_dir.iterdir()\n                if p.is_dir() and not p.name.startswith(\".\")\n            ])\n        except Exception:\n            existing = []\n\n    merged = sorted(set(standard) | set(existing))\n\n    return web.json_response({\n        \"directories\": merged,\n        \"standard\": standard,\n        \"existing\": existing,\n    })\n```\n\n## Files Inventory\n\n**Files MODIFIED:**\n- /data/projects/comfygit-ai/comfygit-manager/server/api/v2/models.py (add ~100 lines)\n\n**Files READ:**\n- /data/projects/comfygit-ai/comfygit/packages/core/src/comfygit_core/configs/model_config.py (for ModelConfig import)\n\n**Files CREATED:** None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Frontend beads (different codebase)\n\n**Cannot Run In Parallel With:**\n- Any other bead modifying models.py (none planned)\n\n**Blocking Reason:** Frontend service methods need these endpoints to exist\n\n## Estimated Scope\n- **Size:** Medium (~100 lines)\n- **Risk:** Medium (uses external HF API)\n\n## Acceptance Criteria\n- [ ] Both endpoints registered and responding\n- [ ] `/v2/workspace/huggingface/repo-info?url=https://huggingface.co/microsoft/VibeVoice-1.5B` returns file list\n- [ ] `/v2/workspace/models/subdirectories` returns directories array\n- [ ] Gated repos return helpful 401 error message\n- [ ] Uses `@requires_environment` decorator pattern\n\n## Testing Requirements\n- Manual curl tests against running server\n- Test with both public and gated repos (if HF_TOKEN available)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T03:50:09.232319043-05:00","created_by":"ubuntu","updated_at":"2026-01-27T03:50:09.232319043-05:00","dependencies":[{"issue_id":"cgm-0qc","depends_on_id":"cgm-4pl","type":"blocks","created_at":"2026-01-27T03:52:06.855473828-05:00","created_by":"ubuntu"}]}
{"id":"cgm-1cj","title":"Improve workflow resolution modal UX for download intents","notes":"# Epic: Workflow Resolution Modal UX Improvements\n\n## Problem Statement\n\nWhen a workflow has models with embedded download URLs (via `properties.models` in ComfyUI nodes), the resolution modal UX is confusing:\n\n1. **Analysis step**: Shows \"3 pending download\" correctly ✓\n2. **Models step**: Shows empty \"No models need resolution\" - user has no choices to make but must click through\n3. **Review step**: Shows \"0 to download\" even though 3 models WILL download when Apply is clicked\n4. **Too many clicks**: User clicks through 4 screens when they only need 2 (Analysis → Review → Apply)\n\n## Solution\n\n1. **Fix download count** - Review step should count pending download intents\n2. **Skip Models step** - When only download intents exist (no user choices), skip directly to Review\n3. **Show download details** - Review step should show exactly what will be downloaded (filename, URL, path)\n4. **Update navigation** - Button text and navigation logic should reflect the streamlined flow\n\n## Success Criteria\n\n- Users with download-intent-only workflows see: Analysis → Review → Apply (3 clicks)\n- Review step accurately shows \"X to download\" matching actual download count\n- Review step shows detailed list of what will be downloaded\n- Existing flows with unresolved/ambiguous models still work correctly\n\n## Child Tasks\n\n- cgm-447: Fix downloadCount computed\n- comfygit-manager-yah: Skip Models step when only intents\n- comfygit-manager-n2o: Add download details section\n- comfygit-manager-xii: Update navigation logic\n- comfygit-manager-29f: Update button text\n- comfygit-manager-8y2: E2E test coverage","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-22T14:30:02.870833171-05:00","created_by":"ubuntu","updated_at":"2026-01-22T15:48:40.44174231-05:00","closed_at":"2026-01-22T15:48:40.44174231-05:00","close_reason":"All 6 child tasks completed. Post-fix applied for property_download_intent match type (see cgm-447 comment)."}
{"id":"cgm-1vv","title":"Update ModelDownloader to use hf_hub_download and validate paths","notes":"## Context \u0026 Goal\n\nUpdate the core ModelDownloader.download() method to:\n1. Reject HuggingFace repo browser URLs (`/tree/main`) with helpful error\n2. Use `hf_hub_download()` for HF file URLs (enables Xet storage optimization)\n3. Validate target paths to prevent \"Is a directory\" crash\n4. Hardlink from HF cache when possible, copy otherwise\n\nThis fixes the original bug where user pasted repo URL and got `[Errno 21] Is a directory`.\n\n## Current State vs Target State\n\n**Current** (`/data/projects/comfygit-ai/comfygit/packages/core/src/comfygit_core/services/model_downloader.py`):\n- Uses `requests.get()` for all downloads\n- No HF URL validation\n- No target path directory check\n- Crashes with EISDIR if target is a directory\n\n**Target** - Modify download() method:\n\n**1. Add imports at top:**\n```python\nimport os\nfrom uuid import uuid4\n\nfrom huggingface_hub import hf_hub_download\nfrom tqdm.auto import tqdm\n\nfrom .huggingface_url import parse_huggingface_url\n```\n\n**2. Add target path validation (after Step 1 check, around line 278):**\n```python\n# Step 2: Validate target path\ntarget_path = request.target_path\n\n# Guard: target path must be within models dir\ntry:\n    models_root = self.models_dir.resolve()\n    resolved_target = target_path.resolve()\n    if models_root != resolved_target and models_root not in resolved_target.parents:\n        raise ValueError(\"Target path must be within the models directory.\")\nexcept FileNotFoundError:\n    pass  # resolve() can fail if parent does not exist; handled after mkdir\n\n# Guard: user gave a directory -\u003e error\nif target_path.exists() and target_path.is_dir():\n    raise ValueError(\n        f\"Target path '{target_path}' is a directory. \"\n        \"Please include a filename (e.g. checkpoints/model.safetensors).\"\n    )\nif target_path.suffix == \"\":\n    raise ValueError(\n        f\"Target path '{target_path}' does not look like a file path. \"\n        \"Please include a filename (e.g. checkpoints/model.safetensors).\"\n    )\n\ntarget_path.parent.mkdir(parents=True, exist_ok=True)\n```\n\n**3. Replace download logic (after validation, around line 293):**\n```python\n# Step 3-4: Download\nurl_type = self.detect_url_type(request.url)\n\nif url_type == \"huggingface\":\n    parsed = parse_huggingface_url(request.url)\n\n    if parsed.kind == \"repo\":\n        raise ValueError(\n            \"This HuggingFace URL points to a repository page (e.g. /tree/main). \"\n            \"Use the HuggingFace repo browser in the UI to select files, \"\n            \"or provide a direct /resolve/ URL.\"\n        )\n    if parsed.kind != \"file\" or not parsed.repo_id or not parsed.path_in_repo:\n        raise ValueError(\"Invalid HuggingFace file URL.\")\n\n    token = os.environ.get(\"HF_TOKEN\") or os.environ.get(\"HUGGINGFACE_TOKEN\")\n\n    def _make_tqdm_class(cb):\n        class _CbTqdm(tqdm):\n            def __init__(self, *args, **kwargs):\n                kwargs.setdefault(\"disable\", True)\n                super().__init__(*args, **kwargs)\n\n            def update(self, n=1):\n                super().update(n)\n                if cb and self.total:\n                    cb(int(self.n), int(self.total))\n        return _CbTqdm\n\n    # Download to HF cache (xet-enabled when available)\n    cache_path_str = hf_hub_download(\n        repo_id=parsed.repo_id,\n        filename=parsed.path_in_repo,\n        revision=parsed.revision or \"main\",\n        token=token if token else None,\n        tqdm_class=_make_tqdm_class(progress_callback),\n    )\n\n    cache_path = Path(cache_path_str).resolve()\n\n    # Stage in same dir for atomic replace\n    temp_path = target_path.with_name(f\".{target_path.name}.tmp-{uuid4().hex}\")\n    try:\n        # Hardlink if possible (fast, no extra disk usage on same filesystem)\n        try:\n            os.link(str(cache_path), str(temp_path))\n            # Hash from temp_path\n            hasher = blake3()\n            file_size = 0\n            with open(temp_path, \"rb\") as f:\n                for chunk in iter(lambda: f.read(1024 * 1024), b\"\"):\n                    hasher.update(chunk)\n                    file_size += len(chunk)\n        except OSError:\n            # Fall back to copy+hash (different filesystem)\n            hasher = blake3()\n            file_size = 0\n            with open(cache_path, \"rb\") as src, open(temp_path, \"wb\") as dst:\n                for chunk in iter(lambda: src.read(1024 * 1024), b\"\"):\n                    dst.write(chunk)\n                    hasher.update(chunk)\n                    file_size += len(chunk)\n\n        temp_path.replace(target_path)\n        temp_path = None\n    finally:\n        if temp_path and temp_path.exists():\n            try:\n                temp_path.unlink()\n            except Exception:\n                pass\n\n    # Continue with existing registration/indexing using file_size, hasher.hexdigest(), target_path\n    # ... (rest of method unchanged - Step 5 onwards)\n\nelse:\n    # Existing requests.get streaming download for Civitai/custom URLs\n    # ... (unchanged)\n```\n\n## Files Inventory\n\n**Files MODIFIED:**\n- /data/projects/comfygit-ai/comfygit/packages/core/src/comfygit_core/services/model_downloader.py (~100 lines changed)\n\n**Files READ:**\n- /data/projects/comfygit-ai/comfygit/packages/core/src/comfygit_core/services/huggingface_url.py (import)\n\n**Files CREATED:** None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Frontend beads (different codebase)\n- Backend endpoint bead (different file)\n\n**Cannot Run In Parallel With:**\n- Must wait for: huggingface_url.py to exist, huggingface_hub dependency to be installed\n\n**Blocking Reason:** None - this is a leaf task\n\n## Estimated Scope\n- **Size:** Large (~100 lines changed)\n- **Risk:** High (core download logic, affects all downloads)\n\n## Acceptance Criteria\n- [ ] HF repo URLs (`/tree/main`) rejected with helpful error message\n- [ ] HF file URLs (`/resolve/main/...`) downloaded via hf_hub_download\n- [ ] Directory target paths rejected with helpful error\n- [ ] Hardlink used when possible (same filesystem as HF cache)\n- [ ] Copy fallback works for different filesystems\n- [ ] Progress callback still works\n- [ ] Existing Civitai/custom URL downloads unchanged\n- [ ] Model indexed correctly after download\n\n## Testing Requirements\n- Unit tests for path validation\n- Integration test with HF file URL\n- Test repo URL rejection\n- Test directory target path rejection\n- Verify existing download tests still pass","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T03:51:54.886152038-05:00","created_by":"ubuntu","updated_at":"2026-01-27T03:51:54.886152038-05:00","dependencies":[{"issue_id":"cgm-1vv","depends_on_id":"cgm-4pl","type":"blocks","created_at":"2026-01-27T03:52:09.843556273-05:00","created_by":"ubuntu"},{"issue_id":"cgm-1vv","depends_on_id":"cgm-i4i","type":"blocks","created_at":"2026-01-27T03:52:09.864249564-05:00","created_by":"ubuntu"}]}
{"id":"cgm-29f","title":"Update Analysis step banner to say 'Continue to Review' when no user input needed","notes":"# Context \u0026 Goal\n\n## Problem\nThe Analysis step shows a banner \"3 models pending download - click Continue to review\" but if we're skipping the Models step, the button should say \"Continue to Review\" not just \"Continue\". This provides clearer UX about where the user is going.\n\n## Why It Matters\nSmall polish that helps users understand the streamlined flow. When models step is skipped, users should know they're going directly to review.\n\n## How It Serves Project Goals\nClear, predictable UX with appropriate labeling.\n\n---\n\n# Current State vs Target State\n\n## Current Code\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue`\n\nThe Continue button in footer and any banner text should reflect the actual next step.\n\n## Target Code\n\nUpdate button label to be dynamic:\n\n```vue\n\u003cBaseButton variant=\"primary\" @click=\"handleContinueFromAnalysis\"\u003e\n  {{ nextStepFromAnalysis === 'review' ? 'Continue to Review →' : 'Continue' }}\n\u003c/BaseButton\u003e\n```\n\nAdd computed:\n\n```typescript\nconst nextStepFromAnalysis = computed(() =\u003e {\n  if (needsNodeResolution.value || hasNodesToInstall.value) {\n    return 'nodes'\n  } else if (needsModelResolution.value) {\n    return 'models'\n  }\n  return 'review'\n})\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue`\n  - Template: Update Continue button text in footer\n  - Script: Add nextStepFromAnalysis computed\n\n**Files READ (reference only):**\n- None\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- cgm-447 (different computed)\n- comfygit-manager-n2o (different section)\n\n**Cannot Run In Parallel With:**\n- comfygit-manager-yah, comfygit-manager-xii - should be done after those\n\n**Blocking Reason:**\n- Depends on skip-models decision being finalized\n\n---\n\n# Estimated Scope\n\n- **Size:** Small (\u003c30 lines)\n- **Risk:** Low (UI text only)\n\n---\n\n# Acceptance Criteria\n\n- [ ] When going to Review directly, button says \"Continue to Review →\"\n- [ ] When going to Nodes or Models, button says \"Continue\"\n- [ ] Banner text matches button behavior\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open workflow with only download intents\n2. Verify button says \"Continue to Review →\"\n3. Open workflow with unresolved models\n4. Verify button says \"Continue\"","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T14:29:23.557392012-05:00","created_by":"ubuntu","updated_at":"2026-01-22T15:11:05.277396165-05:00","closed_at":"2026-01-22T15:11:05.277396165-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-29f","depends_on_id":"cgm-xii","type":"blocks","created_at":"2026-01-22T14:29:27.833642938-05:00","created_by":"ubuntu"},{"issue_id":"cgm-29f","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.824596243-05:00","created_by":"ubuntu"}]}
{"id":"cgm-38y","title":"Update MissingResourcesPopup to use is-saved endpoint","notes":"## Context \u0026 Goal\n\n**Problem:** MissingResourcesPopup currently checks `workflow?.path || workflow?.filename` which is always false because `beforeConfigureGraph` only receives raw JSON without file metadata.\n\n**Solution:** Call new `/v2/comfygit/workflow/is-saved` endpoint to detect saved workflows via content hash matching.\n\n**Why it matters:** Popup should only appear for unsaved workflows - saved ones are tracked in ComfyGit panel.\n\n---\n\n## Current State vs Target State\n\n### Current: `frontend/src/components/MissingResourcesPopup.vue` lines 398-403\n\n```typescript\nasync function analyzeWorkflow(workflow: any) {\n  // Skip for saved workflows - issues tracked in ComfyGit panel\n  if (workflow?.path || workflow?.filename) {\n    console.log('[ComfyGit] Workflow saved to disk, skipping popup')\n    return\n  }\n```\n\n### Target: Replace path check with API call\n\n```typescript\nasync function analyzeWorkflow(workflow: any) {\n  // Skip if user globally disabled popup\n  if (localStorage.getItem('comfygit:popup-disabled') === 'true') {\n    console.log('[ComfyGit] Popup globally disabled')\n    return\n  }\n\n  // Check if this workflow is saved on disk via content hash\n  try {\n    const response = await fetch('/v2/comfygit/workflow/is-saved', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ workflow })\n    })\n    if (response.ok) {\n      const result = await response.json()\n      if (result.is_saved) {\n        console.log(\\`[ComfyGit] Workflow matches saved file: \\${result.filename}, skipping popup\\`)\n        return\n      }\n    }\n  } catch (e) {\n    console.warn('[ComfyGit] Failed to check if workflow is saved:', e)\n    // On error, proceed with popup (safe default)\n  }\n  // ...\n```\n\n---\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/MissingResourcesPopup.vue` (lines 398-403) - Replace path check with API call\n\n**Files CREATED:**\n- None\n\n**Files READ (reference only):**\n- None\n\n---\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend bead (cgm-kg0) - no file overlap\n\n**Cannot Run In Parallel With:**\n- None (but requires backend endpoint to exist for testing)\n\n**Blocking Reason:** \n- Backend endpoint must exist for integration testing, but code changes don't conflict\n\n---\n\n## Estimated Scope\n- **Size:** Small (~15 lines changed)\n- **Risk:** Low (isolated change in single function)\n\n---\n\n## Acceptance Criteria\n- [ ] Popup skips for saved workflows (API returns `is_saved: true`)\n- [ ] Popup shows for unsaved/modified workflows\n- [ ] Popup shows if API call fails (safe fallback)\n- [ ] Frontend build succeeds\n\n---\n\n## Testing Requirements\n- Manual: Load saved workflow → no popup\n- Manual: Load unsaved workflow with missing nodes → popup appears\n- Manual: Modify saved workflow → popup appears (hash no longer matches)\n- Manual: Disable network → popup still works (fallback behavior)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-26T22:17:34.929999482-05:00","created_by":"ubuntu","updated_at":"2026-01-26T23:00:19.316521067-05:00","closed_at":"2026-01-26T23:00:19.316521067-05:00","close_reason":"Implemented in sprint run-1769484386145645150. Backend endpoint + frontend integration complete with 7 tests.","dependencies":[{"issue_id":"cgm-38y","depends_on_id":"cgm-kg0","type":"blocks","created_at":"2026-01-26T22:17:42.332259383-05:00","created_by":"ubuntu"}]}
{"id":"cgm-447","title":"Fix downloadCount to include pending download intents","notes":"# Context \u0026 Goal\n\n## Problem\nThe Review step shows \"0 to download\" in the summary stats even when 3 models have download intents and WILL be downloaded when the user clicks \"Apply Resolution\". This is misleading and confusing.\n\n## Why It Matters\nUsers see incorrect information before committing to an action. They might think nothing will happen, but clicking Apply actually triggers downloads. This erodes trust in the UI.\n\n## How It Serves Project Goals\nComfyGit aims to give users clear visibility and control over their workflow dependencies. Accurate counts are fundamental to that.\n\n---\n\n# Current State vs Target State\n\n## Current Code (PROBLEM)\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue` (lines 636-642)\n\n```typescript\nconst downloadCount = computed(() =\u003e {\n  let count = 0\n  for (const choice of modelChoices.value.values()) {\n    if (choice.action === 'download') count++\n  }\n  return count\n})\n```\n\nThis ONLY counts models where user explicitly made a choice with `action === 'download'`. Download intents (models with URLs from workflow properties) that the user didn't modify are NOT counted.\n\n## Target Code (SOLUTION)\n\n```typescript\nconst downloadCount = computed(() =\u003e {\n  let count = 0\n  \n  // Count explicit user download choices\n  for (const choice of modelChoices.value.values()) {\n    if (choice.action === 'download') count++\n  }\n  \n  // Count download intents that user hasn't cancelled\n  // These will be downloaded even without explicit user action\n  for (const model of downloadIntentModels.value) {\n    const choice = modelChoices.value.get(model.filename)\n    // If no choice made, intent is preserved (will download)\n    // If choice is cancel_download, it won't download (don't count)\n    if (!choice || (choice.action !== 'cancel_download' \u0026\u0026 choice.action !== 'skip' \u0026\u0026 choice.action !== 'optional')) {\n      // Only count if not already counted via explicit download choice\n      if (!choice || choice.action !== 'download') {\n        count++\n      }\n    }\n  }\n  \n  return count\n})\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue` (lines 636-642) - Fix downloadCount computed property\n\n**Files READ (reference only):**\n- `frontend/src/components/WorkflowResolveModal.vue` (lines 531-543) - downloadIntentModels computed property (already exists, reuse)\n- `frontend/src/types/comfygit.ts` - ModelChoice type definition\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- Nothing else modifies this specific computed property\n\n**Cannot Run In Parallel With:**\n- Any other task modifying WorkflowResolveModal.vue lines 620-700\n\n**Blocking Reason:**\n- None - this is a leaf task\n\n---\n\n# Estimated Scope\n\n- **Size:** Small (\u003c50 lines) - single computed property change\n- **Risk:** Low (isolated computation, doesn't affect other logic)\n\n---\n\n# Acceptance Criteria\n\n- [ ] When 3 models have download intents and user makes no changes, Review shows \"3 to download\"\n- [ ] When user cancels one download intent, Review shows \"2 to download\"\n- [ ] When user explicitly sets download action on an intent, it's counted once (not double)\n- [ ] Existing behavior for user-initiated downloads (not intents) unchanged\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open a workflow with models that have `property_download_intent` match type\n2. Click through to Review step without making any choices\n3. Verify \"X to download\" matches actual download intent count\n4. Go back, cancel one intent, verify count decreases","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-22T14:28:11.373610644-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:47:14.170541297-05:00","closed_at":"2026-01-22T14:47:14.170541297-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-447","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.767619632-05:00","created_by":"ubuntu"}],"comments":[{"id":1,"issue_id":"cgm-447","author":"ubuntu","text":"**Post-implementation fix (2026-01-22):** Original implementation only filtered for `match_type === 'download_intent'` but backend returns TWO match types for download intents: `download_intent` (from pyproject.toml) and `property_download_intent` (from workflow node properties/embedded URLs). Fixed `downloadIntentModels` computed to check for both: `m.match_type === 'download_intent' || m.match_type === 'property_download_intent'`. The E2E test mocked only `download_intent` so the gap wasn't caught until real-world testing.","created_at":"2026-01-22T20:48:33Z"}]}
{"id":"cgm-46e","title":"Test issue for worktree verification","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T18:57:30.926391833-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:39:25.944016425-05:00","closed_at":"2026-01-14T18:58:20.008630164-05:00","close_reason":"Tested from worktree - closing to verify sync"}
{"id":"cgm-4pl","title":"Add huggingface_hub dependency to comfygit-core","notes":"## Context \u0026 Goal\n\nAdd `huggingface_hub\u003e=0.32.0` as a dependency to comfygit-core. This enables:\n- Official HuggingFace Hub API for listing repo files\n- `hf_hub_download()` for downloading with Xet storage optimization\n- Proper caching semantics\n\n## Current State vs Target State\n\n**Current** (`/data/projects/comfygit-ai/comfygit/packages/core/pyproject.toml`):\n```toml\n[project]\ndependencies = [\n    \"aiohttp\",\n    \"blake3\",\n    \"packaging\",\n    \"psutil\",\n    \"pyyaml\",\n    \"requests\",\n    \"requirements-parser\",\n    \"tomlkit\",\n    \"uv\",\n    \"xxhash\",\n]\n```\n\n**Target**:\n```toml\n[project]\ndependencies = [\n    \"aiohttp\",\n    \"blake3\",\n    \"huggingface_hub\u003e=0.32.0\",\n    \"packaging\",\n    \"psutil\",\n    \"pyyaml\",\n    \"requests\",\n    \"requirements-parser\",\n    \"tomlkit\",\n    \"uv\",\n    \"xxhash\",\n]\n```\n\n## Files Inventory\n\n**Files MODIFIED:**\n- /data/projects/comfygit-ai/comfygit/packages/core/pyproject.toml - add dependency\n\n**Files READ:** None\n\n**Files CREATED:** None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- All Phase 1 beads (no file overlap)\n\n**Cannot Run In Parallel With:** None\n\n**Blocking Reason:** Core library beads need this dependency installed first\n\n## Estimated Scope\n- **Size:** Small (\u003c10 lines)\n- **Risk:** Low (additive change)\n\n## Acceptance Criteria\n- [ ] `huggingface_hub\u003e=0.32.0` added to dependencies list (alphabetically sorted)\n- [ ] `uv sync` succeeds in core package directory\n- [ ] `from huggingface_hub import HfApi, hf_hub_download` works in Python\n\n## Testing Requirements\n- Run `uv sync` in `/data/projects/comfygit-ai/comfygit/packages/core`\n- Verify import works: `uv run python -c \"from huggingface_hub import HfApi\"` ","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T03:48:44.945873995-05:00","created_by":"ubuntu","updated_at":"2026-01-27T03:48:44.945873995-05:00"}
{"id":"cgm-4r7","title":"Write property_download_intent models to pyproject.toml in apply_resolution","notes":"## Context \u0026 Goal\n\n**Problem:** When a workflow has models with embedded download URLs (`property_download_intent` from node `properties.models`), clicking \"Apply Resolution\" doesn't write them to pyproject.toml. This means when the download completes, `_finalize_download` can't find them to update their status from \"unresolved\" to \"resolved\".\n\n**User sees:** After download completes, workflow still shows \"missing models\" until they save the workflow (Ctrl+S) which triggers a re-analysis.\n\n**Root cause traced in discussion:**\n- `property_download_intent` models are in `result.models_resolved` (not unresolved/ambiguous)\n- `apply_resolution` only calls `fix_resolution` when `result.has_issues` is True\n- `ResolutionResult.has_issues` doesn't include download intents (only unresolved/ambiguous)\n- `fix_resolution` only processes `models_unresolved` and `models_ambiguous`, not `models_resolved`\n- So `property_download_intent` models never get written to pyproject.toml\n\n## Current State vs Target State\n\n**Current code** (`server/api/v2/workflows.py`, lines 839-846):\n```python\n# Apply strategies to fix unresolved issues (writes to pyproject.toml)\nif result.has_issues:\n    result = await run_sync(\n        env.workflow_manager.fix_resolution,\n        result,\n        node_strategy,\n        model_strategy\n    )\n```\n\n**Target state:** Add a new block after the fix_resolution call (around line 895, after model choices handling) to write `property_download_intent` models:\n\n```python\n# Write property_download_intent models to pyproject (they're in models_resolved, not processed by fix_resolution)\nfrom comfygit_core.models.manifest import ManifestWorkflowModel\ntry:\n    for model in result.models_resolved:\n        if model.match_type == \"property_download_intent\" and model.model_source:\n            # Check if already in pyproject (avoid duplicates)\n            existing_models = env.pyproject.workflows.get_workflow_models(name)\n            already_exists = any(\n                m.filename == model.reference.widget_value and m.sources\n                for m in existing_models\n            )\n            if not already_exists:\n                # Determine category from node type\n                category = _get_category_for_node_type(model.reference.node_type) or \"models\"\n                \n                manifest_model = ManifestWorkflowModel(\n                    filename=model.reference.widget_value,\n                    category=category,\n                    criticality=\"required\",\n                    status=\"unresolved\",\n                    nodes=[model.reference],\n                    sources=[model.model_source],\n                    relative_path=str(model.target_path) if model.target_path else None\n                )\n                env.pyproject.workflows.add_workflow_model(name, manifest_model)\nexcept Exception:\n    pass  # Continue even if write fails - downloads will still work\n```\n\nAlso need a helper function for category:\n```python\ndef _get_category_for_node_type(node_type: str) -\u003e str | None:\n    \"\"\"Infer model category from loader node type.\"\"\"\n    node_type_lower = node_type.lower()\n    if \"checkpoint\" in node_type_lower:\n        return \"checkpoints\"\n    elif \"vae\" in node_type_lower:\n        return \"vae\"\n    elif \"lora\" in node_type_lower:\n        return \"loras\"\n    elif \"clip\" in node_type_lower:\n        return \"clip\"\n    elif \"controlnet\" in node_type_lower:\n        return \"controlnet\"\n    elif \"upscale\" in node_type_lower:\n        return \"upscale_models\"\n    return None\n```\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- server/api/v2/workflows.py (around lines 895-930) - add property_download_intent write logic\n\n**Files READ (reference only):**\n- comfygit_core/managers/workflow_manager.py:217-266 - reference for _write_model_resolution_grouped pattern\n- comfygit_core/models/manifest.py - ManifestWorkflowModel import\n\n**Files CREATED:** None\n\n## Parallelization Info\n\n**Can Run In Parallel With:** Any non-workflows.py backend tasks\n\n**Cannot Run In Parallel With:** Any other task modifying server/api/v2/workflows.py\n\n**Blocking Reason:** None - this is a standalone fix\n\n## Estimated Scope\n- **Size:** Small (\u003c50 lines)\n- **Risk:** Medium (touches apply_resolution which is core workflow)\n\n## Acceptance Criteria\n\n- [ ] After clicking \"Apply Resolution\" on a workflow with property_download_intent models, those models appear in pyproject.toml under [workflow.models.\u003cworkflow-name\u003e]\n- [ ] The models have status=\"unresolved\" and sources=[url]\n- [ ] When download completes, _finalize_download finds and updates them to status=\"resolved\"\n- [ ] Workflow status updates automatically without needing to save/re-open\n- [ ] Existing download_intent (from pyproject) behavior unchanged\n- [ ] No duplicate entries created if user re-runs resolution\n\n## Testing Requirements\n\n**Manual Verification:**\n1. Open a workflow with models that have embedded URLs (property_download_intent)\n2. Go through resolution wizard, click Apply Resolution\n3. Check pyproject.toml - model should be listed with status=\"unresolved\" and sources=[url]\n4. Wait for download to complete\n5. Re-open panel - workflow should show resolved (no missing models)\n6. Do NOT need to save workflow (Ctrl+S) for this to work\n\n**Existing tests:** testing/integration/panel/test_workflow_endpoints.py covers apply_resolution but may need new test case\n\n**New test:** Add test case that verifies property_download_intent models are written to pyproject","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-22T20:58:24.394520078-05:00","created_by":"ubuntu","updated_at":"2026-01-22T21:04:12.022671057-05:00","closed_at":"2026-01-22T21:04:12.022671057-05:00","close_reason":"Implemented property_download_intent write to pyproject.toml in apply_resolution. Added helper function _get_category_for_node_type() and new code block to write models before download starts. All 46 workflow tests pass."}
{"id":"cgm-8bc","title":"Wire HuggingFace detection into ModelIndexSection download modal","notes":"## Context \u0026 Goal\n\nModify the existing download modal in ModelIndexSection.vue to:\n1. Detect when user pastes a HuggingFace repo URL\n2. Show \"Browse Repo Files\" button instead of target path input\n3. Open HuggingFaceRepoModal when clicked\n4. Add target path validation to prevent \"Is a directory\" errors\n\n## Current State vs Target State\n\n**Current** (`/data/projects/comfygit-ai/comfygit-manager/frontend/src/components/ModelIndexSection.vue`):\n- Simple download modal with URL + target path inputs (lines 176-216)\n- State variables at lines 269-271: showDownloadModal, downloadUrl, downloadTargetPath\n- No HF URL detection\n- No target path validation\n\n**Target** - Modify existing component:\n\n**1. Add imports (script section, around line 237-238):**\n```typescript\nimport HuggingFaceRepoModal from '@/components/HuggingFaceRepoModal.vue'\nimport { parseHuggingFaceUrl } from '@/utils/huggingface'\n```\n\n**2. Add state (after line 271):**\n```typescript\nconst showHfRepoModal = ref(false)\nconst hfRepoUrl = ref('')\n```\n\n**3. Add computed for HF detection + path validation (after line 271):**\n```typescript\nconst hfParsed = computed(() =\u003e parseHuggingFaceUrl(downloadUrl.value))\nconst isHfRepoUrl = computed(() =\u003e hfParsed.value.kind === 'repo' \u0026\u0026 !!hfParsed.value.repoId)\n\nconst targetPathError = computed(() =\u003e {\n  const p = downloadTargetPath.value.trim()\n  if (!p) return null\n  const last = p.replace(/\\\\\\\\/g, '/').split('/').pop() || ''\n  const hasExt = last.includes('.') \u0026\u0026 !last.endsWith('.')\n  if (!hasExt) {\n    return 'Target path must include a filename (e.g. checkpoints/model.safetensors).'\n  }\n  return null\n})\n```\n\n**4. Add methods (after handleDownloadModel around line 391):**\n```typescript\nfunction openHfRepoModal() {\n  hfRepoUrl.value = downloadUrl.value.trim()\n  showHfRepoModal.value = true\n  showDownloadModal.value = false\n}\n\nfunction handleQueueHfRepo(items: Array\u003c{ workflow: string; filename: string; url: string; targetPath: string; size?: number; type?: string }\u003e) {\n  addToQueue(items)\n  showHfRepoModal.value = false\n  hfRepoUrl.value = ''\n  downloadUrl.value = ''\n  downloadTargetPath.value = ''\n}\n```\n\n**5. Update handleDownloadModel to check for repo URLs (modify existing function at line 374):**\n```typescript\nfunction handleDownloadModel() {\n  if (!downloadUrl.value.trim() || !downloadTargetPath.value.trim()) return\n  \n  const parsed = parseHuggingFaceUrl(downloadUrl.value.trim())\n  if (parsed.kind === 'repo') {\n    openHfRepoModal()\n    return\n  }\n  // ... rest unchanged\n}\n```\n\n**6. Update template - download modal body (replace lines 183-200):**\n```vue\n\u003cdiv class=\"modal-body\"\u003e\n  \u003cdiv class=\"input-group\"\u003e\n    \u003clabel\u003eDownload URL\u003c/label\u003e\n    \u003cBaseInput v-model=\"downloadUrl\" placeholder=\"https://huggingface.co/user/repo or https://.../resolve/...\" /\u003e\n  \u003c/div\u003e\n\n  \u003ctemplate v-if=\"isHfRepoUrl\"\u003e\n    \u003cp class=\"modal-note\"\u003e\n      HuggingFace repository detected. Click \u003cstrong\u003eBrowse Repo Files\u003c/strong\u003e to pick files.\n    \u003c/p\u003e\n  \u003c/template\u003e\n\n  \u003ctemplate v-else\u003e\n    \u003cdiv class=\"input-group\"\u003e\n      \u003clabel\u003eTarget Path (relative to models directory)\u003c/label\u003e\n      \u003cBaseInput v-model=\"downloadTargetPath\" placeholder=\"e.g. checkpoints/model.safetensors\" /\u003e\n      \u003cp v-if=\"targetPathError\" class=\"modal-error\"\u003e{{ targetPathError }}\u003c/p\u003e\n    \u003c/div\u003e\n    \u003cp class=\"modal-note\"\u003eModel will be queued for background download.\u003c/p\u003e\n  \u003c/template\u003e\n\u003c/div\u003e\n```\n\n**7. Update template - download modal footer (replace lines 202-212):**\n```vue\n\u003cdiv class=\"modal-footer\"\u003e\n  \u003cBaseButton variant=\"secondary\" @click=\"showDownloadModal = false\"\u003eCancel\u003c/BaseButton\u003e\n  \u003cBaseButton v-if=\"isHfRepoUrl\" variant=\"primary\" :disabled=\"!downloadUrl.trim()\" @click=\"openHfRepoModal\"\u003e\n    Browse Repo Files\n  \u003c/BaseButton\u003e\n  \u003cBaseButton v-else variant=\"primary\" :disabled=\"!downloadUrl.trim() || !downloadTargetPath.trim() || !!targetPathError\" @click=\"handleDownloadModel\"\u003e\n    Queue Download\n  \u003c/BaseButton\u003e\n\u003c/div\u003e\n```\n\n**8. Add HF modal near other modals (after line 216, before \u003c/template\u003e):**\n```vue\n\u003cHuggingFaceRepoModal\n  :show=\"showHfRepoModal\"\n  :url=\"hfRepoUrl\"\n  @close=\"showHfRepoModal = false\"\n  @queue=\"handleQueueHfRepo\"\n/\u003e\n```\n\n**9. Add CSS for error state (in \u003cstyle scoped\u003e section):**\n```css\n.modal-error {\n  font-size: 12px;\n  color: var(--cg-color-error);\n  margin-top: 4px;\n}\n```\n\n## Files Inventory\n\n**Files MODIFIED:**\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/components/ModelIndexSection.vue (~80 lines changed)\n\n**Files READ:**\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/utils/huggingface.ts (import)\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/components/HuggingFaceRepoModal.vue (import)\n\n**Files CREATED:** None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend beads (different codebase)\n- Core library beads (different codebase)\n\n**Cannot Run In Parallel With:**\n- Must wait for: HuggingFaceRepoModal.vue, utils/huggingface.ts, types to exist\n\n**Blocking Reason:** This is the final integration point\n\n## Estimated Scope\n- **Size:** Medium (~80 lines changed)\n- **Risk:** Medium (modifies existing UI flow)\n\n## Acceptance Criteria\n- [ ] Pasting HF repo URL shows \"Browse Repo Files\" button\n- [ ] Pasting direct URL shows target path input\n- [ ] Target path without filename shows error\n- [ ] \"Browse Repo Files\" opens HuggingFaceRepoModal\n- [ ] Downloads queued from modal appear in download queue\n- [ ] Direct download (non-repo URL) still works\n\n## Testing Requirements\n- Test with HF repo URL: `https://huggingface.co/microsoft/VibeVoice-1.5B`\n- Test with direct URL: `https://huggingface.co/owner/repo/resolve/main/model.safetensors`\n- Test with non-HF URL: `https://civitai.com/...`\n- Test target path validation with directory-like paths","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T03:51:18.364387817-05:00","created_by":"ubuntu","updated_at":"2026-01-27T14:22:24.222567124-05:00","dependencies":[{"issue_id":"cgm-8bc","depends_on_id":"cgm-ft3","type":"blocks","created_at":"2026-01-27T03:52:17.942434882-05:00","created_by":"ubuntu"},{"issue_id":"cgm-8bc","depends_on_id":"cgm-v93","type":"blocks","created_at":"2026-01-27T03:52:17.966000996-05:00","created_by":"ubuntu"}]}
{"id":"cgm-8y2","title":"Add E2E test for download-intent-only workflow resolution flow","notes":"# Context \u0026 Goal\n\n## Problem\nWe need automated test coverage for the new UX flow where workflows with only download intents skip the Models step and show accurate counts in Review.\n\n## Why It Matters\nRegression protection for the UX improvements. Without tests, future changes could break the streamlined flow.\n\n## How It Serves Project Goals\nTest coverage for critical user workflow.\n\n---\n\n# Current State vs Target State\n\n## Current State\nNo E2E test specifically for download-intent-only resolution flow.\n\n## Target State\nE2E test that:\n1. Opens a workflow with models that have property_download_intent\n2. Verifies Analysis shows correct pending download count\n3. Verifies clicking Continue skips Models step\n4. Verifies Review shows correct \"X to download\" count\n5. Verifies \"Models to Download\" section shows correct details\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- None\n\n**Files READ (reference only):**\n- `e2e/tests/` - existing E2E test patterns\n- `testing/` - existing test helpers\n\n**Files CREATED:**\n- `e2e/tests/workflow-resolution-download-intents.spec.ts` - new E2E test file\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- All other beads (test file is independent)\n\n**Cannot Run In Parallel With:**\n- None\n\n**Blocking Reason:**\n- Should run AFTER all UX changes are complete to test final behavior\n\n---\n\n# Estimated Scope\n\n- **Size:** Medium (50-100 lines)\n- **Risk:** Low (additive test)\n\n---\n\n# Acceptance Criteria\n\n- [ ] E2E test exists and passes\n- [ ] Test covers Analysis → Review skip\n- [ ] Test verifies download count accuracy\n- [ ] Test verifies download details section\n\n---\n\n# Testing Requirements\n\nThis IS the test. Run with:\n```bash\ncd e2e \u0026\u0026 npx playwright test workflow-resolution-download-intents.spec.ts\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T14:29:42.547696955-05:00","created_by":"ubuntu","updated_at":"2026-01-22T15:16:12.857276564-05:00","closed_at":"2026-01-22T15:16:12.857276564-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-8y2","depends_on_id":"cgm-447","type":"blocks","created_at":"2026-01-22T14:29:48.35113152-05:00","created_by":"ubuntu"},{"issue_id":"cgm-8y2","depends_on_id":"cgm-yah","type":"blocks","created_at":"2026-01-22T14:29:48.364508207-05:00","created_by":"ubuntu"},{"issue_id":"cgm-8y2","depends_on_id":"cgm-n2o","type":"blocks","created_at":"2026-01-22T14:29:48.378226713-05:00","created_by":"ubuntu"},{"issue_id":"cgm-8y2","depends_on_id":"cgm-xii","type":"blocks","created_at":"2026-01-22T14:29:48.392679516-05:00","created_by":"ubuntu"},{"issue_id":"cgm-8y2","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.841360198-05:00","created_by":"ubuntu"}]}
{"id":"cgm-97e","title":"Normalize match_confidence scores in search-nodes endpoint","notes":"## Context \u0026 Goal\n\n**Problem:** The `/v2/comfygit/workflow/search-nodes` endpoint returns `match_confidence` values that can exceed 1.0 (e.g., 128%), causing the frontend `ConfidenceBadge` component to display nonsensical percentages like \"128%\".\n\n**Why it matters:** Users see confusing match percentages in the resolution modal that undermine trust in the search results. Multiple items may appear with \u003e100% confidence, which is mathematically nonsensical.\n\n**Root cause:** The core library `GlobalNodeResolver._calculate_match_score()` intentionally returns unbounded scores (for internal ranking), but the server passes these raw scores directly as `match_confidence` to the frontend.\n\n## Current State vs Target State\n\n**Current code** (`server/api/v2/workflows.py` lines 889-897):\n```python\nresults = []\nfor match in matches:\n    results.append({\n        \"package_id\": match.package_id,\n        \"match_confidence\": match.score,  # RAW SCORE - can be \u003e1.0!\n        \"match_type\": match.confidence,\n        \"description\": match.package_data.description if match.package_data else None,\n        \"repository\": match.package_data.repository if match.package_data else None,\n        \"is_installed\": match.package_id in installed\n    })\n```\n\n**Target code:**\n```python\n# Normalize scores to 0.0-1.0 range for frontend display\n# Find max score for normalization (minimum 1.0 to avoid division issues)\nmax_score = max((m.score for m in matches), default=1.0)\nmax_score = max(max_score, 1.0)  # Ensure at least 1.0\n\nresults = []\nfor match in matches:\n    # Normalize: highest score becomes 1.0, others scale proportionally\n    normalized_confidence = match.score / max_score\n    results.append({\n        \"package_id\": match.package_id,\n        \"match_confidence\": normalized_confidence,\n        \"match_type\": match.confidence,\n        \"description\": match.package_data.description if match.package_data else None,\n        \"repository\": match.package_data.repository if match.package_data else None,\n        \"is_installed\": match.package_id in installed\n    })\n```\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- `server/api/v2/workflows.py` (lines 889-897) - Add score normalization in search_nodes endpoint\n\n**Files READ (reference only):**\n- `frontend/src/components/base/atoms/ConfidenceBadge.vue` - Understand expected input range (0.0-1.0)\n- `.venv/lib/python3.14/site-packages/comfygit_core/resolvers/global_node_resolver.py` - Understand score calculation\n\n**Files CREATED:**\n- None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- All beads that dont touch `server/api/v2/workflows.py` search_nodes function\n- Frontend-only beads (NodeResolutionStep, ModelResolutionStep)\n\n**Cannot Run In Parallel With:**\n- Any other bead modifying `search_nodes()` function in workflows.py\n\n**Blocking Reason:** None - this is a leaf task\n\n## Estimated Scope\n- **Size:** Small (\u003c20 lines changed)\n- **Risk:** Low (isolated endpoint, no shared state affected)\n\n## Acceptance Criteria\n- [ ] Search results return `match_confidence` values between 0.0 and 1.0\n- [ ] Highest-scoring result has confidence close to 1.0 (normalized max)\n- [ ] Relative ordering of results is preserved\n- [ ] ConfidenceBadge displays percentages between 0% and 100%\n- [ ] No regression in search result quality/ordering\n\n## Testing Requirements\n\n**Manual Testing:**\n1. Open resolution modal for a workflow with missing nodes\n2. Observe that potential matches show percentages ≤100%\n3. Verify the highest match shows ~100% and lower matches scale proportionally\n\n**Existing tests to verify:**\n- `testing/integration/panel/test_workflows.py` - workflow endpoints\n\n**New tests needed:**\n- Add test case for search_nodes normalization (optional - manual verification sufficient for MVP)","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-23T18:12:00.669374138-05:00","created_by":"ubuntu","updated_at":"2026-01-23T21:34:38.38001745-05:00","closed_at":"2026-01-23T21:34:38.38001745-05:00","close_reason":"Completed via sprint run-1769220521034348168"}
{"id":"cgm-ah6","title":"Issue created from worktree","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T18:58:48.059637033-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:40:52.827142291-05:00","closed_at":"2026-01-22T14:40:52.827142291-05:00","close_reason":"Placeholder issue from initial worktree setup, not needed"}
{"id":"cgm-at2","title":"Add auto-advance after node resolution selection","notes":"## Context \u0026 Goal\n\n**Problem:** After selecting a package option for a missing node in the resolution modal, the user must manually click the right arrow to advance to the next unresolved node. This creates unnecessary friction.\n\n**Why it matters:** The resolution workflow should be smooth and efficient. Auto-advancing after a selection saves clicks and makes the process feel more guided.\n\n**Design decision:** Keep arrow buttons visible so users can manually navigate back to change previous selections. Auto-advance is a convenience, not a replacement for manual navigation.\n\n## Current State vs Target State\n\n**Current code** (`frontend/src/components/base/organisms/NodeResolutionStep.vue` lines 349-363):\n```typescript\n// Handlers - no auto-advance, user navigates manually\nfunction handleMarkOptional() {\n  if (!currentNode.value) return\n  emit('mark-optional', currentNode.value.node_type)\n}\n\nfunction handleSkip() {\n  if (!currentNode.value) return\n  emit('skip', currentNode.value.node_type)\n}\n\nfunction handleOptionSelected(index: number) {\n  if (!currentNode.value) return\n  emit('option-selected', currentNode.value.node_type, index)\n}\n```\n\n**Target code:**\n```typescript\n// Auto-advance helper: find next unresolved item and navigate to it\nfunction advanceToNextUnresolved() {\n  // Find next item after current that doesnt have a choice\n  for (let i = currentIndex.value + 1; i \u003c props.nodes.length; i++) {\n    const node = props.nodes[i]\n    if (!props.nodeChoices?.has(node.node_type)) {\n      goToItem(i)\n      return\n    }\n  }\n  // No more unresolved items - stay on current (user can see completion status)\n}\n\nfunction handleMarkOptional() {\n  if (!currentNode.value) return\n  emit('mark-optional', currentNode.value.node_type)\n  // Auto-advance after making a choice\n  nextTick(() =\u003e advanceToNextUnresolved())\n}\n\nfunction handleSkip() {\n  if (!currentNode.value) return\n  emit('skip', currentNode.value.node_type)\n  // Auto-advance after making a choice\n  nextTick(() =\u003e advanceToNextUnresolved())\n}\n\nfunction handleOptionSelected(index: number) {\n  if (!currentNode.value) return\n  emit('option-selected', currentNode.value.node_type, index)\n  // Auto-advance after making a choice\n  nextTick(() =\u003e advanceToNextUnresolved())\n}\n\n// Also handle search result selection\nfunction handleSearchResultSelected(result: NodeSearchResult) {\n  if (!currentNode.value) return\n  emit('manual-entry', currentNode.value.node_type, result.package_id)\n  // Auto-advance after selection\n  nextTick(() =\u003e advanceToNextUnresolved())\n}\n```\n\n**Note:** Need to import `nextTick` from vue if not already imported.\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/base/organisms/NodeResolutionStep.vue` (lines 349-430) - Add auto-advance logic\n\n**Files READ (reference only):**\n- `frontend/src/components/base/molecules/NodeResolutionItem.vue` - Understand emitted events\n- `frontend/src/types/comfygit.ts` - NodeChoice type definition\n\n**Files CREATED:**\n- None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend-only beads (workflows.py changes)\n- ModelResolutionStep changes (separate file)\n- Any bead not touching NodeResolutionStep.vue\n\n**Cannot Run In Parallel With:**\n- Any other bead modifying NodeResolutionStep.vue\n\n**Blocking Reason:** None - this is a leaf task\n\n## Estimated Scope\n- **Size:** Small (~30 lines added)\n- **Risk:** Low (UI behavior change, easily reversible)\n\n## Acceptance Criteria\n- [ ] After selecting a package option, view auto-advances to next unresolved node\n- [ ] After marking a node as optional, view auto-advances to next unresolved node\n- [ ] After skipping a node, view auto-advances to next unresolved node\n- [ ] After selecting a search result, view auto-advances to next unresolved node\n- [ ] Arrow buttons remain visible and functional for manual back/forward navigation\n- [ ] If all nodes are resolved, view stays on current node (no error)\n- [ ] Counter still shows correct \"X/Y resolved\" status\n\n## Testing Requirements\n\n**Manual Testing:**\n1. Open resolution modal for a workflow with 2+ missing nodes\n2. Select a package for the first node\n3. Verify view auto-advances to second node\n4. Click back arrow to return to first node\n5. Verify you can change the selection\n6. Verify forward navigation still works manually\n\n**Existing tests:**\n- `frontend/src/components/__tests__/WorkflowResolveModal.test.ts`\n\n**New tests needed:**\n- Consider adding test for auto-advance behavior (optional for MVP)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-23T18:12:21.524769878-05:00","created_by":"ubuntu","updated_at":"2026-01-23T21:34:38.390435225-05:00","closed_at":"2026-01-23T21:34:38.390435225-05:00","close_reason":"Completed via sprint run-1769220521034348168"}
{"id":"cgm-bmt","title":"Route Missing Dependencies install through Manager queue API","notes":"## Context \u0026 Goal\n\n**Problem:** The Missing Dependencies popup installs nodes via direct API calls (`/v2/comfygit/nodes/{name}/install`) which fire in parallel, causing race conditions on pyproject.toml writes. Some nodes fail to be tracked, dependency groups are lost, and the UI falsely shows \"Installed\" for failed nodes.\n\n**Solution:** Route installations through the existing Manager queue system (`/v2/manager/queue/task`) which processes tasks sequentially - the same path that works correctly from the Manager UI.\n\n**Why it matters:** Users clicking \"Download All\" expect all nodes to install correctly. Currently 2-3 of 5 nodes may silently fail.\n\n---\n\n## Current State vs Target State\n\n### Current Code (BROKEN)\n\n**File:** `frontend/src/components/MissingResourcesPopup.vue` (lines 281-299, 314-320)\n\n```typescript\n// Individual install - calls direct API\nasync function installPackage(packageId: string) {\n  installingPackage.value = packageId\n  try {\n    await installNode(packageId)  // ← Direct API call\n    installedPackages.value.add(packageId)\n    installedCount.value++\n  } catch (e) {\n    console.error('[ComfyGit] Failed to install package:', e)\n  } finally {\n    installingPackage.value = null\n  }\n}\n\n// Install all - NO AWAIT = parallel fire-and-forget = race conditions\nfunction installAllNodes() {\n  for (const pkg of missingPackages.value) {\n    if (!installedPackages.value.has(pkg.package_id)) {\n      installPackage(pkg.package_id)  // ← NO await! All fire at once!\n    }\n  }\n}\n```\n\n**File:** `frontend/src/composables/useComfyGitService.ts` (lines 842-851)\n\n```typescript\nasync function installNode(nodeName: string): Promise\u003c{ status: 'success' | 'error', message?: string }\u003e {\n  return fetchApi(`/v2/comfygit/nodes/${encodeURIComponent(nodeName)}/install`, {\n    method: 'POST'\n  })  // ← Direct endpoint that races with other installs\n}\n```\n\n### Target Code (FIXED)\n\n**File:** `frontend/src/components/MissingResourcesPopup.vue`\n\n```typescript\n// NEW: Track queued packages (distinct from installing/installed)\nconst queuedPackages = ref\u003cSet\u003cstring\u003e\u003e(new Set())\n\n// NEW: Queue a single node install via Manager queue\nasync function queueInstallPackage(packageId: string) {\n  if (queuedPackages.value.has(packageId) || installedPackages.value.has(packageId)) return\n  \n  queuedPackages.value.add(packageId)\n  \n  try {\n    await queueNodeInstall({\n      id: packageId,\n      version: '',\n      selected_version: 'latest',\n      mode: 'remote',\n      channel: 'default'\n    })\n    // Don't mark as installed yet - wait for WebSocket event\n  } catch (e) {\n    queuedPackages.value.delete(packageId)\n    showToast({ type: 'error', message: `Failed to queue ${packageId}` })\n  }\n}\n\n// Install all - queue all tasks, queue processes them sequentially\nasync function installAllNodes() {\n  for (const pkg of missingPackages.value) {\n    if (!queuedPackages.value.has(pkg.package_id) \u0026\u0026 !installedPackages.value.has(pkg.package_id)) {\n      await queueInstallPackage(pkg.package_id)\n    }\n  }\n}\n\n// NEW: WebSocket handler for task completion\nfunction handleTaskCompleted(data: { ui_id: string, state: any }) {\n  // Find which package this task was for, update installedPackages or show error\n}\n```\n\n**File:** `frontend/src/composables/useComfyGitService.ts`\n\n```typescript\n// NEW: Queue node install via Manager queue API\nasync function queueNodeInstall(params: {\n  id: string\n  version: string\n  selected_version: string\n  mode: string\n  channel: string\n}): Promise\u003cvoid\u003e {\n  const task = {\n    kind: 'install',\n    params,\n    ui_id: crypto.randomUUID(),\n    client_id: 'comfygit-panel'  // or get from WebSocket\n  }\n  \n  // Queue the task\n  await fetchApi('/v2/manager/queue/task', {\n    method: 'POST',\n    body: JSON.stringify(task)\n  })\n  \n  // Start queue processing\n  await fetchApi('/v2/manager/queue/start')\n}\n```\n\n---\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/MissingResourcesPopup.vue` - Main changes: add queuedPackages state, refactor install functions to use queue, add WebSocket listener for completion events\n\n**Files MODIFIED (write):**\n- `frontend/src/composables/useComfyGitService.ts` - Add `queueNodeInstall()` function\n\n**Files READ (reference only):**\n- `legacy/ComfyUI_frontend/src/workbench/extensions/manager/services/comfyManagerService.ts` - Reference for queue API format\n- `legacy/ComfyUI_frontend/src/workbench/extensions/manager/types/generatedManagerTypes.ts` - Reference for InstallPackParams type\n- `server/comfygit_server.py` - Verify queue endpoint behavior\n\n---\n\n## Parallelization Info\n\n**Can Run In Parallel With:** None initially - this is the core change\n\n**Cannot Run In Parallel With:** bead for UI state changes (next bead) - same files\n\n**Blocking Reason:** This bead establishes the queue integration that the UI bead depends on\n\n---\n\n## Estimated Scope\n- **Size:** Medium (~100 lines changed)\n- **Risk:** Medium (changes core install flow, but backend already works)\n\n---\n\n## Acceptance Criteria\n- [ ] Clicking \"Install\" on a single node queues it via `/v2/manager/queue/task` instead of direct API\n- [ ] Clicking \"Install All\" queues all nodes, queue processes them one at a time\n- [ ] No race conditions on pyproject.toml - all nodes appear in manifest after install\n- [ ] All dependency groups are created for installed nodes\n- [ ] WebSocket events are received for task start/completion\n\n---\n\n## Testing Requirements\n- Manual test: Click \"Install All\" on 5 missing nodes, verify all 5 appear in manifest\n- Manual test: Check orchestrator logs show sequential processing (one node at a time)\n- Manual test: Nodes that require dependencies (like Depthflow) have their dependency groups written","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-24T03:05:07.589797131-05:00","created_by":"ubuntu","updated_at":"2026-01-24T03:10:43.945828858-05:00","closed_at":"2026-01-24T03:10:43.945828858-05:00","close_reason":"Implemented queue API integration for node installs. Changed from direct API calls to Manager queue API (/v2/manager/queue/task) which processes tasks sequentially, eliminating race conditions."}
{"id":"cgm-ft3","title":"Create HuggingFaceRepoModal.vue component","notes":"## Context \u0026 Goal\n\nCreate the main UI component for browsing HuggingFace repository files. Users can:\n- See all files in a repo with sizes\n- Filter to model files only\n- Auto-select model files (including all shards of sharded models)\n- Choose destination directory from dropdown or enter custom path\n- Queue selected files for download\n\n## Current State vs Target State\n\n**Current**: Component does not exist\n\n**Target** - Create `/data/projects/comfygit-ai/comfygit-manager/frontend/src/components/HuggingFaceRepoModal.vue`\n\nThis is a large component (~400 lines). Key features:\n\n**Template Structure:**\n- Modal overlay with close on backdrop click\n- Header: repo name, revision pill\n- Body:\n  - Toolbar: search input, model/all toggle, auto-select/clear buttons\n  - File list: checkbox, path, size columns (needs max-height + scroll)\n  - Destination section: base directory dropdown + subfolder input OR custom path\n  - Summary: selected count + total size\n- Footer: Cancel + Queue Download buttons\n\n**Script Logic:**\n- Props: `show: boolean`, `url: string`\n- Emits: `close`, `queue` (array of download items)\n- Uses: `useComfyGitService` for API calls\n- State: files[], selected Set, destBase, destSubfolder, destCustom\n- Shard detection: regex `/^(.*)-(\\d{4,5})-of-(\\d{4,5})(\\.[^.]+)$/i`\n- Auto-select expands shard groups\n\n**Styling:**\n- Use CSS variables (--cg-color-*, --cg-radius-*, etc.)\n- File list needs `max-height: 300px; overflow-y: auto;` for large repos\n\nSee full implementation in context pack. Key imports:\n```typescript\nimport BaseInput from '@/components/base/BaseInput.vue'\nimport BaseButton from '@/components/base/BaseButton.vue'\nimport BaseSelect from '@/components/base/BaseSelect.vue'\nimport { useComfyGitService } from '@/composables/useComfyGitService'\nimport { buildHfResolveUrl, parseHuggingFaceUrl } from '@/utils/huggingface'\n```\n\n## Files Inventory\n\n**Files MODIFIED:** None\n\n**Files READ:**\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/components/base/BaseSelect.vue (for SelectOption interface)\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/components/base/BaseInput.vue\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/components/base/BaseButton.vue\n\n**Files CREATED:**\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/components/HuggingFaceRepoModal.vue\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend beads (different codebase)\n- Core library beads (different codebase)\n\n**Cannot Run In Parallel With:**\n- ModelIndexSection.vue modifications (both in frontend/src/components, but different files - CAN run in parallel)\n\n**Blocking Reason:** ModelIndexSection.vue needs to import and use this component\n\n## Estimated Scope\n- **Size:** Large (~400 lines)\n- **Risk:** Medium (complex UI state management)\n\n## Acceptance Criteria\n- [ ] Component renders modal when show=true\n- [ ] Loads and displays files from API\n- [ ] Model files filter works\n- [ ] Shard group selection works (selecting one selects all)\n- [ ] Auto-select model files button works\n- [ ] Destination dropdown populated from API\n- [ ] Custom path option works\n- [ ] Queue Download button emits correct items array\n- [ ] File list scrollable for large repos (max-height)\n\n## Testing Requirements\n- Manual testing with various HF repos:\n  - Small repo (few files)\n  - Large repo with many files (test scrolling)\n  - Sharded model repo (test auto-selection)\n- Test destination path options\n- Verify emitted download items have correct URLs and paths","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T03:50:48.224778166-05:00","created_by":"ubuntu","updated_at":"2026-01-27T03:50:48.224778166-05:00","dependencies":[{"issue_id":"cgm-ft3","depends_on_id":"cgm-v93","type":"blocks","created_at":"2026-01-27T03:52:16.615058485-05:00","created_by":"ubuntu"},{"issue_id":"cgm-ft3","depends_on_id":"cgm-tuo","type":"blocks","created_at":"2026-01-27T03:52:16.62925915-05:00","created_by":"ubuntu"},{"issue_id":"cgm-ft3","depends_on_id":"cgm-huc","type":"blocks","created_at":"2026-01-27T03:52:16.642303176-05:00","created_by":"ubuntu"}]}
{"id":"cgm-hie","title":"Update Missing Dependencies popup UI states and error handling","notes":"## Context \u0026 Goal\n\n**Problem:** After routing through Manager queue (bead cgm-bmt), the UI needs to:\n1. Show \"Queued\" state for packages waiting in queue\n2. Listen for WebSocket events to know when packages finish installing\n3. Show toast errors when installation fails\n4. Trigger restart notification after all packages complete\n\n**Why it matters:** Users need clear feedback on what's happening during installation.\n\n---\n\n## Current State vs Target State\n\n### Current Code\n\n**File:** `frontend/src/components/MissingResourcesPopup.vue`\n\n```vue\n\u003c!-- Template lines 39-48: Button states only show Install/Installing/Installed --\u003e\n\u003cBaseButton\n  v-if=\"!installedPackages.has(pkg.package_id)\"\n  size=\"sm\"\n  variant=\"secondary\"\n  :disabled=\"installingPackage === pkg.package_id\"\n  @click=\"installPackage(pkg.package_id)\"\n\u003e\n  {{ installingPackage === pkg.package_id ? 'Installing...' : 'Install' }}\n\u003c/BaseButton\u003e\n\u003cspan v-else class=\"installed-badge\"\u003eInstalled\u003c/span\u003e\n```\n\n```typescript\n// Script lines 165-170: Only tracks installed and single installing\nconst installedPackages = ref\u003cSet\u003cstring\u003e\u003e(new Set())\nconst installingPackage = ref\u003cstring | null\u003e(null)  // Only one at a time\n```\n\n### Target Code\n\n```vue\n\u003c!-- Template: Show Queued/Installing/Installed/Failed states --\u003e\n\u003ctemplate v-if=\"!installedPackages.has(pkg.package_id)\"\u003e\n  \u003cBaseButton\n    v-if=\"!queuedPackages.has(pkg.package_id) \u0026\u0026 !failedPackages.has(pkg.package_id)\"\n    size=\"sm\"\n    variant=\"secondary\"\n    @click=\"queueInstallPackage(pkg.package_id)\"\n  \u003e\n    Install\n  \u003c/BaseButton\u003e\n  \u003cspan v-else-if=\"queuedPackages.has(pkg.package_id) \u0026\u0026 installingPackage !== pkg.package_id\" \n        class=\"queued-badge\"\u003eQueued\u003c/span\u003e\n  \u003cspan v-else-if=\"installingPackage === pkg.package_id\" \n        class=\"installing-badge\"\u003eInstalling...\u003c/span\u003e\n  \u003cspan v-else-if=\"failedPackages.has(pkg.package_id)\" \n        class=\"failed-badge\" :title=\"failedPackages.get(pkg.package_id)\"\u003e\n    Failed ⚠\n  \u003c/span\u003e\n\u003c/template\u003e\n\u003cspan v-else class=\"installed-badge\"\u003eInstalled\u003c/span\u003e\n```\n\n```typescript\n// Script: Add queued and failed tracking, WebSocket listener\nconst queuedPackages = ref\u003cSet\u003cstring\u003e\u003e(new Set())\nconst failedPackages = ref\u003cMap\u003cstring, string\u003e\u003e(new Map())  // package_id -\u003e error message\nconst installingPackage = ref\u003cstring | null\u003e(null)\nconst taskToPackageMap = ref\u003cMap\u003cstring, string\u003e\u003e(new Map())  // ui_id -\u003e package_id\n\n// WebSocket event handlers\nonMounted(() =\u003e {\n  // Listen for Manager task events via ComfyUI's WebSocket\n  const ws = (window as any).comfyAPI?.api?.socket  // or however ComfyUI exposes WS\n  if (ws) {\n    ws.addEventListener('message', handleWebSocketMessage)\n  }\n})\n\nfunction handleWebSocketMessage(event: MessageEvent) {\n  const data = JSON.parse(event.data)\n  \n  if (data.type === 'cm-task-started') {\n    const taskId = data.data?.ui_id\n    const packageId = taskToPackageMap.value.get(taskId)\n    if (packageId) {\n      installingPackage.value = packageId\n    }\n  }\n  \n  if (data.type === 'cm-task-completed') {\n    const taskId = data.data?.ui_id\n    const packageId = taskToPackageMap.value.get(taskId)\n    const status = data.data?.status?.status_str\n    \n    if (packageId) {\n      queuedPackages.value.delete(packageId)\n      installingPackage.value = null\n      \n      if (status === 'success') {\n        installedPackages.value.add(packageId)\n        installedCount.value++\n      } else {\n        failedPackages.value.set(packageId, data.data?.status?.messages?.[0] || 'Unknown error')\n        // Dispatch toast event\n        window.dispatchEvent(new CustomEvent('comfygit:toast', {\n          detail: { message: `Failed to install ${packageId}`, type: 'error' }\n        }))\n      }\n      \n      // Check if all done, trigger restart notification\n      if (queuedPackages.value.size === 0 \u0026\u0026 installedCount.value \u003e 0) {\n        window.dispatchEvent(new CustomEvent('comfygit:nodes-installed', {\n          detail: { count: installedCount.value }\n        }))\n      }\n    }\n  }\n}\n```\n\n---\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/MissingResourcesPopup.vue` (lines 39-48 template, 165-170 script) - Add UI states, WebSocket listener, error handling\n\n**Files MODIFIED (write):**\n- `frontend/src/main.ts` - Add listener for `comfygit:toast` custom event to show toasts from popup\n\n**Files READ (reference only):**\n- `frontend/src/components/ComfyGitPanel.vue` - Reference for toast format\n\n---\n\n## Parallelization Info\n\n**Can Run In Parallel With:** None\n\n**Cannot Run In Parallel With:** cgm-bmt - REASON: both modify MissingResourcesPopup.vue\n\n**Blocking Reason:** Depends on cgm-bmt being complete (needs queueNodeInstall function)\n\n---\n\n## Estimated Scope\n- **Size:** Medium (~80 lines changed)\n- **Risk:** Low (isolated UI changes)\n\n---\n\n## Acceptance Criteria\n- [ ] Clicking \"Install\" shows \"Queued\" badge immediately\n- [ ] \"Install All\" sets all packages to \"Queued\" state\n- [ ] Cannot double-click Install (button disappears after click)\n- [ ] When queue starts processing, \"Queued\" changes to \"Installing...\" for active package\n- [ ] When package completes successfully, shows \"Installed\" badge\n- [ ] When package fails, shows \"Failed ⚠\" badge with tooltip\n- [ ] On failure, toast appears with error message\n- [ ] After all queued packages complete, restart notification appears at bottom\n- [ ] CSS styles added for .queued-badge, .installing-badge, .failed-badge\n\n---\n\n## CSS to Add\n\n```css\n.queued-badge {\n  color: var(--cg-color-warning);\n  font-size: 0.85em;\n}\n\n.installing-badge {\n  color: var(--cg-color-accent);\n  font-size: 0.85em;\n}\n\n.failed-badge {\n  color: var(--cg-color-error);\n  font-size: 0.85em;\n  cursor: help;\n}\n```\n\n---\n\n## Testing Requirements\n- Manual test: Click individual Install button, verify it shows \"Queued\" then \"Installing...\" then \"Installed\"\n- Manual test: Click \"Install All\", verify all buttons show \"Queued\"\n- Manual test: Force an install failure (bad package name?), verify toast appears and \"Failed\" badge shows\n- Manual test: After successful installs, verify restart notification appears","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-24T03:06:51.978625561-05:00","created_by":"ubuntu","updated_at":"2026-01-24T03:14:01.646235766-05:00","closed_at":"2026-01-24T03:14:01.646235766-05:00","close_reason":"Implemented UI states (Queued/Installing/Failed/Installed), WebSocket event handling for cm-task-started and cm-task-completed, proper restart notification timing, and CSS for all badge states.","dependencies":[{"issue_id":"cgm-hie","depends_on_id":"cgm-bmt","type":"blocks","created_at":"2026-01-24T03:06:57.926845166-05:00","created_by":"ubuntu"}]}
{"id":"cgm-huc","title":"Add HuggingFace service methods to useComfyGitService","notes":"## Context \u0026 Goal\n\nAdd two service methods to the composable for calling the new backend endpoints:\n1. `getHuggingFaceRepoInfo(url)` - Fetches repo file listing\n2. `getModelsSubdirectories()` - Fetches available model directories\n\n## Current State vs Target State\n\n**Current** (`/data/projects/comfygit-ai/comfygit-manager/frontend/src/composables/useComfyGitService.ts`):\nNo HuggingFace-related service methods exist. File ends around line 800+ with return statement.\n\n**Target** - Add after existing model methods (around line 720, after setModelsDirectory), and update return statement:\n\n```typescript\n// Add import at top with other type imports\nimport type { HuggingFaceRepoInfoResponse, ModelsSubdirectoriesResponse } from '@/types/comfygit'\n\n// Add methods (around line 720, after setModelsDirectory)\nasync function getHuggingFaceRepoInfo(url: string): Promise\u003cHuggingFaceRepoInfoResponse\u003e {\n  if (USE_MOCK) {\n    // Return mock data for development\n    return {\n      repo_id: 'mock/repo',\n      revision: 'main',\n      files: [\n        { path: 'model.safetensors', size: 1024 * 1024 * 100, is_model_file: true, shard_group: null }\n      ]\n    }\n  }\n  const params = new URLSearchParams({ url })\n  return fetchApi(\\`/v2/workspace/huggingface/repo-info?\\${params}\\`)\n}\n\nasync function getModelsSubdirectories(): Promise\u003cModelsSubdirectoriesResponse\u003e {\n  if (USE_MOCK) {\n    return {\n      directories: ['checkpoints', 'loras', 'vae', 'controlnet'],\n      standard: ['checkpoints', 'loras', 'vae'],\n      existing: ['checkpoints', 'controlnet']\n    }\n  }\n  return fetchApi('/v2/workspace/models/subdirectories')\n}\n\n// Update return statement to include new methods\nreturn {\n  // ... existing exports ...\n  getHuggingFaceRepoInfo,\n  getModelsSubdirectories,\n}\n```\n\n## Files Inventory\n\n**Files MODIFIED:**\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/composables/useComfyGitService.ts (add ~30 lines)\n\n**Files READ:**\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/types/comfygit.ts (for type imports)\n\n**Files CREATED:** None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend endpoint bead (different codebase)\n- Core library beads (different codebase)\n\n**Cannot Run In Parallel With:**\n- Any other bead modifying useComfyGitService.ts (none planned)\n\n**Blocking Reason:** HuggingFaceRepoModal.vue needs these methods\n\n## Estimated Scope\n- **Size:** Small (~30 lines)\n- **Risk:** Low (additive methods)\n\n## Acceptance Criteria\n- [ ] Both methods exported from composable\n- [ ] TypeScript compiles without errors\n- [ ] Methods use correct API paths matching backend endpoints\n- [ ] Mock data provided for USE_MOCK mode\n\n## Testing Requirements\n- TypeScript compilation check\n- Manual testing when modal is wired up","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T03:50:24.720336671-05:00","created_by":"ubuntu","updated_at":"2026-01-27T14:21:53.236978294-05:00","dependencies":[{"issue_id":"cgm-huc","depends_on_id":"cgm-tuo","type":"blocks","created_at":"2026-01-27T03:52:08.300867382-05:00","created_by":"ubuntu"}]}
{"id":"cgm-i4i","title":"Create HuggingFace URL parser in comfygit-core","notes":"## Context \u0026 Goal\n\nCreate a URL parser module in comfygit-core that distinguishes:\n- Repo browser URLs (`/tree/main`) - need file browser modal\n- Direct file URLs (`/resolve/main/file.safetensors`) - can download directly\n- Invalid/non-HF URLs\n\nThis enables the downloader to reject repo URLs with a helpful error instead of crashing.\n\n## Current State vs Target State\n\n**Current**: No HuggingFace URL parsing exists in core\n\n**Target** - Create `/data/projects/comfygit-ai/comfygit/packages/core/src/comfygit_core/services/huggingface_url.py`:\n\n```python\nfrom __future__ import annotations\n\nfrom dataclasses import dataclass\nfrom typing import Literal\nfrom urllib.parse import urlparse\n\nKind = Literal[\"repo\", \"file\", \"unknown\"]\n\n@dataclass(frozen=True)\nclass ParsedHuggingFaceUrl:\n    kind: Kind\n    repo_id: str | None = None\n    revision: str | None = None\n    path_in_repo: str | None = None\n\ndef parse_huggingface_url(url: str) -\u003e ParsedHuggingFaceUrl:\n    \"\"\"Parse a HuggingFace URL into its components.\n    \n    Returns:\n        ParsedHuggingFaceUrl with kind=\"repo\" for browser URLs,\n        kind=\"file\" for direct download URLs, or kind=\"unknown\"\n    \"\"\"\n    u = url.strip()\n    if not u:\n        return ParsedHuggingFaceUrl(kind=\"unknown\")\n\n    try:\n        p = urlparse(u)\n    except Exception:\n        return ParsedHuggingFaceUrl(kind=\"unknown\")\n\n    host = (p.hostname or \"\").lower()\n    if host not in (\"huggingface.co\", \"hf.co\") and not host.endswith(\".huggingface.co\"):\n        return ParsedHuggingFaceUrl(kind=\"unknown\")\n\n    parts = [s for s in p.path.split(\"/\") if s]\n\n    # Ignore datasets/spaces in MVP\n    if not parts or parts[0] in (\"datasets\", \"spaces\"):\n        return ParsedHuggingFaceUrl(kind=\"unknown\")\n\n    if len(parts) \u003c 2:\n        return ParsedHuggingFaceUrl(kind=\"unknown\")\n\n    repo_id = f\"{parts[0]}/{parts[1]}\"\n    revision = \"main\"\n\n    if len(parts) == 2:\n        return ParsedHuggingFaceUrl(kind=\"repo\", repo_id=repo_id, revision=revision)\n\n    marker = parts[2]\n\n    if marker == \"tree\":\n        revision = parts[3] if len(parts) \u003e= 4 else \"main\"\n        return ParsedHuggingFaceUrl(kind=\"repo\", repo_id=repo_id, revision=revision)\n\n    if marker in (\"resolve\", \"blob\"):\n        revision = parts[3] if len(parts) \u003e= 4 else \"main\"\n        path_in_repo = \"/\".join(parts[4:]) if len(parts) \u003e= 5 else \"\"\n        if not path_in_repo:\n            return ParsedHuggingFaceUrl(kind=\"repo\", repo_id=repo_id, revision=revision)\n        return ParsedHuggingFaceUrl(kind=\"file\", repo_id=repo_id, revision=revision, path_in_repo=path_in_repo)\n\n    # Fallback: treat unknown markers as repo\n    return ParsedHuggingFaceUrl(kind=\"repo\", repo_id=repo_id, revision=\"main\")\n```\n\n## Files Inventory\n\n**Files MODIFIED:** None\n\n**Files READ:** None  \n\n**Files CREATED:**\n- /data/projects/comfygit-ai/comfygit/packages/core/src/comfygit_core/services/huggingface_url.py\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- cgm-4pl (dependency addition)\n- Frontend URL parser bead\n- Frontend types bead\n\n**Cannot Run In Parallel With:** None\n\n**Blocking Reason:** model_downloader.py update needs this module to import\n\n## Estimated Scope\n- **Size:** Small (~60 lines)\n- **Risk:** Low (new isolated module)\n\n## Acceptance Criteria\n- [ ] Module created at specified path\n- [ ] Handles all URL patterns:\n  - `huggingface.co/owner/repo` → kind=\"repo\"\n  - `huggingface.co/owner/repo/tree/main` → kind=\"repo\"\n  - `huggingface.co/owner/repo/resolve/main/file.safetensors` → kind=\"file\"\n  - `huggingface.co/owner/repo/blob/main/file.safetensors` → kind=\"file\"\n  - `civitai.com/...` → kind=\"unknown\"\n- [ ] Extracts repo_id, revision, path_in_repo correctly\n\n## Testing Requirements\n- Add unit tests in `/data/projects/comfygit-ai/comfygit/packages/core/tests/unit/services/test_huggingface_url.py`\n- Test each URL pattern listed above","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T03:49:06.918470451-05:00","created_by":"ubuntu","updated_at":"2026-01-27T03:49:06.918470451-05:00"}
{"id":"cgm-isl","title":"Enhance MissingResourcesPopup with actionable install/download buttons","description":"## Context \u0026 Goal\n\n**Problem**: The MissingResourcesPopup currently shows raw node→package mappings instead of actionable, deduplicated package lists. Users cannot install nodes or download models directly - they must open the full panel.\n\n**Why it matters**: This is the first thing users see when loading a workflow with missing dependencies. It should provide immediate, frictionless resolution options rather than redirecting to another UI.\n\n**Goal**: Transform the popup from a passive notification into an actionable resolution interface with:\n- Deduplicated package list (not node-type mappings)\n- Individual and bulk install/download buttons\n- \"Don't show again\" per-workflow memory\n- Clean UI without emojis\n\n---\n\n## Current State vs Target State\n\n### Current Node Display (WRONG)\n```vue\n\u003c!-- Shows every node type mapped to its package --\u003e\n\u003cdiv v-for=\"node in missingNodes\" class=\"item\"\u003e\n  \u003ccode class=\"node-type\"\u003e{{ node.node_type }}\u003c/code\u003e\n  \u003cspan class=\"package-info\"\u003e→ {{ node.package_title }}\u003c/span\u003e\n\u003c/div\u003e\n```\n\nResult:\n```\nDepthflowMotionPresetCircle → ComfyUI-Depthflow-Nodes\nDepthflow → ComfyUI-Depthflow-Nodes\n```\n\n### Target Node Display (CORRECT)\n```vue\n\u003c!-- Shows deduplicated packages with install buttons --\u003e\n\u003cdiv v-for=\"pkg in missingPackages\" :key=\"pkg.package_id\" class=\"package-item\"\u003e\n  \u003cspan class=\"package-name\"\u003e{{ pkg.title }}\u003c/span\u003e\n  \u003cspan class=\"node-count\"\u003e({{ pkg.node_count }} nodes)\u003c/span\u003e\n  \u003cBaseButton\n    v-if=\"!queuedPackages.has(pkg.package_id)\"\n    size=\"sm\"\n    @click=\"installPackage(pkg.package_id)\"\n  \u003eInstall\u003c/BaseButton\u003e\n  \u003cspan v-else class=\"queued-badge\"\u003eQueued\u003c/span\u003e\n\u003c/div\u003e\n```\n\nResult:\n```\nComfyUI-Depthflow-Nodes (2 nodes)  [Install]\n```\n\n---\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/MissingResourcesPopup.vue` (entire file) - main implementation\n\n**Files READ (reference only):**\n- `frontend/src/composables/useModelDownloadQueue.ts` - understand addToQueue() signature\n- `frontend/src/composables/useComfyGitService.ts` - understand installNode() signature\n- `frontend/src/types/comfygit.ts` - type definitions\n\n**Files CREATED:**\n- None\n\n---\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Any backend changes\n- Any other frontend components not importing MissingResourcesPopup\n\n**Cannot Run In Parallel With:**\n- Nothing - this is the only bead for this feature\n\n**Blocking Reason:** N/A (self-contained)\n\n---\n\n## Estimated Scope\n\n- **Size:** Medium (~150-200 lines of changes)\n- **Risk:** Low (isolated popup component, no shared state mutations)\n\n---\n\n## Implementation Details\n\n### 1. New Imports\n```typescript\nimport { useModelDownloadQueue } from '@/composables/useModelDownloadQueue'\nimport { useComfyGitService } from '@/composables/useComfyGitService'\n```\n\n### 2. New Interfaces\n```typescript\ninterface MissingPackage {\n  package_id: string\n  title: string\n  node_count: number\n  node_types: string[]  // for tooltip/debug\n}\n\ninterface MissingModelItem {\n  filename: string\n  widget_value: string\n  url: string | null\n  targetPath: string | null\n  canDownload: boolean\n}\n```\n\n### 3. New State\n```typescript\nconst queuedPackages = ref\u003cSet\u003cstring\u003e\u003e(new Set())\nconst queuedModels = ref\u003cSet\u003cstring\u003e\u003e(new Set())\nconst dontShowAgain = ref(false)\nconst installingPackage = ref\u003cstring | null\u003e(null)  // for loading state\nconst currentWorkflowHash = ref\u003cstring | null\u003e(null)\n```\n\n### 4. New Computed: missingPackages (deduplicated)\n```typescript\nconst missingPackages = computed\u003cMissingPackage[]\u003e(() =\u003e {\n  if (!analysis.value?.nodes) return []\n\n  const packageMap = new Map\u003cstring, MissingPackage\u003e()\n\n  const uninstalledResolved = (analysis.value.nodes.resolved || [])\n    .filter((n: any) =\u003e !n.is_installed \u0026\u0026 n.package?.package_id)\n\n  for (const node of uninstalledResolved) {\n    const pkgId = node.package.package_id\n    if (!packageMap.has(pkgId)) {\n      packageMap.set(pkgId, {\n        package_id: pkgId,\n        title: node.package.title || pkgId,\n        node_count: 0,\n        node_types: []\n      })\n    }\n    const pkg = packageMap.get(pkgId)!\n    pkg.node_count++\n    pkg.node_types.push(node.reference?.node_type || node.node_type)\n  }\n\n  return Array.from(packageMap.values())\n})\n\nconst unresolvedNodes = computed(() =\u003e {\n  if (!analysis.value?.nodes) return []\n  return (analysis.value.nodes.unresolved || []).map((n: any) =\u003e ({\n    node_type: n.reference?.node_type || n.node_type\n  }))\n})\n```\n\n### 5. Updated missingModels computed\n```typescript\nconst missingModels = computed\u003cMissingModelItem[]\u003e(() =\u003e {\n  if (!analysis.value?.models) return []\n\n  const needsDownload = (analysis.value.models.resolved || [])\n    .filter((m: any) =\u003e\n      m.match_type === 'download_intent' ||\n      m.match_type === 'property_download_intent' ||\n      m.match_type === 'not_found'\n    )\n    .map((m: any) =\u003e ({\n      filename: m.reference?.widget_value?.split('/').pop() || m.reference?.widget_value,\n      widget_value: m.reference?.widget_value || m.widget_value,\n      url: m.download_source?.url || null,\n      targetPath: m.download_source?.target_path || null,\n      canDownload: !!(m.download_source?.url \u0026\u0026 m.download_source?.target_path)\n    }))\n\n  return needsDownload\n})\n```\n\n### 6. Action Methods\n```typescript\nconst { addToQueue } = useModelDownloadQueue()\nconst { installNode } = useComfyGitService()\n\nasync function installPackage(packageId: string) {\n  if (queuedPackages.value.has(packageId)) return\n\n  installingPackage.value = packageId\n  try {\n    await installNode(packageId)\n    queuedPackages.value.add(packageId)\n  } catch (e) {\n    console.error('[ComfyGit] Failed to install package:', e)\n  } finally {\n    installingPackage.value = null\n  }\n}\n\nfunction downloadModel(model: MissingModelItem) {\n  if (!model.url || !model.targetPath || queuedModels.value.has(model.url)) return\n\n  addToQueue([{\n    workflow: 'unsaved',\n    filename: model.filename,\n    url: model.url,\n    targetPath: model.targetPath\n  }])\n  queuedModels.value.add(model.url)\n}\n\nfunction installAllNodes() {\n  for (const pkg of missingPackages.value) {\n    if (!queuedPackages.value.has(pkg.package_id)) {\n      installPackage(pkg.package_id)\n    }\n  }\n}\n\nfunction downloadAllModels() {\n  const toDownload = missingModels.value.filter(\n    m =\u003e m.canDownload \u0026\u0026 !queuedModels.value.has(m.url!)\n  )\n  if (toDownload.length === 0) return\n\n  addToQueue(toDownload.map(m =\u003e ({\n    workflow: 'unsaved',\n    filename: m.filename,\n    url: m.url!,\n    targetPath: m.targetPath!\n  })))\n\n  for (const m of toDownload) {\n    queuedModels.value.add(m.url!)\n  }\n}\n\nfunction downloadAll() {\n  installAllNodes()\n  downloadAllModels()\n}\n```\n\n### 7. \"Don't Show Again\" Logic\n```typescript\nfunction getWorkflowHash(workflow: any): string {\n  const nodeTypes = (workflow?.nodes || [])\n    .map((n: any) =\u003e n.type)\n    .sort()\n    .join(',')\n  return btoa(nodeTypes).slice(0, 16)\n}\n\nfunction shouldShowPopup(workflow: any): boolean {\n  const hash = getWorkflowHash(workflow)\n  return localStorage.getItem('comfygit:popup-dismissed:' + hash) !== 'true'\n}\n\nfunction handleDontShowAgainChange() {\n  if (dontShowAgain.value \u0026\u0026 currentWorkflowHash.value) {\n    localStorage.setItem('comfygit:popup-dismissed:' + currentWorkflowHash.value, 'true')\n  }\n}\n```\n\n---\n\n## Acceptance Criteria\n\n- [ ] Missing nodes section shows deduplicated packages (by package_id), not node-type mappings\n- [ ] Each package shows node count (e.g., \"ComfyUI-Depthflow-Nodes (2 nodes)\")\n- [ ] Each package has individual \"Install\" button\n- [ ] Section has \"Install All\" button for bulk node installation\n- [ ] Each downloadable model has individual \"Download\" button\n- [ ] Section has \"Download All\" button for bulk model downloads\n- [ ] Footer has \"Download All\" primary button that queues everything\n- [ ] Buttons show \"Queued\" status after clicked (prevents duplicate queuing)\n- [ ] \"Don't show again\" checkbox persists choice per-workflow to localStorage\n- [ ] No emojis in section titles\n- [ ] Unresolved nodes (not in registry) shown in separate \"Unknown Nodes\" section\n- [ ] Integrates with existing useModelDownloadQueue for model downloads\n- [ ] Integrates with existing useComfyGitService.installNode() for node installation\n\n---\n\n## Testing Requirements\n\n**Manual Testing:**\n1. Load workflow with missing nodes from single package → see deduplicated entry\n2. Load workflow with missing nodes from multiple packages → see multiple entries\n3. Click individual Install → package queued, button changes to \"Queued\"\n4. Click Install All → all packages queued\n5. Click individual Download → model added to download queue\n6. Click Download All (section) → all models in section queued\n7. Click Download All (footer) → everything queued\n8. Check \"Don't show again\" → dismiss → reload same workflow → popup shouldn't appear\n9. Load different workflow → popup should appear (different hash)\n\n---\n\n## Build \u0026 Verify\n\nAfter implementation:\n```bash\ncd frontend \u0026\u0026 bun run build\n```\n\nThen test in browser with workflow that has missing dependencies.\n","status":"closed","priority":1,"issue_type":"task","assignee":"ubuntu","created_at":"2026-01-23T03:13:37.131460186-05:00","created_by":"ubuntu","updated_at":"2026-01-23T03:20:06.796069031-05:00","closed_at":"2026-01-23T03:20:06.796069031-05:00","close_reason":"Implemented all acceptance criteria: deduplicated packages, Install/Download buttons, bulk actions, 'Don't show again' checkbox with localStorage, no emojis, separate Unknown Nodes section, integration with useModelDownloadQueue and useComfyGitService"}
{"id":"cgm-kg0","title":"Add /v2/comfygit/workflow/is-saved endpoint with hash-based detection","notes":"## Context \u0026 Goal\n\n**Problem:** MissingResourcesPopup shows for saved workflows because frontend can't detect if current workflow is saved to disk. The `beforeConfigureGraph` hook only receives raw JSON - no file path/metadata.\n\n**Solution:** Add backend endpoint that compares incoming workflow JSON hash against hashes of all saved workflows in `ComfyUI/user/default/workflows/`.\n\n**Why it matters:** Prevents popup spam for workflows already tracked in ComfyGit panel.\n\n---\n\n## Current State vs Target State\n\n### Current: No endpoint exists\n\n### Target: New endpoint in `server/api/v2/workflows.py`\n\n```python\nimport xxhash\n\n# Cache for disk workflow hashes (invalidated by file watcher)\n_workflow_hash_cache: dict[str, str] = {}  # filename -\u003e hash\n_cache_valid: bool = False\n\ndef invalidate_workflow_hash_cache():\n    \"\"\"Called by file watcher when workflows change.\"\"\"\n    global _cache_valid\n    _cache_valid = False\n\ndef _normalize_workflow(wf: dict) -\u003e dict:\n    \"\"\"Strip volatile fields that don't affect workflow identity.\"\"\"\n    wf = wf.copy()\n    if 'extra' in wf and isinstance(wf['extra'], dict):\n        wf['extra'] = {k: v for k, v in wf['extra'].items() if k != 'ds'}\n    return wf\n\ndef _get_workflow_hash(wf: dict) -\u003e str:\n    \"\"\"Compute xxhash of normalized workflow JSON.\"\"\"\n    normalized = _normalize_workflow(wf)\n    json_str = json.dumps(normalized, sort_keys=True, separators=(',', ':'))\n    return xxhash.xxh64(json_str.encode()).hexdigest()\n\ndef _get_disk_workflow_hashes(workflows_path: Path) -\u003e dict[str, str]:\n    \"\"\"Get hashes of all saved workflows, using cache if valid.\"\"\"\n    global _workflow_hash_cache, _cache_valid\n    \n    if _cache_valid:\n        return _workflow_hash_cache\n    \n    _workflow_hash_cache = {}\n    if workflows_path.exists():\n        for wf_file in workflows_path.glob(\"**/*.json\"):\n            try:\n                with open(wf_file) as f:\n                    data = json.load(f)\n                _workflow_hash_cache[wf_file.name] = _get_workflow_hash(data)\n            except (json.JSONDecodeError, IOError):\n                pass  # Skip invalid files\n    \n    _cache_valid = True\n    return _workflow_hash_cache\n\n@routes.post(\"/v2/comfygit/workflow/is-saved\")\n@requires_environment\nasync def check_workflow_saved(request: web.Request, env) -\u003e web.Response:\n    \"\"\"Check if workflow JSON matches a saved workflow on disk.\"\"\"\n    try:\n        body = await request.json()\n    except Exception:\n        return web.json_response({\"error\": \"Invalid JSON\"}, status=400)\n    \n    workflow_data = body.get(\"workflow\")\n    if not workflow_data or not isinstance(workflow_data, dict):\n        return web.json_response({\"error\": \"Missing workflow\"}, status=400)\n    \n    incoming_hash = _get_workflow_hash(workflow_data)\n    workflows_path = env.comfyui_path / \"user\" / \"default\" / \"workflows\"\n    disk_hashes = _get_disk_workflow_hashes(workflows_path)\n    \n    for filename, disk_hash in disk_hashes.items():\n        if disk_hash == incoming_hash:\n            return web.json_response({\"is_saved\": True, \"filename\": filename})\n    \n    return web.json_response({\"is_saved\": False, \"filename\": None})\n```\n\n---\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- `server/api/v2/workflows.py` - Add endpoint + helper functions (~60 lines)\n- `server/workflow_file_watcher.py` - Add cache invalidation call\n\n**Files READ (reference only):**\n- `server/comfygit_panel.py` - Verify workflows_path pattern\n\n---\n\n## Cache Invalidation Hook\n\nIn `server/workflow_file_watcher.py`, add call to `invalidate_workflow_hash_cache()` in each of the event handlers:\n- `on_modified()` \n- `on_created()`\n- `on_deleted()`\n\nImport from workflows module:\n```python\nfrom server.api.v2.workflows import invalidate_workflow_hash_cache\n```\n\nCall at the start of each handler before the broadcast.\n\n---\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Frontend bead (cgm-38y) - no file overlap, frontend only reads endpoint\n\n**Cannot Run In Parallel With:**\n- None\n\n---\n\n## Estimated Scope\n- **Size:** Medium (~70 lines)\n- **Risk:** Low (new isolated endpoint, no changes to existing logic)\n\n---\n\n## Acceptance Criteria\n- [ ] `POST /v2/comfygit/workflow/is-saved` returns `{\"is_saved\": true, \"filename\": \"...\"}` for saved workflow\n- [ ] Returns `{\"is_saved\": false, \"filename\": null}` for unsaved/modified workflow\n- [ ] Hash ignores `extra.ds` (viewport state)\n- [ ] Hash cache invalidates when file watcher detects changes\n- [ ] Works with workflows in subfolders (recursive glob)\n\n---\n\n## Testing Requirements\n- Manual test: Load saved workflow, call endpoint, verify `is_saved: true`\n- Manual test: Modify widget value, call endpoint, verify `is_saved: false`\n- Manual test: Save workflow, call endpoint again, verify cache updates","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-26T22:17:12.669756058-05:00","created_by":"ubuntu","updated_at":"2026-01-26T23:00:19.298442226-05:00","closed_at":"2026-01-26T23:00:19.298442226-05:00","close_reason":"Implemented in sprint run-1769484386145645150. Backend endpoint + frontend integration complete with 7 tests."}
{"id":"cgm-n2o","title":"Add 'Models to Download' section in Review step showing download intent details","notes":"# Context \u0026 Goal\n\n## Problem\nThe Review step shows download intents as individual model rows with \"Pending Download\" badge, but doesn't provide a clear summary section showing WHAT will be downloaded. Users should see:\n- Model filename\n- Download URL (truncated)\n- Target path\n- Optionally file size if available\n\n## Why It Matters\nBefore clicking \"Apply Resolution\", users need to understand exactly what will happen. Showing a dedicated \"Models to Download\" section with details gives confidence and transparency.\n\n## How It Serves Project Goals\nClear visibility into pending actions. Users can verify URLs and paths before downloads start.\n\n---\n\n# Current State vs Target State\n\n## Current Code\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue` (lines 248-287)\n\nCurrently shows a generic \"Models\" section that lists all editable models with badges. Download intents show \"Pending Download\" but no URL/path details.\n\n## Target Code (ADD NEW SECTION)\n\nAfter the existing Models section (or replace it for download intents), add:\n\n```vue\n\u003c!-- Download Intent Details Section --\u003e\n\u003cdiv v-if=\"pendingDownloadsForReview.length \u003e 0\" class=\"review-section\"\u003e\n  \u003ch4 class=\"section-title\"\u003eModels to Download ({{ pendingDownloadsForReview.length }})\u003c/h4\u003e\n  \u003cdiv class=\"review-items download-details\"\u003e\n    \u003cdiv\n      v-for=\"download in pendingDownloadsForReview\"\n      :key=\"download.filename\"\n      class=\"review-item download-item\"\n    \u003e\n      \u003cdiv class=\"download-info\"\u003e\n        \u003ccode class=\"item-name\"\u003e{{ download.filename }}\u003c/code\u003e\n        \u003cdiv class=\"download-meta\"\u003e\n          \u003cspan class=\"download-path\"\u003e→ {{ download.target_path }}\u003c/span\u003e\n          \u003cspan v-if=\"download.url\" class=\"download-url\" :title=\"download.url\"\u003e\n            {{ truncateUrl(download.url) }}\n          \u003c/span\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \u003cspan class=\"choice-badge download\"\u003eWill Download\u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\nAdd computed property:\n\n```typescript\nconst pendingDownloadsForReview = computed(() =\u003e {\n  return downloadIntentModels.value.filter(model =\u003e {\n    const choice = modelChoices.value.get(model.filename)\n    // Include if no choice (default = download) or explicit download\n    // Exclude if cancelled/skipped/optional\n    return !choice || choice.action === 'download'\n  }).map(model =\u003e ({\n    filename: model.filename,\n    url: model.download_source,\n    target_path: model.target_path\n  }))\n})\n```\n\nAdd helper:\n\n```typescript\nfunction truncateUrl(url: string, maxLen = 50): string {\n  if (url.length \u003c= maxLen) return url\n  return url.slice(0, maxLen - 3) + '...'\n}\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue`\n  - Template: Add new section after line 287\n  - Script: Add pendingDownloadsForReview computed (~line 610)\n  - Script: Add truncateUrl helper function\n  - Styles: Add .download-details, .download-item, .download-meta, .download-url classes\n\n**Files READ (reference only):**\n- `frontend/src/components/WorkflowResolveModal.vue` - downloadIntentModels computed (lines 531-543)\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- cgm-447 (different computed properties)\n- comfygit-manager-yah (different section of file)\n\n**Cannot Run In Parallel With:**\n- Any task modifying Review step template (lines 170-292)\n\n**Blocking Reason:**\n- None - this is a leaf task\n\n---\n\n# Estimated Scope\n\n- **Size:** Medium (50-100 lines) - new section + computed + styles\n- **Risk:** Low (additive, doesn't modify existing behavior)\n\n---\n\n# Acceptance Criteria\n\n- [ ] Review step shows \"Models to Download (N)\" section when download intents exist\n- [ ] Each download item shows: filename, target path, truncated URL\n- [ ] Items cancelled/skipped by user don't appear in this section\n- [ ] URL tooltip shows full URL on hover\n- [ ] Section doesn't appear if no downloads pending\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open workflow with download intents\n2. Navigate to Review step\n3. Verify \"Models to Download\" section appears with correct count\n4. Verify each item shows filename, path, and URL\n5. Go back, cancel one download, verify it disappears from section","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-22T14:28:49.75943478-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:51:36.416082729-05:00","closed_at":"2026-01-22T14:51:36.416082729-05:00","close_reason":"Implemented Models to Download section in Review step with filename, target path, and truncated URL display","dependencies":[{"issue_id":"cgm-n2o","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.798364804-05:00","created_by":"ubuntu"}]}
{"id":"cgm-obf","title":"Add session-based popup suppression by workflow ID","notes":"## Context \u0026 Goal\n\n**Problem:** After loading a workflow and seeing the popup, if user makes a small change (move a node) without saving, then switches tabs and comes back, the popup appears again. This is because the hash no longer matches the saved version.\n\n**Solution:** Track workflow IDs that have already triggered a popup this browser session. Skip showing popup again for the same workflow ID.\n\n**Behavior:**\n- Browser refresh clears the suppression set (fresh session)\n- Each workflow ID only triggers popup once per session\n- Global \"Don't show popup\" setting remains separate\n\n---\n\n## Implementation\n\n### File: `frontend/src/components/MissingResourcesPopup.vue`\n\n**Add ref** (after line 184):\n```typescript\n// Session-based suppression - workflow IDs that have shown popup this session\nconst shownWorkflowIds = ref\u003cSet\u003cstring\u003e\u003e(new Set())\n```\n\n**Add early return in analyzeWorkflow** (after line 403, before is-saved check):\n```typescript\n// Session suppression: skip if already shown for this workflow ID\nconst workflowId = workflow?.id\nif (workflowId \u0026\u0026 shownWorkflowIds.value.has(workflowId)) {\n  console.log(`[ComfyGit] Already shown popup for workflow ${workflowId} this session`)\n  return\n}\n```\n\n**Add to set when popup shown** (line 454, when `visible.value = true`):\n```typescript\nif (hasIssues.value) {\n  visible.value = true\n  // Remember this workflow ID for session suppression\n  if (workflow?.id) {\n    shownWorkflowIds.value.add(workflow.id)\n  }\n}\n```\n\nNote: Need to pass `workflow` to the inner scope or store it in a ref to access `.id` at that point.\n\n---\n\n## Files Inventory\n\n**Files MODIFIED:**\n- `frontend/src/components/MissingResourcesPopup.vue` (~10 lines)\n\n---\n\n## Acceptance Criteria\n- [ ] Load workflow with missing deps → popup shows\n- [ ] Move a node (don't save) → switch tabs → come back → NO popup\n- [ ] Refresh browser → load same workflow → popup shows again\n- [ ] Load different workflow → popup shows if it has issues\n- [ ] Workflow without ID field → falls through to existing behavior","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-26T23:13:02.387361336-05:00","created_by":"ubuntu","updated_at":"2026-01-26T23:14:45.227074116-05:00","closed_at":"2026-01-26T23:14:45.227074116-05:00","close_reason":"Implemented session-based workflow ID suppression"}
{"id":"cgm-t9g","title":"Add auto-advance after model resolution selection","notes":"## Context \u0026 Goal\n\n**Problem:** Same as the node resolution auto-advance issue - after selecting a model option, users must manually click the arrow to advance. This should be consistent with node resolution behavior.\n\n**Why it matters:** Consistency across the resolution modal. If nodes auto-advance, models should too.\n\n**Design decision:** Mirror the exact same pattern as NodeResolutionStep for consistency.\n\n## Current State vs Target State\n\n**Current code** (`frontend/src/components/base/organisms/ModelResolutionStep.vue` line 301):\n```typescript\n// Handlers - no auto-advance, user navigates manually\n```\n\n**Target code:** Same pattern as NodeResolutionStep - add `advanceToNextUnresolved()` helper and call it after all choice handlers:\n- `handleModelSelected()`\n- `handleMarkOptional()`\n- `handleSkip()`\n- `handleDownload()`\n- `handleSelectLocal()` (if applicable)\n\nThe implementation should mirror NodeResolutionStep exactly, but check `modelChoices` instead of `nodeChoices`.\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/base/organisms/ModelResolutionStep.vue` (~line 301+) - Add auto-advance logic\n\n**Files READ (reference only):**\n- `frontend/src/components/base/organisms/NodeResolutionStep.vue` - Reference implementation pattern\n- `frontend/src/components/base/molecules/ModelResolutionItem.vue` - Understand emitted events\n\n**Files CREATED:**\n- None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend-only beads (workflows.py changes)\n- NodeResolutionStep changes (separate file)\n- Any bead not touching ModelResolutionStep.vue\n\n**Cannot Run In Parallel With:**\n- Any other bead modifying ModelResolutionStep.vue\n\n**Blocking Reason:** None - this is a leaf task. However, implementing NodeResolutionStep first is recommended so this bead can copy the pattern.\n\n## Estimated Scope\n- **Size:** Small (~30 lines added)\n- **Risk:** Low (UI behavior change, mirrors node resolution pattern)\n\n## Acceptance Criteria\n- [ ] After selecting a model option, view auto-advances to next unresolved model\n- [ ] After marking a model as optional, view auto-advances to next unresolved model\n- [ ] After skipping a model, view auto-advances to next unresolved model\n- [ ] After initiating download, view auto-advances to next unresolved model\n- [ ] Arrow buttons remain visible and functional for manual navigation\n- [ ] If all models are resolved, view stays on current model\n- [ ] Counter still shows correct \"X/Y resolved\" status\n- [ ] Behavior is consistent with NodeResolutionStep\n\n## Testing Requirements\n\n**Manual Testing:**\n1. Open resolution modal for a workflow with 2+ missing/ambiguous models\n2. Make a selection for the first model\n3. Verify view auto-advances to second model\n4. Verify back/forward arrows still work\n\n**Existing tests:**\n- `frontend/src/components/base/organisms/__tests__/ModelResolutionStep.test.ts`\n\n**New tests needed:**\n- Consider adding test for auto-advance behavior (optional for MVP)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-23T18:12:34.639207095-05:00","created_by":"ubuntu","updated_at":"2026-01-23T21:34:38.392641131-05:00","closed_at":"2026-01-23T21:34:38.392641131-05:00","close_reason":"Completed via sprint run-1769220521034348168"}
{"id":"cgm-tuo","title":"Add HuggingFace types to frontend comfygit.ts","notes":"## Context \u0026 Goal\n\nAdd TypeScript interfaces for HuggingFace repo info API responses and model subdirectories. These types enable type-safe API calls in the service layer.\n\n## Current State vs Target State\n\n**Current** (`/data/projects/comfygit-ai/comfygit-manager/frontend/src/types/comfygit.ts`):\nNo HuggingFace-related types exist.\n\n**Target** - Add near other interfaces (around line 705):\n\n```typescript\n// =============================================================================\n// HuggingFace Integration Types\n// =============================================================================\n\nexport interface HuggingFaceRepoFile {\n  path: string\n  size: number\n  is_model_file: boolean\n  shard_group?: string | null\n}\n\nexport interface HuggingFaceRepoInfoResponse {\n  repo_id: string\n  revision: string\n  files: HuggingFaceRepoFile[]\n}\n\nexport interface ModelsSubdirectoriesResponse {\n  directories: string[]\n  standard: string[]\n  existing: string[]\n}\n```\n\n## Files Inventory\n\n**Files MODIFIED:**\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/types/comfygit.ts (add ~20 lines at end)\n\n**Files READ:** None\n\n**Files CREATED:** None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- All other Phase 1 beads (different files)\n\n**Cannot Run In Parallel With:** None\n\n**Blocking Reason:** Service methods and modal component need these types\n\n## Estimated Scope\n- **Size:** Small (~20 lines)\n- **Risk:** Low (additive types only)\n\n## Acceptance Criteria\n- [ ] Three interfaces added: HuggingFaceRepoFile, HuggingFaceRepoInfoResponse, ModelsSubdirectoriesResponse\n- [ ] TypeScript compiles without errors\n- [ ] Types are exported\n\n## Testing Requirements\n- TypeScript compilation check via `npm run build` in frontend directory","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T03:49:39.823809989-05:00","created_by":"ubuntu","updated_at":"2026-01-27T03:49:39.823809989-05:00"}
{"id":"cgm-v93","title":"Create frontend HuggingFace URL parser utility","notes":"## Context \u0026 Goal\n\nCreate a TypeScript URL parser for the frontend that detects HuggingFace repo URLs vs direct file URLs. This enables the download modal to show \"Browse Repo Files\" button when user pastes a repo URL.\n\n## Current State vs Target State\n\n**Current**: No utils directory exists, no HF URL parsing\n\n**Target** - Create `/data/projects/comfygit-ai/comfygit-manager/frontend/src/utils/huggingface.ts`:\n\n```typescript\nexport type HuggingFaceUrlKind = 'repo' | 'file' | 'unknown'\n\nexport interface HuggingFaceParsedUrl {\n  kind: HuggingFaceUrlKind\n  repoId?: string\n  revision?: string\n  path?: string // file path in repo (for kind='file')\n}\n\nfunction isHfHost(host: string): boolean {\n  const h = host.toLowerCase()\n  return h === 'huggingface.co' || h.endsWith('.huggingface.co') || h === 'hf.co'\n}\n\nexport function parseHuggingFaceUrl(rawUrl: string): HuggingFaceParsedUrl {\n  const url = rawUrl.trim()\n  if (!url) return { kind: 'unknown' }\n\n  let u: URL\n  try {\n    u = new URL(url)\n  } catch {\n    return { kind: 'unknown' }\n  }\n\n  if (!isHfHost(u.hostname)) return { kind: 'unknown' }\n\n  const parts = u.pathname.replace(/^\\/+/, '').split('/').filter(Boolean)\n\n  // Ignore datasets/spaces URLs for now (model downloader MVP)\n  if (parts[0] === 'datasets' || parts[0] === 'spaces') return { kind: 'unknown' }\n\n  if (parts.length \u003c 2) return { kind: 'unknown' }\n\n  const repoId = \\`\\${parts[0]}/\\${parts[1]}\\`\n  const rest = parts.slice(2)\n\n  // https://huggingface.co/owner/repo\n  if (rest.length === 0) {\n    return { kind: 'repo', repoId, revision: 'main' }\n  }\n\n  const marker = rest[0]\n\n  // https://huggingface.co/owner/repo/tree/main(/subdir...)\n  if (marker === 'tree') {\n    const revision = rest[1] || 'main'\n    return { kind: 'repo', repoId, revision }\n  }\n\n  // https://huggingface.co/owner/repo/resolve/main/path/to/file\n  if (marker === 'resolve') {\n    const revision = rest[1] || 'main'\n    const path = rest.slice(2).join('/')\n    if (!path) return { kind: 'repo', repoId, revision }\n    return { kind: 'file', repoId, revision, path }\n  }\n\n  // Browser file page (not direct download)\n  if (marker === 'blob') {\n    const revision = rest[1] || 'main'\n    const path = rest.slice(2).join('/')\n    if (!path) return { kind: 'repo', repoId, revision }\n    return { kind: 'file', repoId, revision, path }\n  }\n\n  // Fallback: treat as repo\n  return { kind: 'repo', repoId, revision: 'main' }\n}\n\nfunction encodePath(path: string): string {\n  return path.split('/').map(encodeURIComponent).join('/')\n}\n\nexport function buildHfResolveUrl(repoId: string, revision: string, path: string): string {\n  const [owner, repo] = repoId.split('/')\n  return \\`https://huggingface.co/\\${encodeURIComponent(owner)}/\\${encodeURIComponent(repo)}/resolve/\\${encodeURIComponent(revision)}/\\${encodePath(path)}\\`\n}\n```\n\n## Files Inventory\n\n**Files MODIFIED:** None\n\n**Files READ:** None\n\n**Files CREATED:**\n- /data/projects/comfygit-ai/comfygit-manager/frontend/src/utils/huggingface.ts\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- All other Phase 1 beads (no overlap)\n\n**Cannot Run In Parallel With:** None\n\n**Blocking Reason:** HuggingFaceRepoModal.vue and ModelIndexSection.vue need to import this\n\n## Estimated Scope\n- **Size:** Small (~80 lines)  \n- **Risk:** Low (new isolated module)\n\n## Acceptance Criteria\n- [ ] Directory `frontend/src/utils/` already exists (contains fetchWithTimeout.ts)\n- [ ] File exports parseHuggingFaceUrl and buildHfResolveUrl\n- [ ] TypeScript compiles without errors\n- [ ] Same URL patterns handled as core parser\n\n## Testing Requirements\n- Manual testing via browser console\n- Integration testing when wired into modal","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T03:49:27.834958335-05:00","created_by":"ubuntu","updated_at":"2026-01-27T14:21:35.777219699-05:00"}
{"id":"cgm-w21","title":"Simplify MissingResourcesPopup to global setting + saved-workflow detection","notes":"## Context \u0026 Goal\n\n**Problem:** The current MissingResourcesPopup uses a per-workflow hash system that is complex and unintuitive:\n- Hash based on node IDs changes when workflow is modified\n- \"Don't show again for this workflow\" is confusing since it's actually hash-based\n- Doesn't distinguish saved vs unsaved workflows\n- Creates many localStorage entries that need cleanup\n\n**Solution:** Simplify to two checks:\n1. Skip popup for saved workflows (they're tracked in ComfyGit panel)\n2. Global \"don't show popup\" setting (single boolean, like ComfyUI)\n\n**Additional fix:** Remove \"Open ComfyGit Panel\" button - it confuses users since unsaved workflows show \"no issues\" in the panel.\n\n## Current State vs Target State\n\n### MissingResourcesPopup.vue\n\n**REMOVE these functions (lines 391-425):**\n```typescript\n// DELETE: Hash-based system\nfunction hashString(str: string): string { ... }\nfunction getWorkflowHash(workflow: any): string { ... }\nfunction shouldShowPopup(workflow: any): boolean { ... }\nfunction handleDontShowAgainChange() { ... }\n```\n\n**REPLACE analyzeWorkflow check (lines 427-431):**\n```typescript\n// OLD:\nasync function analyzeWorkflow(workflow: any) {\n  if (!shouldShowPopup(workflow)) {\n    return\n  }\n  // ...\n}\n\n// NEW:\nasync function analyzeWorkflow(workflow: any) {\n  // Skip for saved workflows - issues tracked in ComfyGit panel\n  if (workflow?.path || workflow?.filename) {\n    console.log('[ComfyGit] Workflow saved to disk, skipping popup')\n    return\n  }\n  \n  // Skip if user globally disabled popup\n  if (localStorage.getItem('comfygit:popup-disabled') === 'true') {\n    console.log('[ComfyGit] Popup globally disabled')\n    return\n  }\n  // ...\n}\n```\n\n**CHANGE checkbox label and handler (lines 122-127):**\n```vue\n\u003c!-- OLD: --\u003e\n\u003cBaseCheckbox v-model=\"dontShowAgain\" @update:model-value=\"handleDontShowAgainChange\"\u003e\n  Don't show again for this workflow\n\u003c/BaseCheckbox\u003e\n\n\u003c!-- NEW: --\u003e\n\u003cBaseCheckbox v-model=\"dontShowAgain\" @update:model-value=\"handleDontShowAgainChange\"\u003e\n  Don't show this popup\n\u003c/BaseCheckbox\u003e\n```\n\n**NEW handleDontShowAgainChange:**\n```typescript\nfunction handleDontShowAgainChange() {\n  if (dontShowAgain.value) {\n    localStorage.setItem('comfygit:popup-disabled', 'true')\n  } else {\n    localStorage.removeItem('comfygit:popup-disabled')\n  }\n}\n```\n\n**REMOVE \"Open ComfyGit Panel\" button (lines 141):**\n```vue\n\u003c!-- OLD footer: --\u003e\n\u003ctemplate #footer\u003e\n  \u003cBaseButton variant=\"secondary\" @click=\"dismiss\"\u003eDismiss\u003c/BaseButton\u003e\n  \u003cBaseButton v-if=\"hasDownloadableItems\" ...\u003eDownload All\u003c/BaseButton\u003e\n  \u003cBaseButton v-else variant=\"primary\" @click=\"openPanel\"\u003eOpen ComfyGit Panel\u003c/BaseButton\u003e\n\u003c/template\u003e\n\n\u003c!-- NEW footer: --\u003e\n\u003ctemplate #footer\u003e\n  \u003cBaseButton variant=\"secondary\" @click=\"dismiss\"\u003eDismiss\u003c/BaseButton\u003e\n  \u003cBaseButton v-if=\"hasDownloadableItems\" ...\u003eDownload All\u003c/BaseButton\u003e\n\u003c/template\u003e\n```\n\n**REMOVE openPanel function (lines 474-480)** - no longer needed\n\n**REMOVE refs no longer needed:**\n- currentWorkflowHash (line 185)\n\n**ADD auto-dismiss on save (in onMounted):**\n```typescript\n// Listen for workflow save - auto-dismiss popup\nfunction handleWorkflowSaved(event: CustomEvent) {\n  const { change_type } = event.detail\n  if ((change_type === 'created' || change_type === 'modified') \u0026\u0026 visible.value) {\n    visible.value = false\n    console.log('[ComfyGit] Workflow saved, auto-dismissing popup')\n  }\n}\n\nonMounted(() =\u003e {\n  window.addEventListener('comfygit:workflow-loaded', handleWorkflowLoaded as EventListener)\n  window.addEventListener('comfygit:workflow-changed', handleWorkflowSaved as EventListener)\n  // ... rest\n})\n\nonUnmounted(() =\u003e {\n  window.removeEventListener('comfygit:workflow-loaded', handleWorkflowLoaded as EventListener)\n  window.removeEventListener('comfygit:workflow-changed', handleWorkflowSaved as EventListener)\n  // ... rest\n})\n```\n\n### WorkspaceSettingsContent.vue\n\n**REPLACE dismissedPopupCount logic (lines 138, 178, 234-258):**\n```typescript\n// OLD:\nconst dismissedPopupCount = ref(0)\ndismissedPopupCount.value = countDismissedPopups()\nfunction countDismissedPopups(): number { ... }\nfunction resetDismissedPopups() { ... }\n\n// NEW:\nconst popupEnabled = ref(true)\n\n// In loadSettings():\npopupEnabled.value = localStorage.getItem('comfygit:popup-disabled') !== 'true'\n\n// New function:\nfunction togglePopupSetting(value: boolean) {\n  if (value) {\n    localStorage.removeItem('comfygit:popup-disabled')\n  } else {\n    localStorage.setItem('comfygit:popup-disabled', 'true')\n  }\n}\n```\n\n**REPLACE settings UI (lines 73-86):**\n```vue\n\u003c!-- OLD: --\u003e\n\u003cSettingRow\n  label=\"Dismissed Dependency Popups\"\n  description=\"Reset the 'don't show again' state for missing dependency popups when loading workflows.\"\n\u003e\n  \u003cBaseButton\n    variant=\"secondary\"\n    size=\"sm\"\n    :disabled=\"dismissedPopupCount === 0\"\n    @click=\"resetDismissedPopups\"\n  \u003e\n    {{ dismissedPopupCount \u003e 0 ? `Reset (${dismissedPopupCount})` : 'None Dismissed' }}\n  \u003c/BaseButton\u003e\n\u003c/SettingRow\u003e\n\n\u003c!-- NEW: --\u003e\n\u003cSettingRow\n  label=\"Show Missing Dependencies Popup\"\n  description=\"Show popup when loading unsaved workflows with missing nodes or models. Saved workflows are tracked in the ComfyGit panel.\"\n\u003e\n  \u003cToggle v-model=\"popupEnabled\" @update:modelValue=\"togglePopupSetting\" /\u003e\n\u003c/SettingRow\u003e\n```\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- frontend/src/components/MissingResourcesPopup.vue - Simplify dismissal logic, remove panel button, add save listener\n- frontend/src/components/WorkspaceSettingsContent.vue - Replace reset button with toggle\n\n**Files READ (reference only):**\n- frontend/src/main.ts - Verify comfygit:workflow-changed event structure\n\n**Files CREATED:**\n- None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Any backend tasks\n- Any other frontend components not touching these files\n\n**Cannot Run In Parallel With:**\n- Nothing blocking\n\n**Blocking Reason:** N/A - standalone task\n\n## Estimated Scope\n\n- **Size:** Medium (~100 lines changed across 2 files)\n- **Risk:** Low (isolated UI change, no backend impact)\n\n## Acceptance Criteria\n\n- [ ] Popup does NOT show for workflows with a `path` property (saved workflows)\n- [ ] Popup DOES show for in-memory workflows (no path)\n- [ ] \"Don't show this popup\" checkbox disables popup globally\n- [ ] Settings has toggle to re-enable popup\n- [ ] localStorage uses single key `comfygit:popup-disabled` instead of per-hash keys\n- [ ] No \"Open ComfyGit Panel\" button in popup footer\n- [ ] Popup auto-dismisses when `comfygit:workflow-changed` event fires with created/modified\n\n## Testing Requirements\n\n**Manual testing:**\n1. Drag workflow JSON into ComfyUI → popup should show (if has issues)\n2. Save workflow → popup should auto-dismiss\n3. Reload saved workflow → popup should NOT show\n4. Check \"Don't show this popup\" → dismiss → load another unsaved workflow → popup should NOT show\n5. Go to Settings → toggle ON → load unsaved workflow → popup SHOULD show\n6. Verify only \"Dismiss\" and \"Download All\" buttons in footer (no \"Open Panel\")\n\n**No automated tests needed** - this is UI behavior change","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-26T03:16:19.507288452-05:00","created_by":"ubuntu","updated_at":"2026-01-26T03:20:37.34813621-05:00","closed_at":"2026-01-26T03:20:37.34813621-05:00","close_reason":"Implemented simplified popup logic: skip for saved workflows, global disable setting instead of per-hash, removed 'Open ComfyGit Panel' button, added auto-dismiss on workflow save"}
{"id":"cgm-xii","title":"Update handleContinueFromAnalysis to skip Models step for download-intent-only cases","notes":"# Context \u0026 Goal\n\n## Problem\nThe `handleContinueFromAnalysis` function determines which step to navigate to after Analysis. Currently it navigates to Models step if there are download intents, but if we're skipping the Models step (per comfygit-manager-yah), this navigation logic also needs updating.\n\n## Why It Matters\nWithout this change, clicking \"Continue\" from Analysis could try to navigate to a step that doesn't exist in the wizard, causing undefined behavior.\n\n## How It Serves Project Goals\nConsistent navigation flow that matches the wizard step configuration.\n\n---\n\n# Current State vs Target State\n\n## Current Code (PROBLEM)\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue` (lines 750-763)\n\n```typescript\nfunction handleContinueFromAnalysis() {\n  if (needsNodeResolution.value || hasNodesToInstall.value) {\n    currentStep.value = 'nodes'\n  } else if (needsModelResolution.value || hasDownloadIntents.value) {\n    currentStep.value = 'models'\n  } else {\n    currentStep.value = 'review'\n  }\n}\n```\n\n## Target Code (SOLUTION)\n\n```typescript\nfunction handleContinueFromAnalysis() {\n  if (needsNodeResolution.value || hasNodesToInstall.value) {\n    currentStep.value = 'nodes'\n  } else if (needsModelResolution.value) {\n    // Only go to models if user needs to make choices\n    // Download intents don't need user input - skip to review\n    currentStep.value = 'models'\n  } else {\n    currentStep.value = 'review'\n  }\n}\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue` (lines 750-763) - Update navigation condition\n\n**Files READ (reference only):**\n- None\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- cgm-447 (different lines)\n- comfygit-manager-n2o (different lines)\n\n**Cannot Run In Parallel With:**\n- comfygit-manager-yah - REASON: Both relate to skipping Models step, should be done together or sequentially\n\n**Blocking Reason:**\n- Depends on comfygit-manager-yah being decided (same logic change)\n\n---\n\n# Estimated Scope\n\n- **Size:** Small (\u003c10 lines) - single condition change\n- **Risk:** Low (isolated navigation logic)\n\n---\n\n# Acceptance Criteria\n\n- [ ] From Analysis, clicking Continue skips Models step when only download intents exist\n- [ ] From Analysis, clicking Continue goes to Models when unresolved/ambiguous models exist\n- [ ] From Analysis, clicking Continue goes to Nodes when node resolution needed\n- [ ] Navigation matches wizardSteps configuration\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open workflow with only download intents (no unresolved models)\n2. Click Continue from Analysis\n3. Verify you land on Review (not Models)\n4. Open workflow with unresolved models\n5. Click Continue, verify you land on Models","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-22T14:29:05.337122123-05:00","created_by":"ubuntu","updated_at":"2026-01-22T15:01:29.985687144-05:00","closed_at":"2026-01-22T15:01:29.985687144-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-xii","depends_on_id":"cgm-yah","type":"blocks","created_at":"2026-01-22T14:29:10.021851396-05:00","created_by":"ubuntu"},{"issue_id":"cgm-xii","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.812244709-05:00","created_by":"ubuntu"}]}
{"id":"cgm-yah","title":"Skip Models step when only download intents exist (no user choices needed)","notes":"# Context \u0026 Goal\n\n## Problem\nWhen a workflow has models with download URLs embedded (via `properties.models`), the Models step still shows but displays \"No models need resolution\" or an unhelpful empty interface. The user has no choices to make - the models already have known download sources.\n\n## Why It Matters\nUsers are forced to click through an empty/useless screen. This wastes time and confuses users who wonder why they're seeing a \"Models\" step with nothing to do.\n\n## How It Serves Project Goals\nStreamlined UX with fewer unnecessary clicks. Users only see steps where they have actual decisions to make.\n\n---\n\n# Current State vs Target State\n\n## Current Code (PROBLEM)\n\n**File:** `frontend/src/components/WorkflowResolveModal.vue` (lines 431-434)\n\n```typescript\n// Show Models step if there are unresolved/ambiguous OR download intents to review\nif (needsModelResolution.value || hasDownloadIntents.value) {\n  steps.push({ id: 'models', label: 'Models' })\n}\n```\n\nThe step shows whenever there are download intents, even if user has no choices to make.\n\n## Target Code (SOLUTION)\n\n```typescript\n// Show Models step ONLY if user needs to make choices (unresolved/ambiguous)\n// Download intents don't require user input - they're auto-confirmed\nif (needsModelResolution.value) {\n  steps.push({ id: 'models', label: 'Models' })\n}\n```\n\n---\n\n# Files Inventory\n\n**Files MODIFIED (write):**\n- `frontend/src/components/WorkflowResolveModal.vue` (lines 431-434) - Remove hasDownloadIntents from condition\n\n**Files READ (reference only):**\n- `frontend/src/components/WorkflowResolveModal.vue` - Understanding step flow\n\n**Files CREATED:**\n- None\n\n---\n\n# Parallelization Info\n\n**Can Run In Parallel With:**\n- cgm-447 (different lines in same file - 636 vs 431)\n\n**Cannot Run In Parallel With:**\n- Any task modifying wizardSteps computed (lines 420-444)\n\n**Blocking Reason:**\n- None - this is a leaf task\n\n---\n\n# Estimated Scope\n\n- **Size:** Small (\u003c10 lines) - single condition change\n- **Risk:** Low (isolated logic change)\n\n---\n\n# Acceptance Criteria\n\n- [ ] When workflow has ONLY download intents (no unresolved/ambiguous), Models step is skipped\n- [ ] When workflow has unresolved OR ambiguous models, Models step still shows\n- [ ] When workflow has both download intents AND unresolved models, Models step shows\n- [ ] Navigation flow goes Analysis → Review when only intents exist\n\n---\n\n# Testing Requirements\n\n**Manual Verification:**\n1. Open a workflow where all missing models have download URLs (property_download_intent)\n2. Verify step indicators show: Analysis → Review (no Models step)\n3. Open a workflow with truly unresolved models (no URL)\n4. Verify Models step appears","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-22T14:28:29.094496459-05:00","created_by":"ubuntu","updated_at":"2026-01-22T14:46:23.453157695-05:00","closed_at":"2026-01-22T14:46:23.453157695-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-yah","depends_on_id":"cgm-1cj","type":"parent-child","created_at":"2026-01-22T14:30:08.780768897-05:00","created_by":"ubuntu"}]}
{"id":"cgm-z5o","title":"Intercept ComfyUI Missing Resources Popup","description":"Replace ComfyUI's built-in missing nodes/models popup with ComfyGit's own UI. This ensures models are downloaded to correct locations and custom nodes are installed through ComfyGit's managed environment system.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-23T00:35:39.012722836-05:00","created_by":"ubuntu","updated_at":"2026-01-23T02:10:23.11572377-05:00","closed_at":"2026-01-23T02:10:23.11572377-05:00","close_reason":"All subtasks completed - popup interception system fully implemented"}
{"id":"cgm-z5o.1","title":"Add /v2/comfygit/workflow/analyze-json endpoint","notes":"## Context \u0026 Goal\n\nAdd a new backend endpoint that accepts raw workflow JSON and returns analysis results. This enables analyzing workflows that are loaded in the browser but not yet saved to disk.\n\n**Prerequisite:** Core library bead cg-2ro (WorkflowDependencyParser refactor) must be completed first.\n\n**Why it matters:** This is the backend half of the \"intercept missing resources popup\" feature. The frontend extension will call this endpoint with the workflow JSON when a workflow is loaded.\n\n## Current State vs Target State\n\n**Current:** No endpoint exists for analyzing in-memory workflow JSON. Only `/v2/comfygit/workflow/{name}/analyze` which requires workflow to be saved on disk (lines 624-709).\n\n**Target:** New endpoint `/v2/comfygit/workflow/analyze-json` that:\n1. Accepts POST with workflow JSON in body\n2. Parses workflow using Workflow.from_json()\n3. Uses WorkflowDependencyParser with Workflow object (not path)\n4. Returns analysis results matching existing analyze endpoint format\n\n## Target Code\n\nAdd after line 709 in `server/api/v2/workflows.py`:\n\n\\`\\`\\`python\n@routes.post(\"/v2/comfygit/workflow/analyze-json\")\n@requires_environment\nasync def analyze_workflow_json(request: web.Request, env) -\u003e web.Response:\n    \"\"\"Analyze workflow JSON directly without requiring file on disk.\n    \n    Used for analyzing workflows loaded in browser before save.\n    Request body: { \"workflow\": \u003cworkflow_json_object\u003e, \"name\": \"optional_name\" }\n    \"\"\"\n    try:\n        body = await request.json()\n    except Exception:\n        return web.json_response({\"error\": \"Invalid JSON body\"}, status=400)\n    \n    workflow_data = body.get(\"workflow\")\n    workflow_name = body.get(\"name\", \"unsaved\")\n    \n    if not workflow_data:\n        return web.json_response({\"error\": \"Missing workflow data\"}, status=400)\n    \n    # Parse workflow from JSON (no file needed)\n    from comfygit_core.models.workflow import Workflow\n    try:\n        workflow = Workflow.from_json(workflow_data)\n    except Exception as e:\n        return web.json_response({\"error\": f\"Invalid workflow format: {e}\"}, status=400)\n    \n    # Use WorkflowDependencyParser with Workflow object (requires cg-2ro refactor)\n    from comfygit_core.analyzers.workflow_dependency_parser import WorkflowDependencyParser\n    parser = WorkflowDependencyParser(\n        workflow=workflow,\n        workflow_name=workflow_name,\n        cec_path=env.cec_path\n    )\n    dependencies = parser.analyze_dependencies()\n    \n    # Use the same resolution logic as analyze_workflow\n    # Note: We create a temporary resolution context without pyproject access\n    # since this workflow isn't saved yet\n    result = await run_sync(\n        env.workflow_manager.resolve_workflow,\n        dependencies\n    )\n    \n    # Determine uninstalled nodes (same logic as analyze_workflow lines 641-648)\n    # For unsaved workflows, check against environment's installed packages\n    installed_packages = set(env.workflow_manager.get_installed_package_ids())\n    uninstalled_set = {\n        n.package_id for n in result.nodes_resolved \n        if n.package_id and n.package_id not in installed_packages\n    }\n    \n    # Same stats calculation as analyze_workflow (lines 652-676)\n    nodes_needing_installation = sum(\n        1 for n in result.nodes_resolved if n.package_id in uninstalled_set\n    )\n    packages_needing_installation = len(uninstalled_set)\n    needs_user_input = bool(\n        result.nodes_unresolved or result.nodes_ambiguous or\n        result.models_unresolved or result.models_ambiguous\n    )\n    download_intents_count = sum(\n        1 for m in result.models_resolved\n        if m.match_type in (\"download_intent\", \"property_download_intent\")\n    )\n    is_fully_resolved = (\n        not needs_user_input\n        and nodes_needing_installation == 0\n        and download_intents_count == 0\n    )\n    \n    # Transform to frontend format (same structure as analyze_workflow lines 678-707)\n    response = {\n        \"workflow\": workflow_name,\n        \"nodes\": {\n            \"resolved\": [_serialize_resolved_node(n, workflow_name, uninstalled_set) for n in result.nodes_resolved],\n            \"unresolved\": [_serialize_unresolved_node(n, workflow_name) for n in result.nodes_unresolved],\n            \"ambiguous\": [\n                amb for amb in [_serialize_ambiguous_node(opts, workflow_name, uninstalled_set) for opts in result.nodes_ambiguous]\n                if amb is not None\n            ]\n        },\n        \"models\": {\n            \"resolved\": [_serialize_resolved_model(m) for m in result.models_resolved],\n            \"unresolved\": [_serialize_unresolved_model(m, workflow_name) for m in result.models_unresolved],\n            \"ambiguous\": [\n                amb for amb in [_serialize_ambiguous_model(opts) for opts in result.models_ambiguous]\n                if amb is not None\n            ]\n        },\n        \"stats\": {\n            \"total_nodes\": len(result.nodes_resolved) + len(result.nodes_unresolved) + len(result.nodes_ambiguous),\n            \"total_models\": len(result.models_resolved) + len(result.models_unresolved) + len(result.models_ambiguous),\n            \"download_intents\": download_intents_count,\n            \"nodes_needing_installation\": nodes_needing_installation,\n            \"packages_needing_installation\": packages_needing_installation,\n            \"needs_user_input\": needs_user_input,\n            \"is_fully_resolved\": is_fully_resolved,\n            \"models_with_category_mismatch\": sum(1 for m in result.models_resolved if getattr(m, 'has_category_mismatch', False))\n        }\n    }\n    \n    return web.json_response(response)\n\\`\\`\\`\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- server/api/v2/workflows.py - add new endpoint after line 709 (~80 lines)\n\n**Files READ (reference only):**\n- server/api/v2/workflows.py (lines 624-709) - existing analyze_workflow for reference\n- server/api/v2/workflows.py (lines 720-760) - _serialize_* helper functions\n- server/cgm_core/decorators.py - requires_environment decorator\n\n**Files CREATED:**\n- None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Frontend extension registration bead cgm-z5o.2 (no file overlap)\n- Frontend popup component bead cgm-z5o.3 (no file overlap)\n\n**Cannot Run In Parallel With:**\n- Any other bead modifying workflows.py\n\n**Blocking Reason:**\n- Frontend needs this endpoint to get analysis results for in-browser workflows\n- **CRITICAL:** Depends on core library bead cg-2ro being completed first (WorkflowDependencyParser refactor)\n\n## Estimated Scope\n- **Size:** Medium (80-100 lines)\n- **Risk:** Low (new endpoint, doesn't modify existing code, reuses existing helpers)\n\n## Acceptance Criteria\n- [ ] Endpoint accepts POST with workflow JSON in body\n- [ ] Returns 400 if workflow data is missing or invalid\n- [ ] Returns 400 if workflow JSON can't be parsed (malformed)\n- [ ] Returns analysis results matching /workflow/{name}/analyze format exactly\n- [ ] Works with workflows containing subgraphs (ComfyUI v1.24.3+)\n- [ ] Node types correctly classified as builtin vs custom\n- [ ] Model references extracted with URLs from properties.models\n- [ ] Uninstalled packages correctly identified\n\n## Testing Requirements\n- Add test in testing/integration/panel/test_workflows.py\n- Test with valid workflow JSON (use existing test fixtures)\n- Test with invalid/malformed JSON\n- Test with workflow containing subgraphs\n- Verify response format matches existing analyze endpoint\n- Test with workflow that has missing nodes\n- Test with workflow that has missing models\n\n## Notes on Dependencies\n\nThis endpoint will NOT work until cg-2ro is complete. The call:\n\\`\\`\\`python\nparser = WorkflowDependencyParser(\n    workflow=workflow,  # Workflow object, not Path\n    ...\n)\n\\`\\`\\`\n...requires the refactored constructor that accepts Workflow objects.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-23T00:36:05.506281441-05:00","created_by":"ubuntu","updated_at":"2026-01-23T01:36:51.218972805-05:00","closed_at":"2026-01-23T01:36:51.218972805-05:00","close_reason":"Endpoint implemented with 12 passing tests. Uses core library's refactored WorkflowDependencyParser (cg-2ro).","dependencies":[{"issue_id":"cgm-z5o.1","depends_on_id":"cgm-z5o","type":"parent-child","created_at":"2026-01-23T00:36:05.507351558-05:00","created_by":"ubuntu"}]}
{"id":"cgm-z5o.2","title":"Register ComfyGit extension to intercept workflow load","notes":"## Context \u0026 Goal\n\nRegister a ComfyGit extension with ComfyUI's extension system to:\n1. Disable ComfyUI's built-in missing nodes/models warning popups\n2. Hook into beforeConfigureGraph to capture workflow data when workflows are loaded\n3. Trigger ComfyGit's own analysis flow\n\n**Why it matters:** This is the entry point for the \"intercept missing resources popup\" feature. Without this, ComfyUI shows its own popups which download models to wrong locations.\n\n## Current State vs Target State\n\n**Current:** ComfyGit registers extension `Comfy.ComfyGitPanel` in main.ts (lines 479-789) with a `setup()` hook. It does NOT hook into workflow loading.\n\n**Target:** Extend the existing extension registration to:\n1. Hook beforeConfigureGraph to disable ComfyUI warnings and capture workflow\n2. Dispatch custom event that our popup component can listen to\n\n## Target Code\n\nModify the existing extension in `frontend/src/main.ts` around line 480:\n\n\\`\\`\\`typescript\n// Register extension\napp.registerExtension({\n  name: 'Comfy.ComfyGitPanel',\n\n  // NEW: Hook into workflow loading to intercept missing resources\n  async beforeConfigureGraph(graphData, missingNodeTypes) {\n    // Disable ComfyUI's built-in popups by modifying the workflow data\n    // Note: We can't directly access settingStore from our bundle, \n    // but we can intercept here before the dialogs are shown\n    \n    // Store for later use by afterConfigureGraph\n    (window as any).__comfygit_pending_workflow = {\n      graphData,\n      missingNodeTypes,\n      timestamp: Date.now()\n    }\n  },\n\n  async afterConfigureGraph(missingNodeTypes) {\n    const pending = (window as any).__comfygit_pending_workflow\n    if (!pending) return\n    delete (window as any).__comfygit_pending_workflow\n    \n    // Dispatch event for our popup component\n    window.dispatchEvent(new CustomEvent('comfygit:workflow-loaded', {\n      detail: {\n        workflow: pending.graphData,\n        missingNodeTypes: missingNodeTypes,\n        timestamp: pending.timestamp\n      }\n    }))\n  },\n\n  async setup() {\n    // ... existing setup code (unchanged)\n  }\n})\n\\`\\`\\`\n\n**CRITICAL INSIGHT:** We cannot easily access ComfyUI's `useSettingStore` from our bundle because it's part of their Vue app context. However, looking at the ComfyUI source, the settings are checked INSIDE `loadGraphData()` right before showing dialogs. The extension hooks `beforeConfigureGraph` and `afterConfigureGraph` are called during this process.\n\n**Alternative approach if settings can't be disabled:** Show our popup AFTER ComfyUI's popup appears, then immediately close ComfyUI's using DOM manipulation:\n\\`\\`\\`typescript\n// In afterConfigureGraph, after a small delay:\nsetTimeout(() =\u003e {\n  // Find and close ComfyUI's dialog\n  const comfyDialog = document.querySelector('[data-dialog-key=\"global-missing-nodes\"]')\n  if (comfyDialog) {\n    // Close it programmatically\n    comfyDialog.closest('.p-dialog')?.remove()\n  }\n}, 100)\n\\`\\`\\`\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- frontend/src/main.ts (lines 479-490) - add beforeConfigureGraph and afterConfigureGraph hooks to existing extension\n\n**Files CREATED:**\n- None (reusing existing extension registration)\n\n**Files READ (reference only):**\n- /tmp/ComfyUI_frontend/src/types/comfy.ts (lines 232-243) - ComfyExtension interface for hook signatures\n- /tmp/ComfyUI_frontend/src/scripts/app.ts - how hooks are called\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend endpoint bead cgm-z5o.1 (different files)\n- Popup component bead cgm-z5o.3 (different files, though this bead is logically prerequisite)\n\n**Cannot Run In Parallel With:**\n- Any bead modifying main.ts\n\n**Blocking Reason:**\n- Popup component needs this to receive the workflow-loaded event\n\n## Estimated Scope\n- **Size:** Small (~30-40 lines added to existing code)\n- **Risk:** Medium (interacts with ComfyUI's internal APIs which may change)\n\n## Acceptance Criteria\n- [ ] Extension hooks beforeConfigureGraph and afterConfigureGraph are registered\n- [ ] Custom event 'comfygit:workflow-loaded' is dispatched with workflow data\n- [ ] Event contains graphData (the workflow JSON) and missingNodeTypes array\n- [ ] No errors in console when ComfyUI loads\n- [ ] Works with both new workflows and loaded workflows\n- [ ] Works with workflows containing subgraphs\n\n## Testing Requirements\n- Manual testing: Load ComfyUI, load a workflow, verify console shows event dispatch\n- Manual testing: Verify event.detail.workflow contains actual workflow data\n- Manual testing: Verify event.detail.missingNodeTypes contains any missing nodes\n- E2E test: Playwright test that verifies event is dispatched on workflow load\n\n## Important Notes\n\n1. **ComfyExtension interface** (from /tmp/ComfyUI_frontend/src/types/comfy.ts:232-243):\n   - beforeConfigureGraph(graphData: ComfyWorkflowJSON, missingNodeTypes: MissingNodeType[]): Promise\u003cvoid\u003e | void\n   - afterConfigureGraph(missingNodeTypes: MissingNodeType[]): Promise\u003cvoid\u003e | void\n\n2. **MissingNodeType** is either a string or an object with type/hint/action\n\n3. **Settings issue**: ComfyUI's settings are in a Pinia store that we don't have access to from our standalone bundle. We may need to explore alternative approaches like:\n   - Using ComfyUI's internal API if exposed\n   - DOM manipulation to close their dialogs\n   - Local storage settings (ComfyUI may read from localStorage)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-23T00:36:35.511077745-05:00","created_by":"ubuntu","updated_at":"2026-01-23T01:24:48.053429728-05:00","closed_at":"2026-01-23T01:24:48.053429728-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-z5o.2","depends_on_id":"cgm-z5o","type":"parent-child","created_at":"2026-01-23T00:36:35.511790153-05:00","created_by":"ubuntu"}]}
{"id":"cgm-z5o.3","title":"Create MissingResourcesPopup Vue component","notes":"## Context \u0026 Goal\n\nCreate a Vue component that shows when a workflow is loaded with missing nodes or models. This replaces ComfyUI's built-in popup with ComfyGit's own UI that:\n1. Uses ComfyGit's backend for accurate analysis\n2. Downloads models to correct ComfyGit-managed locations\n3. Installs nodes through ComfyGit's managed environment\n\n**Why it matters:** The built-in ComfyUI popup downloads models to a \"downloads\" folder and doesn't integrate with ComfyGit's environment management.\n\n## Current State vs Target State\n\n**Current:** No popup component for missing resources when loading workflows. ComfyUI shows its own popup.\n\n**Target:** New Vue component that:\n1. Listens for 'comfygit:workflow-loaded' event (dispatched by cgm-z5o.2)\n2. Calls /v2/comfygit/workflow/analyze-json endpoint (created by cgm-z5o.1)\n3. If issues found, shows modal with resolution options\n4. Integrates with existing resolution flow\n\n## Target Code\n\nCreate `frontend/src/components/MissingResourcesPopup.vue`:\n\n\\`\\`\\`vue\n\u003ctemplate\u003e\n  \u003cBaseModal \n    v-model:visible=\"isVisible\" \n    header=\"Missing Dependencies\"\n    :style=\"{ width: '500px' }\"\n    :closable=\"true\"\n    @hide=\"dismiss\"\n  \u003e\n    \u003cdiv v-if=\"loading\" class=\"loading-state\"\u003e\n      \u003ci class=\"pi pi-spin pi-spinner\" style=\"font-size: 1.5rem\" /\u003e\n      \u003cspan style=\"margin-left: 8px\"\u003eAnalyzing workflow...\u003c/span\u003e\n    \u003c/div\u003e\n    \n    \u003cdiv v-else-if=\"analysis \u0026\u0026 hasIssues\" class=\"analysis-results\"\u003e\n      \u003c!-- Missing Nodes Section --\u003e\n      \u003cdiv v-if=\"missingNodes.length \u003e 0\" class=\"section\"\u003e\n        \u003cdiv class=\"section-header\"\u003e\n          \u003cspan class=\"section-icon\"\u003e📦\u003c/span\u003e\n          \u003cspan\u003eMissing Custom Nodes ({{ missingNodes.length }})\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"item-list\"\u003e\n          \u003cdiv v-for=\"node in missingNodes.slice(0, 5)\" :key=\"node.node_type\" class=\"item\"\u003e\n            \u003ccode class=\"node-type\"\u003e{{ node.node_type }}\u003c/code\u003e\n            \u003cspan v-if=\"node.package_id\" class=\"package-info\"\u003e\n              → {{ node.package_title || node.package_id }}\n            \u003c/span\u003e\n            \u003cspan v-else class=\"not-found\"\u003eNot found in registry\u003c/span\u003e\n          \u003c/div\u003e\n          \u003cdiv v-if=\"missingNodes.length \u003e 5\" class=\"overflow-note\"\u003e\n            ...and {{ missingNodes.length - 5 }} more\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \n      \u003c!-- Missing Models Section --\u003e\n      \u003cdiv v-if=\"missingModels.length \u003e 0\" class=\"section\"\u003e\n        \u003cdiv class=\"section-header\"\u003e\n          \u003cspan class=\"section-icon\"\u003e🎨\u003c/span\u003e\n          \u003cspan\u003eMissing Models ({{ missingModels.length }})\u003c/span\u003e\n        \u003c/div\u003e\n        \u003cdiv class=\"item-list\"\u003e\n          \u003cdiv v-for=\"model in missingModels.slice(0, 5)\" :key=\"model.widget_value\" class=\"item\"\u003e\n            \u003cspan class=\"model-name\"\u003e{{ model.widget_value }}\u003c/span\u003e\n            \u003cspan v-if=\"model.has_download_url\" class=\"has-url\"\u003e\n              \u003ci class=\"pi pi-download\" /\u003e Can auto-download\n            \u003c/span\u003e\n            \u003cspan v-else class=\"no-url\"\u003eManual download required\u003c/span\u003e\n          \u003c/div\u003e\n          \u003cdiv v-if=\"missingModels.length \u003e 5\" class=\"overflow-note\"\u003e\n            ...and {{ missingModels.length - 5 }} more\n          \u003c/div\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \n      \u003c!-- Actions --\u003e\n      \u003cdiv class=\"actions\"\u003e\n        \u003cBaseButton @click=\"openPanel\" label=\"Open ComfyGit Panel\" /\u003e\n        \u003cBaseButton @click=\"dismiss\" label=\"Dismiss\" severity=\"secondary\" /\u003e\n      \u003c/div\u003e\n      \n      \u003c!-- Tip --\u003e\n      \u003cdiv class=\"tip\"\u003e\n        \u003ci class=\"pi pi-info-circle\" /\u003e\n        \u003cspan\u003eSave this workflow to track it in ComfyGit and enable dependency resolution.\u003c/span\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n    \n    \u003cdiv v-else-if=\"error\" class=\"error-state\"\u003e\n      \u003ci class=\"pi pi-exclamation-triangle\" /\u003e\n      \u003cspan\u003e{{ error }}\u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/BaseModal\u003e\n\u003c/template\u003e\n\n\u003cscript setup lang=\"ts\"\u003e\nimport { ref, computed, onMounted, onUnmounted } from 'vue'\nimport BaseModal from './base/BaseModal.vue'\nimport BaseButton from './base/BaseButton.vue'\n\ninterface WorkflowLoadedEvent extends CustomEvent {\n  detail: {\n    workflow: any\n    missingNodeTypes: (string | { type: string })[]\n    timestamp: number\n  }\n}\n\nconst isVisible = ref(false)\nconst loading = ref(false)\nconst error = ref\u003cstring | null\u003e(null)\nconst analysis = ref\u003cany\u003e(null)\n\nconst hasIssues = computed(() =\u003e {\n  return missingNodes.value.length \u003e 0 || missingModels.value.length \u003e 0\n})\n\nconst missingNodes = computed(() =\u003e {\n  if (!analysis.value) return []\n  // Nodes that aren't installed\n  const resolved = analysis.value.nodes.resolved.filter((n: any) =\u003e !n.is_installed)\n  const unresolved = analysis.value.nodes.unresolved\n  return [...resolved, ...unresolved]\n})\n\nconst missingModels = computed(() =\u003e {\n  if (!analysis.value) return []\n  // Models that need download or aren't resolved\n  const needsDownload = analysis.value.models.resolved.filter((m: any) =\u003e \n    m.match_type === 'download_intent' || \n    m.match_type === 'property_download_intent' ||\n    m.match_type === 'not_found'\n  )\n  const unresolved = analysis.value.models.unresolved.map((m: any) =\u003e ({\n    ...m.reference,\n    has_download_url: false\n  }))\n  return [...needsDownload, ...unresolved]\n})\n\nasync function handleWorkflowLoaded(event: WorkflowLoadedEvent) {\n  const { workflow, missingNodeTypes } = event.detail\n  \n  // Quick check: if ComfyUI found no missing nodes, might still have missing models\n  // Always analyze to be sure, but only show UI if there are issues\n  loading.value = true\n  error.value = null\n  isVisible.value = true\n  \n  try {\n    // Call our backend endpoint\n    const response = await fetch('/v2/comfygit/workflow/analyze-json', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ workflow, name: 'unsaved' })\n    })\n    \n    if (!response.ok) {\n      const err = await response.json()\n      throw new Error(err.error || 'Failed to analyze workflow')\n    }\n    \n    analysis.value = await response.json()\n    \n    // Auto-dismiss if no issues found\n    if (!hasIssues.value) {\n      isVisible.value = false\n    }\n  } catch (e) {\n    console.error('[ComfyGit] Failed to analyze workflow:', e)\n    error.value = e instanceof Error ? e.message : 'Unknown error'\n    // Don't show error UI for now - just log and dismiss\n    isVisible.value = false\n  } finally {\n    loading.value = false\n  }\n}\n\nfunction openPanel() {\n  // Use existing showPanel function via custom event\n  // main.ts listens for this and calls showPanel()\n  window.dispatchEvent(new CustomEvent('comfygit:open-panel', {\n    detail: { initialView: 'workflows' }\n  }))\n  isVisible.value = false\n}\n\nfunction dismiss() {\n  isVisible.value = false\n  analysis.value = null\n}\n\nonMounted(() =\u003e {\n  window.addEventListener('comfygit:workflow-loaded', handleWorkflowLoaded as EventListener)\n})\n\nonUnmounted(() =\u003e {\n  window.removeEventListener('comfygit:workflow-loaded', handleWorkflowLoaded as EventListener)\n})\n\u003c/script\u003e\n\n\u003cstyle scoped\u003e\n.loading-state {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem;\n}\n\n.section {\n  margin-bottom: 1rem;\n}\n\n.section-header {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n\n.section-icon {\n  font-size: 1.2rem;\n}\n\n.item-list {\n  background: var(--surface-ground);\n  border-radius: 4px;\n  padding: 0.5rem;\n}\n\n.item {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.25rem 0.5rem;\n  font-size: 0.875rem;\n}\n\n.node-type {\n  font-family: monospace;\n  background: var(--surface-100);\n  padding: 0.125rem 0.375rem;\n  border-radius: 2px;\n}\n\n.package-info {\n  color: var(--primary-color);\n}\n\n.not-found, .no-url {\n  color: var(--orange-500);\n  font-style: italic;\n}\n\n.has-url {\n  color: var(--green-500);\n}\n\n.overflow-note {\n  padding: 0.25rem 0.5rem;\n  color: var(--text-color-secondary);\n  font-style: italic;\n}\n\n.actions {\n  display: flex;\n  gap: 0.5rem;\n  justify-content: flex-end;\n  margin-top: 1rem;\n}\n\n.tip {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  margin-top: 1rem;\n  padding: 0.5rem;\n  background: var(--surface-ground);\n  border-radius: 4px;\n  font-size: 0.875rem;\n  color: var(--text-color-secondary);\n}\n\n.error-state {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 1rem;\n  color: var(--red-500);\n}\n\u003c/style\u003e\n\\`\\`\\`\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- frontend/src/main.ts - mount popup component and add event listener for open-panel (~15 lines)\n\n**Files CREATED:**\n- frontend/src/components/MissingResourcesPopup.vue - new component (~180 lines)\n\n**Files READ (reference only):**\n- frontend/src/components/WorkflowResolveModal.vue - reference for styling patterns\n- frontend/src/components/base/BaseModal.vue - modal component\n- frontend/src/components/base/BaseButton.vue - button component\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Backend endpoint bead cgm-z5o.1 (different files)\n\n**Cannot Run In Parallel With:**\n- Integration bead cgm-z5o.4 (both modify main.ts)\n\n**Blocking Reason:**\n- This component is part of the final integration, but the Vue component itself can be developed independently\n\n## Estimated Scope\n- **Size:** Medium (180-200 lines)\n- **Risk:** Low (new component following existing patterns)\n\n## Acceptance Criteria\n- [ ] Component listens for 'comfygit:workflow-loaded' event\n- [ ] Shows loading state while analyzing\n- [ ] Displays missing nodes with package suggestions\n- [ ] Displays missing models with download availability indicator\n- [ ] \"Open ComfyGit Panel\" button dispatches 'comfygit:open-panel' event\n- [ ] Auto-dismisses if no issues found\n- [ ] Styled consistently with existing ComfyGit UI (BaseModal, etc.)\n- [ ] Limits displayed items to 5 with \"and X more\" overflow\n\n## Testing Requirements\n- Manual testing: Load workflow with missing nodes, verify popup appears\n- Manual testing: Verify missing nodes/models are listed correctly\n- Manual testing: Verify \"Open ComfyGit Panel\" opens the panel to workflows view\n- Manual testing: Verify popup auto-dismisses for valid workflow\n- E2E test: Playwright test for popup flow\n\n## Design Notes\n\nThe popup should be lightweight and informational. It's NOT meant to be the full resolution wizard. Instead, it:\n1. Alerts the user that dependencies are missing\n2. Shows a summary of what's missing (max 5 items + overflow)\n3. Directs them to the ComfyGit panel for full resolution\n\nThis keeps the popup simple while leveraging existing resolution UI in the panel.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:37:11.370320101-05:00","created_by":"ubuntu","updated_at":"2026-01-23T01:47:53.401039147-05:00","closed_at":"2026-01-23T01:47:53.401039147-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-z5o.3","depends_on_id":"cgm-z5o","type":"parent-child","created_at":"2026-01-23T00:37:11.371969529-05:00","created_by":"ubuntu"},{"issue_id":"cgm-z5o.3","depends_on_id":"cgm-z5o.2","type":"blocks","created_at":"2026-01-23T00:37:43.899434774-05:00","created_by":"ubuntu"}]}
{"id":"cgm-z5o.4","title":"Wire up missing resources flow and add service method","notes":"## Context \u0026 Goal\n\nComplete the missing resources flow by:\n1. Mounting MissingResourcesPopup in main.ts\n2. Adding event listener for 'comfygit:open-panel' to open panel from popup\n3. Ensuring event flow works end-to-end\n\n**Why it matters:** This connects all the pieces together into a working feature.\n\n## Current State vs Target State\n\n**Current:** Individual pieces exist but aren't connected:\n- cgm-z5o.1: Backend endpoint exists\n- cgm-z5o.2: Extension hooks dispatch 'comfygit:workflow-loaded' event\n- cgm-z5o.3: Popup component exists but isn't mounted\n\n**Target:** Complete flow:\n1. User loads workflow → extension hooks fire → event dispatched\n2. Popup receives event → calls backend → shows results\n3. User clicks \"Open Panel\" → popup dispatches event → panel opens\n\n## Target Code\n\n### Add to main.ts (after line 44):\n\n\\`\\`\\`typescript\nimport MissingResourcesPopup from './components/MissingResourcesPopup.vue'\n\n// Missing resources popup container\nlet missingResourcesContainer: HTMLElement | null = null\nlet missingResourcesApp: ReturnType\u003ctypeof createApp\u003e | null = null\n\\`\\`\\`\n\n### Add to setup() function (around line 524, after mountDownloadQueue()):\n\n\\`\\`\\`typescript\n// Mount missing resources popup\nmountMissingResourcesPopup()\n\n// Listen for open-panel event from popup\nwindow.addEventListener('comfygit:open-panel', (event: CustomEvent) =\u003e {\n  const initialView = event.detail?.initialView\n  showPanel(initialView)\n})\n\\`\\`\\`\n\n### Add new function (after mountDownloadQueue function, around line 288):\n\n\\`\\`\\`typescript\nfunction mountMissingResourcesPopup() {\n  if (missingResourcesContainer) return // Already mounted\n\n  missingResourcesContainer = document.createElement('div')\n  missingResourcesContainer.className = 'comfygit-missing-resources-root'\n\n  missingResourcesApp = createApp({\n    render: () =\u003e h(MissingResourcesPopup)\n  })\n\n  missingResourcesApp.mount(missingResourcesContainer)\n  document.body.appendChild(missingResourcesContainer)\n  console.log('[ComfyGit] Missing resources popup mounted')\n}\n\\`\\`\\`\n\n## Files Inventory\n\n**Files MODIFIED (write):**\n- frontend/src/main.ts - add import, mount popup, add event listener (~20 lines)\n\n**Files READ (reference only):**\n- frontend/src/components/MissingResourcesPopup.vue - verify integration\n- frontend/src/main.ts (existing pattern at lines 274-287) - mountDownloadQueue for reference\n\n**Files CREATED:**\n- None\n\n## Parallelization Info\n\n**Can Run In Parallel With:**\n- Nothing - this is the final integration bead\n\n**Cannot Run In Parallel With:**\n- cgm-z5o.3 (popup component) - must be complete first\n- Any bead modifying main.ts\n\n**Blocking Reason:**\n- This is the final integration bead - depends on cgm-z5o.1, cgm-z5o.2, cgm-z5o.3\n\n## Estimated Scope\n- **Size:** Small (~20 lines)\n- **Risk:** Low (straightforward wiring following existing patterns)\n\n## Acceptance Criteria\n- [ ] MissingResourcesPopup is imported in main.ts\n- [ ] mountMissingResourcesPopup function exists and is called in setup()\n- [ ] 'comfygit:open-panel' event listener opens panel with initialView\n- [ ] Complete flow works: load workflow → see popup (if issues) → click \"Open Panel\" → panel opens\n- [ ] Build succeeds without errors\n- [ ] No console errors during flow\n\n## Testing Requirements\n- Manual E2E test: full flow from workflow load to popup to panel\n- Verify popup appears for workflow with missing nodes\n- Verify popup auto-dismisses for valid workflow\n- Verify \"Open Panel\" opens to workflows view\n- Verify production build works\n\n## Integration Checklist\n\n1. [ ] Extension dispatches 'comfygit:workflow-loaded' on workflow load (cgm-z5o.2)\n2. [ ] Popup receives event and calls backend (cgm-z5o.3)\n3. [ ] Backend returns analysis in correct format (cgm-z5o.1)\n4. [ ] Popup displays results correctly (cgm-z5o.3)\n5. [ ] \"Open Panel\" dispatches 'comfygit:open-panel' event (cgm-z5o.3)\n6. [ ] main.ts listens for 'comfygit:open-panel' and calls showPanel() (this bead)\n7. [ ] Panel opens to workflows view (existing functionality)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-23T00:37:35.37763413-05:00","created_by":"ubuntu","updated_at":"2026-01-23T01:57:01.228959432-05:00","closed_at":"2026-01-23T01:57:01.228959432-05:00","close_reason":"Closed","dependencies":[{"issue_id":"cgm-z5o.4","depends_on_id":"cgm-z5o","type":"parent-child","created_at":"2026-01-23T00:37:35.378382446-05:00","created_by":"ubuntu"},{"issue_id":"cgm-z5o.4","depends_on_id":"cgm-z5o.1","type":"blocks","created_at":"2026-01-23T00:37:57.492032854-05:00","created_by":"ubuntu"},{"issue_id":"cgm-z5o.4","depends_on_id":"cgm-z5o.2","type":"blocks","created_at":"2026-01-23T00:37:57.504389317-05:00","created_by":"ubuntu"},{"issue_id":"cgm-z5o.4","depends_on_id":"cgm-z5o.3","type":"blocks","created_at":"2026-01-23T00:37:57.517964204-05:00","created_by":"ubuntu"}]}
